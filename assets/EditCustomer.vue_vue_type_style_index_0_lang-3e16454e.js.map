{"version":3,"file":"EditCustomer.vue_vue_type_style_index_0_lang-3e16454e.js","sources":["../../src/pages/customers/pages/EditCustomer.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { computed, onMounted, ref, watch } from 'vue'\r\nimport { useForm } from 'vuestic-ui'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { getById, updateById } from '../../../core/requests/Contacts'\r\nimport { useToast } from 'vuestic-ui'\r\nimport { getAllCompanies } from '../../../core/requests/Company'\r\nimport { validators } from '../../../services/utils'\r\nimport { onlyNumbersNoDigits } from '../../../core/helpers'\r\n\r\nconst vOnlyNumbers = onlyNumbersNoDigits\r\n\r\nconst emit = defineEmits(['close'])\r\n\r\nconst props = defineProps({\r\n  id: {\r\n    type: String,\r\n    default: '',\r\n  },\r\n})\r\n\r\nconst { t } = useI18n()\r\nconst isLoading = ref(false)\r\nconst { isValid, validate, reset } = useForm('formRef')\r\nconst form: any = ref({\r\n  havecompany: false,\r\n})\r\nconst companies: any = ref([])\r\nconst { notify } = useToast()\r\nconst doProcess = async () => {\r\n  if (validate()) {\r\n    isLoading.value = true\r\n    const {\r\n      fullname,\r\n      document_type,\r\n      document,\r\n      ruc,\r\n      email,\r\n      email_corporative,\r\n      cellphone,\r\n      whatsapp,\r\n      address,\r\n      havecompany,\r\n      company,\r\n    } = form.value\r\n\r\n    const documentType = document_type?.code\r\n\r\n    await updateById(props.id, {\r\n      fullname,\r\n      document_type: documentType,\r\n      document,\r\n      ruc,\r\n      email,\r\n      email_corporative,\r\n      cellphone,\r\n      whatsapp,\r\n      address,\r\n      havecompany,\r\n      company,\r\n    })\r\n\r\n    notify({\r\n      message: 'Cliente actualizado correctamente',\r\n      color: 'success',\r\n    })\r\n\r\n    reset()\r\n    isLoading.value = false\r\n    emit('close')\r\n  }\r\n}\r\n\r\nconst selectedCompany: any = computed(() => companies.value.find((f: any) => f.id === form.value.company))\r\n\r\nonMounted(async () => {\r\n  watch(\r\n    () => form.value.havecompany,\r\n    async (val) => {\r\n      if (val) {\r\n        isLoading.value = true\r\n        await getCompanies()\r\n        isLoading.value = false\r\n      }\r\n    },\r\n  )\r\n\r\n  const contact: any = await getById(props.id)\r\n  form.value = contact\r\n  form.value.havecompany = !!contact.havecompany\r\n  form.value.document_type = { code: contact.document_type, text: 'DNI' }\r\n})\r\n\r\nconst documentTypes = [\r\n  { code: 1, text: 'DNI' },\r\n  { code: 2, text: 'C.E' },\r\n  { code: 3, text: 'PASAPORTE' },\r\n]\r\n// const countries = [{ code: 1, text: 'PERU' }]\r\nconst openSunatRuc = () => {\r\n  window.open(\r\n    'https://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/FrameCriterioBusquedaWeb.jsp',\r\n    '_blank',\r\n    'menubar=1,resizable=0,width=600,height=500',\r\n  )\r\n}\r\nconst getCompanies = async () => {\r\n  const cData = await getAllCompanies()\r\n  companies.value = cData\r\n}\r\n</script>\r\n\r\n<template>\r\n  <VaInnerLoading :loading=\"isLoading\" style=\"--va-inner-loading-min-width: 100%\">\r\n    <div class=\"bg-blue-50\">\r\n      <div>\r\n        <div class=\"flex justify-between align-center justify-center\">\r\n          <h1 class=\"h5 font-bold m-0\">{{ t('contacts.contactDetail') }}</h1>\r\n          <div class=\"flex gap-2\">\r\n            <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\r\n              <span class=\"text-xs px-1\">{{ t('contacts.updateContact') }}</span>\r\n            </VaButton>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"py-4 new-customer gap-8\">\r\n        <VaForm ref=\"formRef\" immediate class=\"gap-2\">\r\n          <div class=\"w-full bg-white p-2\">\r\n            <p class=\"text-sm font-medium mb-3\">Datos personales</p>\r\n            <div class=\"gap-2\">\r\n              <div class=\"w-full columns-4 gap-4\">\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.fullname\"\r\n                    stateful\r\n                    name=\"fullname\"\r\n                    placeholder=\"Sin Información\"\r\n                    clearable\r\n                    maxlength=\"50\"\r\n                    label=\"Nombres completos\"\r\n                    :loading=\"isLoading\"\r\n                    :rules=\"[validators.required]\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <VaSelect\r\n                    v-model=\"form.document_type\"\r\n                    name=\"document_type\"\r\n                    placeholder=\"Sin Información\"\r\n                    :options=\"documentTypes\"\r\n                    label=\"Tipo de documento\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.document\"\r\n                    v-only-numbers\r\n                    name=\"document\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    clearable\r\n                    label=\"N° Documento\"\r\n                    maxlength=\"22\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.ruc\"\r\n                    v-only-numbers\r\n                    name=\"ruc\"\r\n                    maxlength=\"20\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    clearable\r\n                    label=\"RUC\"\r\n                  >\r\n                    <template #appendInner>\r\n                      <VaIcon name=\"open_in_new\" class=\"cursor-pointer\" @click=\"openSunatRuc()\" />\r\n                    </template>\r\n                  </VaInput>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"w-full mt-3\">\r\n                <div class=\"w-full\">\r\n                  <VaInput\r\n                    v-model=\"form.address\"\r\n                    name=\"address\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    clearable\r\n                    label=\"Dirección de contacto\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"w-full columns-4 gap-4 mt-3 pb-3\">\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.email\"\r\n                    name=\"email\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    maxlength=\"25\"\r\n                    clearable\r\n                    label=\"Correo electrónico\"\r\n                  >\r\n                    <template #prependInner>\r\n                      <VaIcon name=\"alternate_email\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                    </template>\r\n                  </VaInput>\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.email_corporative\"\r\n                    name=\"email_corporative\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    clearable\r\n                    maxlength=\"25\"\r\n                    label=\"Correo corporativo\"\r\n                    :rules=\"[validators.email]\"\r\n                  >\r\n                    <template #prependInner>\r\n                      <VaIcon name=\"alternate_email\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                    </template>\r\n                  </VaInput>\r\n                </div>\r\n\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.cellphone\"\r\n                    v-only-numbers\r\n                    placeholder=\"Sin Información\"\r\n                    maxlength=\"12\"\r\n                    name=\"cellphone\"\r\n                    stateful\r\n                    clearable\r\n                    label=\"Teléfono\"\r\n                    :rules=\"[validators.required]\"\r\n                  >\r\n                    <template #prependInner>\r\n                      <VaIcon name=\"call\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                    </template>\r\n                  </VaInput>\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    v-model=\"form.whatsapp\"\r\n                    v-only-numbers\r\n                    name=\"whatsapp\"\r\n                    maxlength=\"12\"\r\n                    placeholder=\"Sin Información\"\r\n                    stateful\r\n                    clearable\r\n                    label=\"WhatsApp\"\r\n                  >\r\n                    <template #prependInner>\r\n                      <VaIcon name=\"call\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                    </template>\r\n                  </VaInput>\r\n                </div>\r\n              </div>\r\n\r\n              <div class=\"w-full mt-5\">\r\n                <VaSwitch\r\n                  v-model=\"form.havecompany\"\r\n                  class=\"text-xs\"\r\n                  name=\"havecompany\"\r\n                  label=\"Representa una empresa\"\r\n                  size=\"small\"\r\n                />\r\n              </div>\r\n\r\n              <div v-if=\"form.havecompany\" class=\"columns-3 mt-5\">\r\n                <div>\r\n                  <VaSelect\r\n                    v-model=\"form.company\"\r\n                    name=\"company_id\"\r\n                    class=\"text-xs\"\r\n                    :options=\"companies\"\r\n                    track-by=\"id\"\r\n                    value-by=\"id\"\r\n                    text-by=\"socialreason\"\r\n                    searchable\r\n                    clearable\r\n                    search-placeholder-text=\"Escribe el RUC\"\r\n                    :rules=\"[validators.required]\"\r\n                    label=\"Selecciona la empresa\"\r\n                  />\r\n                </div>\r\n\r\n                <div class=\"pt-5\">\r\n                  <!-- <VaButton icon=\"add\" color=\"primary\" :loading=\"isLoading\" @click=\"showNewCompany = true\">\r\n                  <span class=\"text-xs px-1\">{{ t('contacts.createCompany') }}</span>\r\n                </VaButton> -->\r\n                </div>\r\n              </div>\r\n\r\n              <div v-if=\"form.havecompany && selectedCompany\" class=\"bg-blue-50 px-3 py-2 mt-5\">\r\n                <p class=\"font-bold text-sm mb-3\">{{ selectedCompany.socialreason }}</p>\r\n                <div class=\"columns-4\">\r\n                  <div>\r\n                    <VaInput\r\n                      :model-value=\"selectedCompany.ruc\"\r\n                      background=\"#eee\"\r\n                      name=\"whatsapp\"\r\n                      readonly\r\n                      class=\"opacity-85 cursor-not-allowed\"\r\n                      placeholder=\"Sin Información\"\r\n                      label=\"RUC\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <VaInput\r\n                      :model-value=\"selectedCompany.phone\"\r\n                      background=\"#eee\"\r\n                      name=\"whatsapp\"\r\n                      placeholder=\"Sin Información\"\r\n                      readonly\r\n                      class=\"opacity-85 cursor-not-allowed\"\r\n                      label=\"Teléfono\"\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <VaInput\r\n                      :model-value=\"selectedCompany.whatsapp\"\r\n                      background=\"#eee\"\r\n                      name=\"whatsapp\"\r\n                      readonly\r\n                      placeholder=\"Sin Información\"\r\n                      class=\"opacity-85 cursor-not-allowed\"\r\n                      label=\"WhatsApp\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </VaForm>\r\n      </div>\r\n\r\n      <div class=\"pb-3\">\r\n        <div class=\"flex justify-end\">\r\n          <div class=\"flex gap-2\">\r\n            <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\r\n              <span class=\"text-xs px-1\">{{ t('contacts.updateContact') }}</span>\r\n            </VaButton>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </VaInnerLoading>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.new-customer {\r\n  &-tabs {\r\n    .va-tabs__content {\r\n      width: 100%;\r\n    }\r\n  }\r\n\r\n  .float-profile {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n  }\r\n}\r\n</style>\r\n"],"names":["vOnlyNumbers","onlyNumbersNoDigits","emit","__emit","props","__props","t","useI18n","isLoading","ref","isValid","validate","reset","useForm","form","companies","notify","useToast","doProcess","fullname","document_type","document","ruc","email","email_corporative","cellphone","whatsapp","address","havecompany","company","documentType","updateById","selectedCompany","computed","f","onMounted","watch","val","getCompanies","contact","getById","documentTypes","openSunatRuc","cData","getAllCompanies"],"mappings":"oqCAUA,MAAMA,EAAeC,EAEfC,EAAOC,EAEPC,EAAQC,EAOR,CAAE,EAAAC,GAAMC,IACRC,EAAYC,EAAI,EAAK,EACrB,CAAE,QAAAC,EAAS,SAAAC,EAAU,MAAAC,CAAM,EAAIC,EAAQ,SAAS,EAChDC,EAAYL,EAAI,CACpB,YAAa,EAAA,CACd,EACKM,EAAiBN,EAAI,CAAA,CAAE,EACvB,CAAE,OAAAO,GAAWC,IACbC,EAAY,SAAY,CAC5B,GAAIP,IAAY,CACdH,EAAU,MAAQ,GACZ,KAAA,CACJ,SAAAW,EACA,cAAAC,EACA,SAAAC,EACA,IAAAC,EACA,MAAAC,EACA,kBAAAC,EACA,UAAAC,EACA,SAAAC,EACA,QAAAC,EACA,YAAAC,EACA,QAAAC,CAAA,EACEf,EAAK,MAEHgB,EAAeV,GAAA,YAAAA,EAAe,KAE9B,MAAAW,EAAW3B,EAAM,GAAI,CACzB,SAAAe,EACA,cAAeW,EACf,SAAAT,EACA,IAAAC,EACA,MAAAC,EACA,kBAAAC,EACA,UAAAC,EACA,SAAAC,EACA,QAAAC,EACA,YAAAC,EACA,QAAAC,CAAA,CACD,EAEMb,EAAA,CACL,QAAS,oCACT,MAAO,SAAA,CACR,EAEKJ,IACNJ,EAAU,MAAQ,GAClBN,EAAK,OAAO,CACd,CAAA,EAGI8B,EAAuBC,EAAS,IAAMlB,EAAU,MAAM,KAAMmB,GAAWA,EAAE,KAAOpB,EAAK,MAAM,OAAO,CAAC,EAEzGqB,EAAU,SAAY,CACpBC,EACE,IAAMtB,EAAK,MAAM,YACjB,MAAOuB,GAAQ,CACTA,IACF7B,EAAU,MAAQ,GAClB,MAAM8B,EAAa,EACnB9B,EAAU,MAAQ,GAEtB,CAAA,EAGF,MAAM+B,EAAe,MAAMC,EAAQpC,EAAM,EAAE,EAC3CU,EAAK,MAAQyB,EACbzB,EAAK,MAAM,YAAc,CAAC,CAACyB,EAAQ,YACnCzB,EAAK,MAAM,cAAgB,CAAE,KAAMyB,EAAQ,cAAe,KAAM,MAAM,CACvE,EAED,MAAME,EAAgB,CACpB,CAAE,KAAM,EAAG,KAAM,KAAM,EACvB,CAAE,KAAM,EAAG,KAAM,KAAM,EACvB,CAAE,KAAM,EAAG,KAAM,WAAY,CAAA,EAGzBC,EAAe,IAAM,CAClB,OAAA,KACL,oFACA,SACA,4CAAA,CACF,EAEIJ,EAAe,SAAY,CACzB,MAAAK,EAAQ,MAAMC,IACpB7B,EAAU,MAAQ4B,CAAA"}