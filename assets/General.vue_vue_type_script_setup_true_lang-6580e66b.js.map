{"version":3,"file":"General.vue_vue_type_script_setup_true_lang-6580e66b.js","sources":["../../src/pages/settings/NewRoute.vue","../../src/pages/settings/General.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { reactive, ref } from 'vue'\nimport { useForm } from 'vuestic-ui'\nimport { newRoute } from '../../core/requests/Routes'\nimport InputAddress from '../oportunities/components/InputAddress.vue'\nimport { validators } from '../../services/utils'\nimport { onlyNumbers, onlyNumbersNoDigits } from '../../core/helpers'\nimport { ceil } from 'lodash'\n\nconst vOnlyDigits = onlyNumbers\nconst vOnlyNumbers = onlyNumbersNoDigits\n\nconst emit = defineEmits(['close'])\n\nconst isLoading = ref(false)\nconst fromTolls: any = ref([])\nconst toTolls: any = ref([])\nconst { isValid, validate, reset } = useForm('formRef')\nconst form: any = reactive({})\nconst from: any = ref(null)\nconst to: any = ref(null)\n\nconst doProcess = async () => {\n  if (validate()) {\n    isLoading.value = true\n    try {\n      //\n      await newRoute({\n        from: from.value.label,\n        to: to.value.label,\n        kilometers: form.kilometers || 0,\n        baseprice: form.baseprice || 0,\n        travelhours: form.hours || 0,\n        tolls: {\n          from: fromTolls.value.map((f: any) => ({\n            quantity: f.q,\n            amount: f.amount,\n          })),\n          to: toTolls.value.map((f: any) => ({\n            quantity: f.q,\n            amount: f.amount,\n          })),\n        },\n      })\n\n      reset()\n\n      emit('close')\n    } catch (e: any) {\n      console.log(e)\n    }\n\n    isLoading.value = false\n  }\n}\n\nconst addNewFrom = () => {\n  fromTolls.value.push({\n    q: 1,\n    amount: 0,\n  })\n}\n\nconst addNewTo = () => {\n  toTolls.value.push({\n    q: 1,\n    amount: 0,\n  })\n}\n\nconst deleteFrom = (index: any) => {\n  fromTolls.value.splice(index, 1)\n}\n\nconst deleteTo = (index: any) => {\n  toTolls.value.splice(index, 1)\n}\n</script>\n\n<template>\n  <div class=\"bg-blue-50\">\n    <div class=\"mb-4\">\n      <div class=\"flex justify-between align-center justify-center\">\n        <h1 class=\"h5 font-bold m-0\">Nueva Ruta</h1>\n      </div>\n    </div>\n\n    <div class=\"new-customer gap-8\">\n      <VaForm ref=\"formRef\" immediate class=\"gap-2\">\n        <div class=\"w-full bg-white p-2 mt-3 mb-4 py-5\">\n          <div class=\"gap-2\">\n            <div class=\"bg-white columns-2 py-1 pb-3\">\n              <div>\n                <InputAddress label=\"Origen\" :onlyaddress=\"true\" :nomaps=\"true\" @selected=\"(e) => (from = e)\" />\n              </div>\n\n              <div>\n                <InputAddress label=\"Destino\" :onlyaddress=\"true\" :nomaps=\"true\" @selected=\"(e) => (to = e)\" />\n              </div>\n            </div>\n\n            <div class=\"columns-3 mb-4\">\n              <div>\n                <VaInput\n                  v-model=\"form.baseprice\"\n                  v-only-digits\n                  label=\"Precio base de Servicio\"\n                  min=\"0\"\n                  :rules=\"[validators.required]\"\n                  @change=\"\n                    () => {\n                      form.baseprice = ceil(form.baseprice, 2)\n                    }\n                  \"\n                >\n                  <template #prependInner>\n                    <span class=\"px-0 -mx-1 font-bold text-sm\">S/</span>\n                  </template>\n                </VaInput>\n              </div>\n\n              <div>\n                <VaInput v-model=\"form.kilometers\" v-only-numbers label=\"Kilometros\" type=\"number\" min=\"0\" />\n              </div>\n\n              <div>\n                <VaInput v-model=\"form.hours\" v-only-numbers label=\"Horas de Viaje\" type=\"number\" min=\".5\" />\n              </div>\n            </div>\n\n            <hr />\n\n            <div class=\"columns-2 mt-4 gap-0\">\n              <div class=\"bg-gray-100 py-1\">\n                <p class=\"font-bold text-black text-sm text-center\">\n                  Peajes <span class=\"uppercase text-xs\">(Ida)</span>\n                  <VaIcon color=\"primary\" name=\"add_circle\" class=\"cursor-pointer ml-2\" @click=\"addNewFrom()\" />\n                </p>\n              </div>\n              <div class=\"bg-blue-100 py-1\">\n                <p class=\"font-bold text-black text-sm text-center\">\n                  Peajes <span class=\"uppercase text-xs\">(Vuelta)</span>\n                  <VaIcon color=\"primary\" name=\"add_circle\" class=\"cursor-pointer ml-2\" @click=\"addNewTo()\" />\n                </p>\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"flex gap-0\">\n              <div class=\"flex flex-col w-1/2\">\n                <div v-for=\"(item, index) in fromTolls\" :key=\"item\" class=\"bg-gray-100 px-1 pb-1\">\n                  <div class=\"flex gap-1 toll\">\n                    <VaSelect\n                      v-model=\"item.q\"\n                      class=\"quantity\"\n                      :options=\"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\"\n                      background=\"#fff\"\n                    />\n                    <VaInput\n                      v-model=\"item.amount\"\n                      v-only-digits\n                      type=\"text\"\n                      class=\"amount\"\n                      background=\"#fff\"\n                      @change=\"\n                        () => {\n                          item.amount = ceil(item.amount, 2)\n                        }\n                      \"\n                    >\n                      <template #append>\n                        <VaIcon name=\"delete\" class=\"cursor-pointer ml-1\" color=\"danger\" @click=\"deleteFrom(index)\" />\n                      </template>\n                    </VaInput>\n                  </div>\n                </div>\n              </div>\n              <div class=\"flex flex-col w-1/2\">\n                <div v-for=\"(item, index) in toTolls\" :key=\"item\" class=\"flex flex-col bg-blue-100 pl-1 pr-3 pb-1\">\n                  <div class=\"flex gap-1 toll\">\n                    <VaSelect\n                      v-model=\"item.q\"\n                      class=\"quantity\"\n                      :options=\"[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\"\n                      background=\"#fff\"\n                    />\n                    <VaInput\n                      v-model=\"item.amount\"\n                      v-only-digits\n                      type=\"text\"\n                      class=\"amount\"\n                      background=\"#fff\"\n                      @change=\"\n                        () => {\n                          item.amount = ceil(item.amount, 2)\n                        }\n                      \"\n                    >\n                      <template #append>\n                        <VaIcon name=\"delete\" class=\"cursor-pointer ml-1\" color=\"danger\" @click=\"deleteTo(index)\" />\n                      </template>\n                    </VaInput>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </VaForm>\n    </div>\n\n    <div>\n      <div class=\"flex justify-end\">\n        <div class=\"flex gap-2\">\n          <VaButton\n            icon=\"save\"\n            color=\"primary\"\n            :disabled=\"!isValid || !toTolls.length || !fromTolls.length\"\n            :loading=\"isLoading\"\n            @click=\"doProcess\"\n          >\n            <span class=\"text-xs px-1\">Guardar</span>\n          </VaButton>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.new-customer {\n  &-tabs {\n    .va-tabs__content {\n      width: 100%;\n    }\n  }\n\n  .float-profile {\n    position: absolute;\n    top: 0;\n    right: 0;\n  }\n}\n\n.toll {\n  .quantity {\n    width: 80px;\n  }\n\n  .amount {\n    width: 110px;\n  }\n}\n</style>\n","<script lang=\"ts\" setup>\nimport { onMounted, ref } from 'vue'\nimport NewRoute from './NewRoute.vue'\nimport { deleteRoute, getAllRoutes } from '../../core/requests/Routes'\nimport { useToast } from 'vuestic-ui'\n\nconst { notify } = useToast()\n\nconst showNewRoute = ref(false)\nconst showNewToll = ref(false)\nconst showConfirm = ref(false)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst selected = ref(null)\nconst routes: any = ref([])\n\nconst closeModal = () => {\n  showNewRoute.value = false\n  showNewToll.value = false\n  getRoutes()\n}\n\nonMounted(() => {\n  getRoutes()\n})\n\nconst getRoutes = async () => {\n  isLoading.value = true\n  const _routes: any = await getAllRoutes()\n  routes.value = _routes\n  isLoading.value = false\n}\n\nconst doDelete = async () => {\n  showConfirm.value = false\n  await deleteRoute(selected.value)\n\n  notify({\n    message: 'Ruta eliminada correctamente',\n    color: 'success',\n  })\n\n  getRoutes()\n}\n\nconst needConfirm = (id: any) => {\n  selected.value = id\n  showConfirm.value = !!id\n}\n</script>\n\n<template>\n  <div class=\"flex flex-col space-y-6 md:space-y-4\">\n    <VaInnerLoading :loading=\"isLoading\">\n      <VaCard>\n        <VaCardTitle class=\"d-flex justify-between\">\n          Maestro de Rutas\n          <VaButton icon=\"add\" color=\"primary\" @click=\"showNewRoute = true\">\n            <span class=\"px-1\">Nueva Ruta</span>\n          </VaButton>\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"flex flex-col p-4 bg-backgroundSecondary rounded-lg\">\n            <div class=\"va-table-responsive\">\n              <table class=\"va-table w-full text-xs\">\n                <thead>\n                  <tr>\n                    <th>#</th>\n                    <th>Origen</th>\n                    <th>Destino</th>\n                    <th>Kilometros</th>\n                    <th>P. Base</th>\n                    <th>Horas</th>\n                    <th>Peajes</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"t in routes\" :key=\"t.id\">\n                    <td>{{ t.id }}</td>\n                    <td>{{ t.from }}</td>\n                    <td>{{ t.to }}</td>\n                    <td>{{ t.kilometers || '-' }}</td>\n                    <td>S/ {{ t.baseprice }}</td>\n                    <td>{{ t.travelhours || '-' }}</td>\n                    <td>\n                      <p v-if=\"!t.tolls.length\" class=\"m-0 font-bold text-xs\">Sin Información</p>\n\n                      <div v-if=\"t.tolls.length\" class=\"bg-blue-100 px-2 pb-2 pt-1 rounded-md\">\n                        <div v-if=\"t.tolls.filter((f: any) => f.type === 0).length\">\n                          <p class=\"text-xs font-bold mb-1 px-1\">Ida:</p>\n                          <VaBadge\n                            v-for=\"i in t.tolls.filter((f: any) => f.type === 0)\"\n                            :key=\"i\"\n                            :text=\"'(' + i.quantity + ')' + ' S/' + i.amount\"\n                            color=\"primary\"\n                            class=\"mr-2\"\n                          />\n                        </div>\n                        <div v-if=\"t.tolls.filter((f: any) => f.type === 1).length\">\n                          <p class=\"text-xs font-bold mt-2 mb-1 px-1\">Vuelta:</p>\n                          <VaBadge\n                            v-for=\"i in t.tolls.filter((f: any) => f.type === 1)\"\n                            :key=\"i\"\n                            :text=\"'(' + i.quantity + ')' + ' S/' + i.amount\"\n                            color=\"primary\"\n                            class=\"mr-2\"\n                          />\n                        </div>\n                      </div>\n                    </td>\n                    <td>\n                      <div class=\"flex gap-1\">\n                        <VaButton icon=\"delete\" color=\"danger\" round @click=\"needConfirm(t.id)\"></VaButton>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </VaInnerLoading>\n\n    <VaModal v-model=\"showNewRoute\" size=\"460px\" close-button hide-default-actions no-dismiss blur>\n      <div>\n        <NewRoute @close=\"closeModal\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas continuar?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["vOnlyDigits","onlyNumbers","vOnlyNumbers","onlyNumbersNoDigits","emit","__emit","isLoading","ref","fromTolls","toTolls","isValid","validate","reset","useForm","form","reactive","from","to","doProcess","newRoute","f","e","addNewFrom","addNewTo","deleteFrom","index","deleteTo","notify","useToast","showNewRoute","showNewToll","showConfirm","isDeleting","selected","routes","closeModal","getRoutes","onMounted","_routes","getAllRoutes","doDelete","deleteRoute","needConfirm","id"],"mappings":"i7CASA,MAAMA,EAAcC,GACdC,EAAeC,GAEfC,EAAOC,EAEPC,EAAYC,EAAI,EAAK,EACrBC,EAAiBD,EAAI,CAAA,CAAE,EACvBE,EAAeF,EAAI,CAAA,CAAE,EACrB,CAAE,QAAAG,EAAS,SAAAC,EAAU,MAAAC,CAAM,EAAIC,EAAQ,SAAS,EAChDC,EAAYC,EAAS,CAAA,CAAE,EACvBC,EAAYT,EAAI,IAAI,EACpBU,EAAUV,EAAI,IAAI,EAElBW,EAAY,SAAY,CAC5B,GAAIP,IAAY,CACdL,EAAU,MAAQ,GACd,GAAA,CAEF,MAAMa,EAAS,CACb,KAAMH,EAAK,MAAM,MACjB,GAAIC,EAAG,MAAM,MACb,WAAYH,EAAK,YAAc,EAC/B,UAAWA,EAAK,WAAa,EAC7B,YAAaA,EAAK,OAAS,EAC3B,MAAO,CACL,KAAMN,EAAU,MAAM,IAAKY,IAAY,CACrC,SAAUA,EAAE,EACZ,OAAQA,EAAE,MAAA,EACV,EACF,GAAIX,EAAQ,MAAM,IAAKW,IAAY,CACjC,SAAUA,EAAE,EACZ,OAAQA,EAAE,MAAA,EACV,CACJ,CAAA,CACD,EAEKR,IAENR,EAAK,OAAO,QACLiB,EAAQ,CACf,QAAQ,IAAIA,CAAC,CACf,CAEAf,EAAU,MAAQ,EACpB,CAAA,EAGIgB,EAAa,IAAM,CACvBd,EAAU,MAAM,KAAK,CACnB,EAAG,EACH,OAAQ,CAAA,CACT,CAAA,EAGGe,EAAW,IAAM,CACrBd,EAAQ,MAAM,KAAK,CACjB,EAAG,EACH,OAAQ,CAAA,CACT,CAAA,EAGGe,EAAcC,GAAe,CACvBjB,EAAA,MAAM,OAAOiB,EAAO,CAAC,CAAA,EAG3BC,EAAYD,GAAe,CACvBhB,EAAA,MAAM,OAAOgB,EAAO,CAAC,CAAA,2nHCrEzB,KAAA,CAAE,OAAAE,GAAWC,IAEbC,EAAetB,EAAI,EAAK,EACxBuB,EAAcvB,EAAI,EAAK,EACvBwB,EAAcxB,EAAI,EAAK,EACvByB,EAAazB,EAAI,EAAK,EACtBD,EAAYC,EAAI,EAAK,EACrB0B,EAAW1B,EAAI,IAAI,EACnB2B,EAAc3B,EAAI,CAAA,CAAE,EAEpB4B,EAAa,IAAM,CACvBN,EAAa,MAAQ,GACrBC,EAAY,MAAQ,GACVM,GAAA,EAGZC,EAAU,IAAM,CACJD,GAAA,CACX,EAED,MAAMA,EAAY,SAAY,CAC5B9B,EAAU,MAAQ,GACZ,MAAAgC,EAAe,MAAMC,IAC3BL,EAAO,MAAQI,EACfhC,EAAU,MAAQ,EAAA,EAGdkC,EAAW,SAAY,CAC3BT,EAAY,MAAQ,GACd,MAAAU,EAAYR,EAAS,KAAK,EAEzBN,EAAA,CACL,QAAS,+BACT,MAAO,SAAA,CACR,EAESS,GAAA,EAGNM,EAAeC,GAAY,CAC/BV,EAAS,MAAQU,EACLZ,EAAA,MAAQ,CAAC,CAACY,CAAA"}