{"version":3,"file":"General.vue_vue_type_script_setup_true_lang-da8e1236.js","sources":["../../src/pages/settings/NewRoute.vue","../../src/pages/settings/General.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, reactive, ref } from 'vue'\nimport { useForm } from 'vuestic-ui'\nimport { newRoute, updateRoute } from '../../core/requests/Routes'\nimport InputAddress from '../oportunities/components/InputAddress.vue'\nimport { onlyNumbers, onlyNumbersNoDigits } from '../../core/helpers'\nimport { ceil } from 'lodash'\n\nconst props = defineProps({\n  data: {\n    default: null,\n    type: Object,\n  },\n})\n\nconst vOnlyDigits = onlyNumbers\nconst vOnlyNumbers = onlyNumbersNoDigits\n\nconst emit = defineEmits(['close'])\n\nconst isLoading = ref(false)\nconst fromTolls: any = ref([])\nconst toTolls: any = ref([])\nconst { isValid, validate, reset } = useForm('formRef')\nconst form: any = reactive({})\nconst from: any = ref(null)\nconst to: any = ref(null)\n\nonMounted(() => {\n  if (props.data) {\n    form.baseprice = props.data?.baseprice || 0\n    form.kilometers = props.data?.kilometers || 0\n    form.hours = props.data?.travelhours || 0\n\n    fromTolls.value = props.data.tolls\n      .filter((f: any) => f.type == 0)\n      .map((f: any) => ({\n        q: f.vehicle_type,\n        amount: f.amount,\n      }))\n\n    toTolls.value = props.data.tolls\n      .filter((f: any) => f.type == 1)\n      .map((f: any) => ({\n        q: f.vehicle_type,\n        amount: f.amount,\n      }))\n  }\n})\n\nconst doProcess = async () => {\n  if (validate()) {\n    isLoading.value = true\n    try {\n      //\n      if (props.data?.id) {\n        await updateRoute(\n          {\n            kilometers: form.kilometers || 0,\n            baseprice: form.baseprice || 0,\n            travelhours: form.hours || 0,\n            tolls: {\n              from: fromTolls.value.map((f: any) => ({\n                vehicle_type: f.q,\n                amount: f.amount,\n              })),\n              to: toTolls.value.map((f: any) => ({\n                vehicle_type: f.q,\n                amount: f.amount,\n              })),\n            },\n          },\n          props.data.id,\n        )\n      } else {\n        await newRoute({\n          from: from.value.label,\n          to: to.value.label,\n          kilometers: form.kilometers || 0,\n          baseprice: form.baseprice || 0,\n          travelhours: form.hours || 0,\n          tolls: {\n            from: fromTolls.value.map((f: any) => ({\n              vehicle_type: f.q,\n              amount: f.amount,\n            })),\n            to: toTolls.value.map((f: any) => ({\n              vehicle_type: f.q,\n              amount: f.amount,\n            })),\n          },\n        })\n      }\n\n      reset()\n\n      emit('close')\n    } catch (e: any) {\n      console.log(e)\n    }\n\n    isLoading.value = false\n  }\n}\n\nconst addNewFrom = () => {\n  fromTolls.value.push({\n    q: vehicleTypes[0],\n    amount: 0,\n  })\n}\n\nconst addNewTo = () => {\n  toTolls.value.push({\n    q: vehicleTypes[0],\n    amount: 0,\n  })\n}\n\nconst deleteFrom = (index: any) => {\n  fromTolls.value.splice(index, 1)\n}\n\nconst deleteTo = (index: any) => {\n  toTolls.value.splice(index, 1)\n}\n\nconst vehicleTypes = [\n  'Ligero',\n  '2 Ejes',\n  '3 Ejes',\n  '4 Ejes',\n  '5 Ejes',\n  '6 Ejes',\n  '7 Ejes',\n  '8 Ejes',\n  '9 Ejes',\n  '10 Ejes',\n  '11 Ejes',\n  '12 Ejes',\n  '13 Ejes',\n  '14 Ejes',\n  '15 Ejes',\n]\n</script>\n\n<template>\n  <div class=\"bg-blue-50\">\n    <div class=\"mb-4\">\n      <div class=\"flex justify-between align-center justify-center\">\n        <h1 class=\"h5 font-bold m-0\">Nueva Ruta</h1>\n      </div>\n    </div>\n\n    <div class=\"new-customer gap-8\">\n      <VaForm ref=\"formRef\" immediate class=\"gap-2\">\n        <div class=\"w-full bg-white p-2 mt-3 mb-4 py-5\">\n          <div class=\"gap-2\">\n            <p v-if=\"$props.data\" class=\"text-xs font-bold uppercase\">\n              {{ $props.data?.from }} / {{ $props.data?.to }}\n            </p>\n            <div class=\"bg-white columns-2 py-1 pb-3\">\n              <div>\n                <InputAddress\n                  v-if=\"!$props.data\"\n                  label=\"Origen\"\n                  :onlyaddress=\"true\"\n                  :nomaps=\"true\"\n                  @selected=\"(e) => (from = e)\"\n                />\n              </div>\n\n              <div>\n                <InputAddress\n                  v-if=\"!$props.data\"\n                  label=\"Destino\"\n                  :onlyaddress=\"true\"\n                  :nomaps=\"true\"\n                  @selected=\"(e) => (to = e)\"\n                />\n              </div>\n            </div>\n\n            <div class=\"columns-3 mb-4\">\n              <div>\n                <VaInput\n                  v-model=\"form.baseprice\"\n                  v-only-digits\n                  label=\"Precio base de Servicio\"\n                  min=\"0\"\n                  @change=\"\n                    () => {\n                      form.baseprice = ceil(form.baseprice, 2)\n                    }\n                  \"\n                >\n                  <template #prependInner>\n                    <span class=\"px-0 -mx-1 font-bold text-sm\">S/</span>\n                  </template>\n                </VaInput>\n              </div>\n\n              <div>\n                <VaInput v-model=\"form.kilometers\" v-only-numbers label=\"Kilometros\" type=\"number\" min=\"0\" />\n              </div>\n\n              <div>\n                <VaInput v-model=\"form.hours\" v-only-numbers label=\"Horas de Viaje\" type=\"number\" min=\".5\" />\n              </div>\n            </div>\n\n            <hr />\n\n            <div class=\"columns-2 mt-4 gap-0\">\n              <div class=\"bg-gray-100 py-1\">\n                <p class=\"font-bold text-black text-sm text-center\">\n                  Peajes <span class=\"uppercase text-xs\">(Ida)</span>\n                  <VaIcon color=\"primary\" name=\"add_circle\" class=\"cursor-pointer ml-2\" @click=\"addNewFrom()\" />\n                </p>\n              </div>\n              <div class=\"bg-blue-100 py-1\">\n                <p class=\"font-bold text-black text-sm text-center\">\n                  Peajes <span class=\"uppercase text-xs\">(Vuelta)</span>\n                  <VaIcon color=\"primary\" name=\"add_circle\" class=\"cursor-pointer ml-2\" @click=\"addNewTo()\" />\n                </p>\n              </div>\n            </div>\n            <!--  -->\n            <div class=\"flex gap-0\">\n              <div class=\"flex flex-col w-1/2\">\n                <div v-for=\"(item, index) in fromTolls\" :key=\"item\" class=\"bg-gray-100 px-1 pb-1\">\n                  <div class=\"flex gap-1 toll\">\n                    <VaSelect\n                      v-model=\"item.q\"\n                      class=\"quantity text-xxs\"\n                      :options=\"vehicleTypes\"\n                      placeholder=\"Selecciona un tipo\"\n                      background=\"#fff\"\n                    />\n                    <VaInput\n                      v-model=\"item.amount\"\n                      v-only-digits\n                      type=\"text\"\n                      class=\"amount\"\n                      background=\"#fff\"\n                      @change=\"\n                        () => {\n                          item.amount = ceil(item.amount, 2)\n                        }\n                      \"\n                    >\n                      <template #append>\n                        <VaIcon\n                          name=\"delete\"\n                          class=\"cursor-pointer ml-1 relative -left-0.5 mr-1\"\n                          color=\"danger\"\n                          @click=\"deleteFrom(index)\"\n                        />\n                      </template>\n                    </VaInput>\n                  </div>\n                </div>\n              </div>\n              <div class=\"flex flex-col w-1/2\">\n                <div v-for=\"(item, index) in toTolls\" :key=\"item\" class=\"flex flex-col bg-blue-100 pl-1 pr-3 pb-1\">\n                  <div class=\"flex gap-1 toll\">\n                    <VaSelect\n                      v-model=\"item.q\"\n                      class=\"quantity text-xxs\"\n                      :options=\"vehicleTypes\"\n                      placeholder=\"Selecciona un tipo\"\n                      background=\"#fff\"\n                    />\n\n                    <VaInput\n                      v-model=\"item.amount\"\n                      v-only-digits\n                      type=\"text\"\n                      class=\"amount\"\n                      background=\"#fff\"\n                      @change=\"\n                        () => {\n                          item.amount = ceil(item.amount, 2)\n                        }\n                      \"\n                    >\n                      <template #append>\n                        <VaIcon\n                          name=\"delete\"\n                          class=\"cursor-pointer ml-1 relative -left-0.5 mr-1\"\n                          color=\"danger\"\n                          @click=\"deleteTo(index)\"\n                        />\n                      </template>\n                    </VaInput>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </VaForm>\n    </div>\n\n    <div>\n      <div class=\"flex justify-end\">\n        <div class=\"flex gap-2\">\n          <VaButton\n            icon=\"save\"\n            color=\"primary\"\n            :disabled=\"!isValid || (!$props.data?.id && (!from?.label || !to?.label))\"\n            :loading=\"isLoading\"\n            @click=\"doProcess\"\n          >\n            <span class=\"text-xs px-1\">Guardar</span>\n          </VaButton>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.new-customer {\n  &-tabs {\n    .va-tabs__content {\n      width: 100%;\n    }\n  }\n\n  .float-profile {\n    position: absolute;\n    top: 0;\n    right: 0;\n  }\n}\n\n.toll {\n  .quantity {\n    width: 90px;\n  }\n\n  .amount {\n    width: 110px;\n  }\n}\n</style>\n","<script lang=\"ts\" setup>\nimport { onMounted, ref } from 'vue'\nimport NewRoute from './NewRoute.vue'\nimport { deleteRoute, getAllRoutes } from '../../core/requests/Routes'\nimport { useToast } from 'vuestic-ui'\n\nconst { notify } = useToast()\n\nconst showNewRoute = ref(false)\nconst showNewToll = ref(false)\nconst showConfirm = ref(false)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst selected = ref(null)\nconst routes: any = ref([])\n\nconst closeModal = () => {\n  showNewRoute.value = false\n  showNewToll.value = false\n  getRoutes()\n}\n\nonMounted(() => {\n  getRoutes()\n})\n\nconst getRoutes = async () => {\n  isLoading.value = true\n  const _routes: any = await getAllRoutes()\n  routes.value = _routes\n  isLoading.value = false\n}\n\nconst doDelete = async () => {\n  showConfirm.value = false\n  await deleteRoute(selected.value)\n\n  notify({\n    message: 'Ruta eliminada correctamente',\n    color: 'success',\n  })\n\n  getRoutes()\n}\n\nconst needConfirm = (id: any) => {\n  selected.value = id\n  showConfirm.value = !!id\n}\n\nconst selectedRoute: any = ref(null)\nconst showUpdate = (data: any) => {\n  if (data) {\n    selectedRoute.value = data\n    showNewRoute.value = true\n  } else {\n    selectedRoute.value = data\n    showNewRoute.value = false\n  }\n}\n</script>\n\n<template>\n  <div class=\"flex flex-col space-y-6 md:space-y-4\">\n    <VaInnerLoading :loading=\"isLoading\">\n      <VaCard>\n        <VaCardTitle class=\"d-flex justify-between\">\n          Maestro de Rutas\n          <VaButton icon=\"add\" color=\"primary\" @click=\"showNewRoute = true\">\n            <span class=\"px-1\">Nueva Ruta</span>\n          </VaButton>\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"flex flex-col p-4 bg-backgroundSecondary rounded-lg\">\n            <div class=\"va-table-responsive\">\n              <table class=\"va-table w-full text-xs\">\n                <thead>\n                  <tr>\n                    <th>#</th>\n                    <th>Origen</th>\n                    <th>Destino</th>\n                    <th>Kilometros</th>\n                    <th>P. Base</th>\n                    <th>Horas</th>\n                    <th>Peajes</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"t in routes\" :key=\"t.id\">\n                    <td>{{ t.id }}</td>\n                    <td>{{ t.from }}</td>\n                    <td>{{ t.to }}</td>\n                    <td>{{ t.kilometers || '-' }}</td>\n                    <td>S/ {{ t.baseprice }}</td>\n                    <td>{{ t.travelhours || '-' }}</td>\n                    <td>\n                      <p v-if=\"!t.tolls.length\" class=\"m-0 font-bold text-xs\">Sin Información</p>\n\n                      <div v-if=\"t.tolls.length\" class=\"bg-blue-100 px-2 pb-2 pt-1 rounded-md\">\n                        <div v-if=\"t.tolls.filter((f: any) => f.type === 0).length\">\n                          <p class=\"text-xs font-bold mb-1 px-1\">Ida:</p>\n                          <VaBadge\n                            v-for=\"i in t.tolls.filter((f: any) => f.type === 0)\"\n                            :key=\"i\"\n                            :text=\"'(' + i.vehicle_type + ')' + ' S/' + i.amount\"\n                            color=\"primary\"\n                            class=\"mr-2\"\n                          />\n                        </div>\n                        <div v-if=\"t.tolls.filter((f: any) => f.type === 1).length\">\n                          <p class=\"text-xs font-bold mt-2 mb-1 px-1\">Vuelta:</p>\n                          <VaBadge\n                            v-for=\"i in t.tolls.filter((f: any) => f.type === 1)\"\n                            :key=\"i\"\n                            :text=\"'(' + i.vehicle_type + ')' + ' S/' + i.amount\"\n                            color=\"primary\"\n                            class=\"mr-2\"\n                          />\n                        </div>\n                      </div>\n                    </td>\n                    <td>\n                      <div class=\"flex gap-1\">\n                        <VaButton icon=\"edit\" color=\"primary\" round @click=\"showUpdate(t)\"></VaButton>\n                        <VaButton icon=\"delete\" color=\"danger\" round @click=\"needConfirm(t.id)\"></VaButton>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </VaInnerLoading>\n\n    <VaModal\n      v-model=\"showNewRoute\"\n      size=\"460px\"\n      close-button\n      hide-default-actions\n      no-dismiss\n      blur\n      @close=\"showUpdate(null)\"\n    >\n      <div>\n        <NewRoute :data=\"selectedRoute\" @close=\"closeModal\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas continuar?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["props","__props","vOnlyDigits","onlyNumbers","vOnlyNumbers","onlyNumbersNoDigits","emit","__emit","isLoading","ref","fromTolls","toTolls","isValid","validate","reset","useForm","form","reactive","from","to","onMounted","_a","_b","_c","f","doProcess","updateRoute","newRoute","e","addNewFrom","vehicleTypes","addNewTo","deleteFrom","index","deleteTo","notify","useToast","showNewRoute","showNewToll","showConfirm","isDeleting","selected","routes","closeModal","getRoutes","_routes","getAllRoutes","doDelete","deleteRoute","needConfirm","id","selectedRoute","showUpdate","data"],"mappings":"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"}