{"version":3,"file":"ListArchives-f85da9dc.js","sources":["../../src/pages/customers/pages/ListArchives.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport NewCustomer from './NewCustomer.vue'\nimport { useI18n } from 'vue-i18n'\nimport { getAllContacts, deleteContact, archiveContact } from '../../../core/requests/Contacts'\nimport { useToast } from 'vuestic-ui'\nimport EditCustomer from './EditCustomer.vue'\nimport { format } from 'date-fns'\nimport NewOportunity from '../../oportunities/pages/NewOportunity.vue'\nimport NewCompany from './NewCompany.vue'\nimport { HOST } from '../../../core/constants'\n\nconst { notify } = useToast()\n\nconst items = ref([])\nconst showNewCustomer = ref(false)\nconst showNewCompany = ref(false)\nconst showViewCustomer = ref(false)\nconst showConfirm = ref(false)\nconst contactSelected: any = ref(null)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst showNewOportunity = ref(false)\nconst filteredCount = ref(0)\nconst perPage = ref(12)\nconst currentPage = ref(1)\nconst inputSearch = ref('')\nconst { t } = useI18n()\nconst columns = [\n  { key: 'id', sortable: false },\n  { key: 'Nombres Completos', sortable: false },\n  { key: 'Empresa', sortable: false },\n  { key: 'Documento', sortable: false },\n  { key: 'Teléfono', sortable: false },\n  { key: 'Fecha Archivación', sortable: false },\n  { key: 'Fecha Creación', sortable: false },\n  { key: 'Acciones', width: 80, sortable: false },\n]\n\nconst params = ref({\n  status: 99,\n})\n\nonMounted(() => {\n  getContacts(params.value)\n})\n\nconst getContacts = async (params?: any) => {\n  isLoading.value = true\n  const contacts: any = await getAllContacts(params)\n  items.value = contacts.map((i: any) => ({\n    ...i,\n    'Nombres Completos': i.fullname,\n    Empresa: i.company?.ruc,\n    Documento: i.document,\n    Teléfono: i.cellphone,\n    'Fecha Archivación': i.archived_at && format(i.archived_at, 'dd/MM/yyyy hh:mm aa'),\n    'Fecha Creación': i.created_at && format(i.created_at, 'dd/MM/yyyy hh:mm aa'),\n    Acciones: true,\n    activeTab: 0,\n  }))\n  isLoading.value = false\n}\nconst viewDetail = (id: any) => {\n  showViewCustomer.value = id ? true : false\n  contactSelected.value = id\n}\nconst needConfirm = (id: any) => {\n  showConfirm.value = id ? true : false\n  contactSelected.value = id\n}\nconst onClosed = () => {\n  showNewCustomer.value = false\n  showViewCustomer.value = false\n  getContacts(params.value)\n}\nconst doDelete = async () => {\n  isDeleting.value = true\n  await deleteContact(contactSelected.value)\n  notify({\n    message: 'Cliente eliminado correctamente',\n    color: 'success',\n    duration: 1000,\n  })\n  setTimeout(() => {\n    isDeleting.value = false\n    needConfirm(null)\n    getContacts(params.value)\n  })\n}\n\nconst pages = () => {\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\n}\n// const doFilterByRange = () => {\n//   const { start, end } = startDate.value\n//   if (start && end) {\n//     const fromDate = new Date(start).setHours(24)\n//     const toDate = new Date(end).setHours(24)\n\n//     getContacts({\n//       start: new Date(fromDate).getTime(),\n//       end: new Date(toDate).getTime(),\n//       ...params.value,\n//     })\n//   }\n// }\nconst isDownloading = ref(false)\nconst download = () => {\n  isDownloading.value = true\n  setTimeout(() => {\n    isDownloading.value = false\n  }, 2000)\n  console.log('download')\n}\nconst isProcessing = ref(false)\nconst showConfirmArchive = ref(false)\nconst needConfirmArchive = (id: any) => {\n  showConfirmArchive.value = id ? true : false\n  contactSelected.value = id\n}\nconst doArchive = async () => {\n  await archiveContact(contactSelected.value)\n  items.value = items.value.filter((f: any) => f.id !== contactSelected.value)\n  contactSelected.value = null\n  showConfirmArchive.value = false\n  notify({\n    message: 'Cliente actualizado correctamente',\n    color: 'success',\n    duration: 1000,\n  })\n}\n</script>\n\n<template>\n  <div class=\"py-4\">\n    <div class=\"flex justify-between align-center justify-center\">\n      <h1 class=\"h5 m-0\">{{ t('contacts.allArchivedContacts') }} ({{ items.length }})</h1>\n      <div class=\"flex gap-2\">\n        <VaButton\n          icon=\"exit_to_app\"\n          color=\"info\"\n          :loading=\"isDownloading\"\n          :href=\"HOST + '/contacts/archived/xls'\"\n          @click=\"download\"\n        >\n          <span class=\"px-1\">Descargar</span>\n        </VaButton>\n      </div>\n    </div>\n    <div class=\"mt-5\">\n      <div class=\"columns-1 sm:columns-5 mb-7\">\n        <div>\n          <VaInput\n            v-model=\"inputSearch\"\n            :label=\"t('contacts.search')\"\n            placeholder=\"Escribe lo que buscas\"\n            clearable\n            background=\"#fff\"\n          />\n        </div>\n      </div>\n\n      <div class=\"w-full bg-white p-2\">\n        <VaDataTable\n          :items=\"items\"\n          :columns=\"columns\"\n          class=\"text-xs\"\n          hoverable\n          selected-color=\"#eee\"\n          :filter=\"inputSearch\"\n          :per-page=\"perPage\"\n          :current-page=\"currentPage\"\n          :loading=\"isLoading\"\n          :no-data-html=\"'...'\"\n          @filtered=\"filteredCount = $event.items.length\"\n        >\n          <template #cell(Acciones)=\"{ row, isExpanded }\">\n            <div class=\"flex gap-1\">\n              <VaButton icon=\"delete\" color=\"danger\" round @click=\"needConfirm(row?.rowData?.id)\"></VaButton>\n              <VaButton icon=\"unarchive\" color=\"success\" round @click=\"needConfirmArchive(row?.rowData?.id)\"></VaButton>\n              <VaButton icon=\"description\" color=\"#158de3\" round @click=\"viewDetail(row?.rowData?.id)\"></VaButton>\n              <VaButton\n                :icon=\"isExpanded ? 'va-arrow-up' : 'va-arrow-down'\"\n                preset=\"primary\"\n                @click=\"row.toggleRowDetails()\"\n              >\n              </VaButton>\n            </div>\n          </template>\n\n          <template #cell(Empresa)=\"{ row }\">\n            <span class=\"font-bold text-primary\">{{ row.rowData?.company?.ruc }}</span>\n          </template>\n\n          <template #expandableRow=\"{ rowData }\">\n            <div class=\"flex px-2 py-3 gap-2 bg-blue-50 mx-10 rounded my-2\">\n              <div class=\"w-full pl-2\">\n                <div class=\"gap-1\">\n                  <span class=\"text-base font-medium\">\n                    <span class=\"uppercase font-black\">{{ rowData['Nombres Completos'] }}</span>\n                  </span>\n                </div>\n                <div class=\"w-full columns-6 mt-2 mb-1\">\n                  <div v-if=\"rowData.Documento\" class=\"w-full items-center text-xs\">\n                    <b>DNI:</b> <br />\n                    <span>\n                      {{ rowData.Documento }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.ruc\" class=\"w-full items-center text-xs\">\n                    <b>RUC:</b> <br />\n                    <span>\n                      {{ rowData.ruc }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.cellphone\" class=\"w-full items-center text-xs\">\n                    <b>Teléfono:</b> <br />\n                    <span>\n                      {{ rowData.cellphone }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.whatsapp\" class=\"w-full items-center text-xs\">\n                    <b>WhatsApp:</b> <br />\n                    <span>\n                      {{ rowData.whatsapp }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.email\" class=\"w-full items-center text-xs\">\n                    <b>Correo Electrónico:</b> <br />\n                    <span>\n                      {{ rowData.email }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                </div>\n\n                <div class=\"flex flex-col bg-white mt-6 py-2 pb-5 px-4\">\n                  <VaTabs v-model=\"rowData.activeTab\">\n                    <template #tabs>\n                      <!-- <VaTab v-for=\"tab in ['Empresa', 'Cotizaciones', 'Ordenes de Trabajo']\" :key=\"tab\">\n                        {{ tab }}\n                      </VaTab> -->\n\n                      <VaTab v-for=\"tab in ['Empresa']\" :key=\"tab\">\n                        {{ tab }}\n                      </VaTab>\n                    </template>\n                  </VaTabs>\n\n                  <div v-if=\"rowData.activeTab === 1\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\n                    <p v-if=\"!rowData.quotations?.length\" class=\"bg-red-300 font-bold p-2 -mb-1\">\n                      El cliente no tiene cotizaciones\n                    </p>\n\n                    <div v-if=\"rowData.quotations?.length\" class=\"va-table-responsive w-full\">\n                      <table class=\"va-table w-full\">\n                        <thead>\n                          <tr>\n                            <th>n° Cotización</th>\n                            <th>Comercial</th>\n                            <th>Servicios</th>\n                            <th>Vehiculos</th>\n                            <th>Fecha Creación</th>\n                            <th>Estado</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr v-for=\"user in rowData.quotations\" :key=\"user.id\">\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n\n                  <div v-if=\"rowData.activeTab === 2\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\n                    <p class=\"bg-red-300 font-bold p-2\">El cliente no tiene ordenes de trabajo</p>\n\n                    <div class=\"va-table-responsive w-full\">\n                      <table class=\"va-table w-full\">\n                        <thead>\n                          <tr>\n                            <th>n° Orden</th>\n                            <th>Responsable</th>\n                            <th>Servicios</th>\n                            <th>Vehiculos</th>\n                            <th>Fecha Inicio</th>\n                            <th>Fecha Fin</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <!-- <tr v-for=\"user in []\" :key=\"user.id\">\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                          </tr> -->\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n\n                  <div v-if=\"rowData.activeTab === 0\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\n                    <p v-if=\"!rowData.company\" class=\"bg-red-300 font-bold p-2 -mb-1\">\n                      El cliente no está asociado a empresa\n                    </p>\n\n                    <div v-if=\"rowData.company\" class=\"va-table-responsive w-full\">\n                      <table class=\"va-table w-full\">\n                        <thead>\n                          <tr>\n                            <th>Razón Social</th>\n                            <th>RUC</th>\n                            <th>Teléfono</th>\n                            <th>WhatsApp</th>\n                            <th>Fecha Creación</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr>\n                            <td>{{ rowData.company?.socialreason }}</td>\n                            <td>{{ rowData.company?.ruc }}</td>\n                            <td>{{ rowData.company?.phone }}</td>\n                            <td>{{ rowData.company?.whatsapp }}</td>\n                            <td>{{ rowData.company?.created_at }}</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </template>\n\n          <template #bodyAppend>\n            <tr>\n              <td colspan=\"8\">\n                <div class=\"flex justify-end mt-4\">\n                  <VaPagination\n                    v-model=\"currentPage\"\n                    size=\"small\"\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\n                    buttons-preset=\"primary\"\n                    active-page-color=\"textPrimary\"\n                    :pages=\"pages()\"\n                  />\n                </div>\n              </td>\n            </tr>\n          </template>\n        </VaDataTable>\n\n        <VaAlert v-if=\"false\" class=\"!mt-6 py-1 text-xs\" color=\"info\">\n          Cantidad de resultados:\n          <VaChip class=\"text-xs font-bold ml-1 px-0\" color=\"#fff\">{{ filteredCount }}</VaChip>\n        </VaAlert>\n      </div>\n    </div>\n\n    <VaModal v-model=\"showNewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\n      <div>\n        <NewCompany @close=\"showNewCompany = false\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showNewCustomer\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\n      <div class=\"mt-4\">\n        <NewCustomer @close=\"onClosed\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirmArchive\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas activar este cliente?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirmArchive(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isProcessing\" @click=\"doArchive\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n\n    <VaModal v-model=\"showViewCustomer\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\n      <div class=\"mt-4\">\n        <EditCustomer :id=\"contactSelected\" @close=\"onClosed\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showNewOportunity\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\n      <div class=\"mt-4\">\n        <NewOportunity />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas eliminar este cliente?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["notify","useToast","items","ref","showNewCustomer","showNewCompany","showViewCustomer","showConfirm","contactSelected","isDeleting","isLoading","showNewOportunity","filteredCount","perPage","currentPage","inputSearch","t","useI18n","columns","params","onMounted","getContacts","contacts","getAllContacts","i","_a","format","viewDetail","id","needConfirm","onClosed","doDelete","deleteContact","pages","isDownloading","download","isProcessing","showConfirmArchive","needConfirmArchive","doArchive","archiveContact","f"],"mappings":"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"}