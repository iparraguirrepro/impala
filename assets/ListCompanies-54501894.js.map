{"version":3,"file":"ListCompanies-54501894.js","sources":["../../src/pages/customers/pages/ListCompanies.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { useToast } from 'vuestic-ui'\nimport { format } from 'date-fns'\nimport NewCompany from './NewCompany.vue'\nimport { deleteCompany, getAllCompanies } from '../../../core/requests/Company'\nimport EditCustomer from './EditCustomer.vue'\nimport { HOST } from '../../../core/constants'\n\nconst { notify } = useToast()\n\nconst items = ref([])\nconst showNewCompany = ref(false)\nconst showViewCompany: any = ref(null)\nconst showConfirm = ref(false)\nconst contactSelected: any = ref(null)\nconst contactId: any = ref(null)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst showViewContact = ref(false)\nconst filteredCount = ref(0)\nconst perPage = ref(12)\nconst currentPage = ref(1)\nconst inputSearch = ref('')\nconst { t } = useI18n()\nconst columns = [\n  { key: 'id', sortable: false },\n  { key: 'Razón Social', sortable: false },\n  { key: 'RUC', sortable: false },\n  { key: 'Teléfono', sortable: false },\n  { key: 'Whatsapp', sortable: false },\n  { key: 'Fecha Creación', sortable: false },\n  { key: 'Acciones', width: 80, sortable: false },\n]\n\nconst params = ref({\n  status: 1,\n})\n\nonMounted(() => {\n  getCompanies(params.value)\n})\n\nconst getCompanies = async (params?: any) => {\n  isLoading.value = true\n  const contacts: any = await getAllCompanies(params)\n  items.value = contacts.map((i: any) => ({\n    ...i,\n    'Razón Social': i.socialreason,\n    RUC: i.ruc,\n    Teléfono: i.phone,\n    Whatsapp: i.whatsapp,\n    'Fecha Creación': i.created_at && format(i.created_at, 'dd/MM/yyyy hh:mm aa'),\n    Acciones: true,\n    activeTab: 0,\n  }))\n  isLoading.value = false\n}\nconst viewDetail = (data: any) => {\n  showViewCompany.value = data\n}\nconst needConfirm = (data: any) => {\n  if (!data) {\n    showConfirm.value = false\n    contactSelected.value = null\n  } else {\n    if (!data.contacts?.length) {\n      showConfirm.value = data?.id ? true : false\n      contactSelected.value = data?.id\n    } else {\n      notify({\n        message: 'No puedes eliminar una empresa con contactos activos.',\n        color: 'error',\n        duration: 3000,\n      })\n    }\n  }\n}\nconst closeNewCompany = () => {\n  showNewCompany.value = false\n  showViewCompany.value = false\n  getCompanies(params.value)\n}\nconst doDelete = async () => {\n  isDeleting.value = true\n  await deleteCompany(contactSelected.value)\n  notify({\n    message: 'Empresa eliminada correctamente',\n    color: 'success',\n    duration: 1000,\n  })\n  setTimeout(() => {\n    isDeleting.value = false\n    needConfirm(null)\n    getCompanies(params.value)\n  })\n}\nconst pages = () => {\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\n}\n// const doFilterByRange = () => {\n//   console.log(startDate.value)\n//   const { start, end } = startDate.value\n//   if (start && end) {\n//     const fromDate = new Date(start).setHours(24)\n//     const toDate = new Date(end).setHours(24)\n\n//     getCompanies({\n//       start: new Date(fromDate).getTime(),\n//       end: new Date(toDate).getTime(),\n//       ...params.value,\n//     })\n//   }\n// }\nconst isDownloading = ref(false)\nconst download = () => {\n  isDownloading.value = true\n  setTimeout(() => {\n    isDownloading.value = false\n  }, 2000)\n  console.log('download')\n}\n</script>\n\n<template>\n  <div class=\"py-4\">\n    <div class=\"flex flex-wrap sm:flex-nowrap justify-between align-center justify-center\">\n      <h1 class=\"h5 m-0 mb-3 sm:mb-0\">Listado de Empresas ({{ items.length }})</h1>\n      <div class=\"flex flex-wrap sm:flex-nowrap gap-2\">\n        <VaButton\n          icon=\"exit_to_app\"\n          color=\"info\"\n          :loading=\"isDownloading\"\n          :href=\"HOST + '/companies/xls'\"\n          @click=\"download\"\n        >\n          <span class=\"px-1\">Descargar</span>\n        </VaButton>\n\n        <VaButton icon=\"domain_add\" color=\"primary\" @click=\"showNewCompany = true\">\n          <span class=\"px-1\">{{ t('contacts.newCompany') }}</span>\n        </VaButton>\n      </div>\n    </div>\n    <div class=\"mt-5\">\n      <div class=\"columns-1 sm:columns-5 mb-7\">\n        <div>\n          <VaInput\n            v-model=\"inputSearch\"\n            label=\"Buscar empresa\"\n            placeholder=\"Escribe lo que buscas\"\n            clearable\n            background=\"#fff\"\n          />\n        </div>\n      </div>\n\n      <div class=\"w-full bg-white p-2\">\n        <VaDataTable\n          :items=\"items\"\n          :columns=\"columns\"\n          class=\"text-xs\"\n          hoverable\n          selected-color=\"#eee\"\n          :filter=\"inputSearch\"\n          :per-page=\"perPage\"\n          :current-page=\"currentPage\"\n          :loading=\"isLoading\"\n          :no-data-html=\"'...'\"\n          @filtered=\"filteredCount = $event.items.length\"\n        >\n          <template #cell(Acciones)=\"{ row, isExpanded }\">\n            <div class=\"flex gap-1\">\n              <VaButton\n                icon=\"delete\"\n                color=\"danger\"\n                :disabled=\"row.itemKey.contacts.length\"\n                round\n                @click=\"needConfirm(row?.rowData)\"\n              ></VaButton>\n              <VaButton icon=\"edit\" color=\"#158de3\" round @click=\"viewDetail(row?.rowData)\"></VaButton>\n              <VaButton\n                :icon=\"isExpanded ? 'va-arrow-up' : 'va-arrow-down'\"\n                preset=\"primary\"\n                @click=\"row.toggleRowDetails()\"\n              >\n              </VaButton>\n            </div>\n          </template>\n\n          <template #expandableRow=\"{ rowData }\">\n            <div class=\"flex px-2 py-3 gap-2 bg-blue-50 mx-10 rounded my-2\">\n              <div class=\"w-full pl-2\">\n                <div class=\"gap-1\">\n                  <span class=\"text-base font-medium\">\n                    <span class=\"uppercase font-black\">{{ rowData.socialreason }}</span>\n                  </span>\n                </div>\n                <div class=\"w-full columns-6 mt-2 mb-1\">\n                  <div v-if=\"rowData.ruc\" class=\"w-full items-center text-xs\">\n                    <b>RUC:</b> <br />\n                    <span>\n                      {{ rowData.ruc }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.phone\" class=\"w-full items-center text-xs\">\n                    <b>Teléfono:</b> <br />\n                    <span>\n                      {{ rowData.phone }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.whatsapp\" class=\"w-full items-center text-xs\">\n                    <b>WhatsApp:</b> <br />\n                    <span>\n                      {{ rowData.whatsapp }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                  <div v-if=\"rowData.address\" class=\"w-full items-center text-xs\">\n                    <b>Dirección:</b> <br />\n                    <span>\n                      {{ rowData.address }}\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\n                    </span>\n                  </div>\n                </div>\n\n                <div class=\"flex flex-col bg-white mt-6 py-2 pb-5 px-4\">\n                  <VaTabs v-model=\"rowData.activeTab\">\n                    <template #tabs>\n                      <VaTab v-for=\"tab in ['Contactos', 'Cotizaciones']\" :key=\"tab\">\n                        {{ tab }}\n                      </VaTab>\n                    </template>\n                  </VaTabs>\n\n                  <div v-if=\"rowData.activeTab === 1\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\n                    <p v-if=\"!rowData.quotations?.length\" class=\"bg-red-300 font-bold p-2 -mb-1\">\n                      El cliente no tiene cotizaciones\n                    </p>\n\n                    <div v-if=\"rowData.quotations?.length\" class=\"va-table-responsive w-full\">\n                      <table class=\"va-table w-full\">\n                        <thead>\n                          <tr>\n                            <th>n° Cotización</th>\n                            <th>Comercial</th>\n                            <th>Servicios</th>\n                            <th>Vehiculos</th>\n                            <th>Fecha Creación</th>\n                            <th>Estado</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr v-for=\"user in rowData.quotations\" :key=\"user.id\">\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                            <td>{{ user.fullName }}</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n\n                  <div v-if=\"rowData.activeTab === 0\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\n                    <p v-if=\"!rowData.contacts?.length\" class=\"bg-red-300 font-bold p-2\">\n                      La empresa no tiene contactos registrados\n                    </p>\n\n                    <div v-if=\"rowData.contacts?.length\" class=\"va-table-responsive w-full\">\n                      <table class=\"va-table w-full\">\n                        <thead>\n                          <tr>\n                            <th>Nombres Completos</th>\n                            <th>Documento</th>\n                            <th>Teléfono</th>\n                            <th>Correo</th>\n                          </tr>\n                        </thead>\n                        <tbody>\n                          <tr v-for=\"user in rowData.contacts\" :key=\"user.id\">\n                            <td>\n                              <span\n                                class=\"text-primary font-bold uppercase cursor-pointer hover:underline\"\n                                @click=\"\n                                  () => {\n                                    contactId = user.id\n                                    showViewContact = true\n                                  }\n                                \"\n                              >\n                                {{ user.fullname }}\n                              </span>\n                            </td>\n                            <td>{{ user.document }}</td>\n                            <td>{{ user.cellphone }}</td>\n                            <td>{{ user.email }}</td>\n                          </tr>\n                        </tbody>\n                      </table>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </template>\n\n          <template #bodyAppend>\n            <tr>\n              <td colspan=\"7\">\n                <div class=\"flex justify-end mt-4\">\n                  <VaPagination\n                    v-model=\"currentPage\"\n                    size=\"small\"\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\n                    buttons-preset=\"primary\"\n                    active-page-color=\"textPrimary\"\n                    :pages=\"pages()\"\n                  />\n                </div>\n              </td>\n            </tr>\n          </template>\n        </VaDataTable>\n\n        <VaAlert v-if=\"false\" class=\"!mt-6 py-1 text-xs\" color=\"info\">\n          Cantidad de resultados:\n          <VaChip class=\"text-xs font-bold ml-1 px-0\" color=\"#fff\">{{ filteredCount }}</VaChip>\n        </VaAlert>\n      </div>\n    </div>\n\n    <VaModal v-model=\"showNewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\n      <div>\n        <NewCompany @close=\"closeNewCompany\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showViewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\n      <div>\n        <NewCompany :data=\"showViewCompany\" @close=\"closeNewCompany\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showViewContact\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\n      <div class=\"mt-4\">\n        <EditCustomer\n          :id=\"contactId\"\n          @close=\"\n            () => {\n              contactId = null\n              showViewContact = false\n            }\n          \"\n        />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas eliminar esta empresa?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["notify","useToast","items","ref","showNewCompany","showViewCompany","showConfirm","contactSelected","contactId","isDeleting","isLoading","showViewContact","filteredCount","perPage","currentPage","inputSearch","t","useI18n","columns","params","onMounted","getCompanies","contacts","getAllCompanies","i","format","viewDetail","data","needConfirm","_a","closeNewCompany","doDelete","deleteCompany","pages","isDownloading","download"],"mappings":"utEAUM,KAAA,CAAE,OAAAA,GAAWC,KAEbC,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAiBD,EAAI,EAAK,EAC1BE,EAAuBF,EAAI,IAAI,EAC/BG,EAAcH,EAAI,EAAK,EACvBI,EAAuBJ,EAAI,IAAI,EAC/BK,EAAiBL,EAAI,IAAI,EACzBM,EAAaN,EAAI,EAAK,EACtBO,EAAYP,EAAI,EAAK,EACrBQ,EAAkBR,EAAI,EAAK,EAC3BS,EAAgBT,EAAI,CAAC,EACrBU,EAAUV,EAAI,EAAE,EAChBW,EAAcX,EAAI,CAAC,EACnBY,EAAcZ,EAAI,EAAE,EACpB,CAAE,EAAAa,GAAMC,KACRC,EAAU,CACd,CAAE,IAAK,KAAM,SAAU,EAAM,EAC7B,CAAE,IAAK,eAAgB,SAAU,EAAM,EACvC,CAAE,IAAK,MAAO,SAAU,EAAM,EAC9B,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,iBAAkB,SAAU,EAAM,EACzC,CAAE,IAAK,WAAY,MAAO,GAAI,SAAU,EAAM,CAAA,EAG1CC,EAAShB,EAAI,CACjB,OAAQ,CAAA,CACT,EAEDiB,GAAU,IAAM,CACdC,EAAaF,EAAO,KAAK,CAAA,CAC1B,EAEK,MAAAE,EAAe,MAAOF,GAAiB,CAC3CT,EAAU,MAAQ,GACZ,MAAAY,EAAgB,MAAMC,GAAgBJ,CAAM,EAClDjB,EAAM,MAAQoB,EAAS,IAAKE,IAAY,CACtC,GAAGA,EACH,eAAgBA,EAAE,aAClB,IAAKA,EAAE,IACP,SAAUA,EAAE,MACZ,SAAUA,EAAE,SACZ,iBAAkBA,EAAE,YAAcC,GAAOD,EAAE,WAAY,qBAAqB,EAC5E,SAAU,GACV,UAAW,CACX,EAAA,EACFd,EAAU,MAAQ,EAAA,EAEdgB,EAAcC,GAAc,CAChCtB,EAAgB,MAAQsB,CAAA,EAEpBC,EAAeD,GAAc,OAC5BA,GAIEE,EAAAF,EAAK,WAAL,MAAAE,EAAe,OAIX7B,EAAA,CACL,QAAS,wDACT,MAAO,QACP,SAAU,GAAA,CACX,GAPWM,EAAA,MAAQ,GAAAqB,GAAA,MAAAA,EAAM,IAC1BpB,EAAgB,MAAQoB,GAAA,YAAAA,EAAM,KALhCrB,EAAY,MAAQ,GACpBC,EAAgB,MAAQ,KAY1B,EAEIuB,EAAkB,IAAM,CAC5B1B,EAAe,MAAQ,GACvBC,EAAgB,MAAQ,GACxBgB,EAAaF,EAAO,KAAK,CAAA,EAErBY,EAAW,SAAY,CAC3BtB,EAAW,MAAQ,GACb,MAAAuB,GAAczB,EAAgB,KAAK,EAClCP,EAAA,CACL,QAAS,kCACT,MAAO,UACP,SAAU,GAAA,CACX,EACD,WAAW,IAAM,CACfS,EAAW,MAAQ,GACnBmB,EAAY,IAAI,EAChBP,EAAaF,EAAO,KAAK,CAAA,CAC1B,CAAA,EAEGc,EAAQ,IACLpB,EAAQ,OAASA,EAAQ,QAAU,EAAI,KAAK,KAAKX,EAAM,MAAM,OAASW,EAAQ,KAAK,EAAIX,EAAM,MAAM,OAgBtGgC,EAAgB/B,EAAI,EAAK,EACzBgC,EAAW,IAAM,CACrBD,EAAc,MAAQ,GACtB,WAAW,IAAM,CACfA,EAAc,MAAQ,IACrB,GAAI,EACP,QAAQ,IAAI,UAAU,CAAA"}