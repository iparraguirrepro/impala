{"version":3,"file":"ListCompanies-d2f55621.js","sources":["../../src/pages/customers/pages/ListCompanies.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { onMounted, ref } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { useToast } from 'vuestic-ui'\r\nimport { format } from 'date-fns'\r\nimport NewCompany from './NewCompany.vue'\r\nimport { deleteCompany, getAllCompanies } from '../../../core/requests/Company'\r\nimport EditCustomer from './EditCustomer.vue'\r\nimport { HOST } from '../../../core/constants'\r\n\r\nconst { notify } = useToast()\r\n\r\nconst items = ref([])\r\nconst showNewCompany = ref(false)\r\nconst showViewCompany: any = ref(null)\r\nconst showConfirm = ref(false)\r\nconst contactSelected: any = ref(null)\r\nconst contactId: any = ref(null)\r\nconst isDeleting = ref(false)\r\nconst isLoading = ref(false)\r\nconst showViewContact = ref(false)\r\nconst filteredCount = ref(0)\r\nconst perPage = ref(12)\r\nconst currentPage = ref(1)\r\nconst inputSearch = ref('')\r\nconst { t } = useI18n()\r\nconst columns = [\r\n  { key: 'id', sortable: false },\r\n  { key: 'Razón Social', sortable: false },\r\n  { key: 'RUC', sortable: false },\r\n  { key: 'Teléfono', sortable: false },\r\n  { key: 'Whatsapp', sortable: false },\r\n  { key: 'Fecha Creación', sortable: false },\r\n  { key: 'Acciones', width: 80, sortable: false },\r\n]\r\n\r\nconst params = ref({\r\n  status: 1,\r\n})\r\n\r\nonMounted(() => {\r\n  getCompanies(params.value)\r\n})\r\n\r\nconst getCompanies = async (params?: any) => {\r\n  isLoading.value = true\r\n  const contacts: any = await getAllCompanies(params)\r\n  items.value = contacts.map((i: any) => ({\r\n    ...i,\r\n    'Razón Social': i.socialreason,\r\n    RUC: i.ruc,\r\n    Teléfono: i.phone,\r\n    Whatsapp: i.whatsapp,\r\n    'Fecha Creación': i.created_at && format(i.created_at, 'dd/MM/yyyy hh:mm aa'),\r\n    Acciones: true,\r\n    activeTab: 0,\r\n  }))\r\n  isLoading.value = false\r\n}\r\nconst viewDetail = (data: any) => {\r\n  showViewCompany.value = data\r\n}\r\nconst needConfirm = (data: any) => {\r\n  if (!data) {\r\n    showConfirm.value = false\r\n    contactSelected.value = null\r\n  } else {\r\n    if (!data.contacts?.length) {\r\n      showConfirm.value = data?.id ? true : false\r\n      contactSelected.value = data?.id\r\n    } else {\r\n      notify({\r\n        message: 'No puedes eliminar una empresa con contactos activos.',\r\n        color: 'error',\r\n        duration: 3000,\r\n      })\r\n    }\r\n  }\r\n}\r\nconst closeNewCompany = () => {\r\n  showNewCompany.value = false\r\n  showViewCompany.value = false\r\n  getCompanies(params.value)\r\n}\r\nconst doDelete = async () => {\r\n  isDeleting.value = true\r\n  await deleteCompany(contactSelected.value)\r\n  notify({\r\n    message: 'Empresa eliminada correctamente',\r\n    color: 'success',\r\n    duration: 1000,\r\n  })\r\n  setTimeout(() => {\r\n    isDeleting.value = false\r\n    needConfirm(null)\r\n    getCompanies(params.value)\r\n  })\r\n}\r\nconst pages = () => {\r\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\r\n}\r\n// const doFilterByRange = () => {\r\n//   console.log(startDate.value)\r\n//   const { start, end } = startDate.value\r\n//   if (start && end) {\r\n//     const fromDate = new Date(start).setHours(24)\r\n//     const toDate = new Date(end).setHours(24)\r\n\r\n//     getCompanies({\r\n//       start: new Date(fromDate).getTime(),\r\n//       end: new Date(toDate).getTime(),\r\n//       ...params.value,\r\n//     })\r\n//   }\r\n// }\r\nconst isDownloading = ref(false)\r\nconst download = () => {\r\n  isDownloading.value = true\r\n  setTimeout(() => {\r\n    isDownloading.value = false\r\n  }, 2000)\r\n  console.log('download')\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"py-4\">\r\n    <div class=\"flex justify-between align-center justify-center\">\r\n      <h1 class=\"h5 m-0\">Listado de Empresas ({{ items.length }})</h1>\r\n      <div class=\"flex gap-2\">\r\n        <VaButton\r\n          icon=\"exit_to_app\"\r\n          color=\"info\"\r\n          :loading=\"isDownloading\"\r\n          :href=\"HOST + '/companies/xls'\"\r\n          @click=\"download\"\r\n        >\r\n          <span class=\"px-1\">Descargar</span>\r\n        </VaButton>\r\n\r\n        <VaButton icon=\"domain_add\" color=\"primary\" @click=\"showNewCompany = true\">\r\n          <span class=\"px-1\">{{ t('contacts.newCompany') }}</span>\r\n        </VaButton>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt-5\">\r\n      <div class=\"columns-5 mb-7\">\r\n        <div>\r\n          <VaInput\r\n            v-model=\"inputSearch\"\r\n            label=\"Buscar empresa\"\r\n            placeholder=\"Escribe lo que buscas\"\r\n            clearable\r\n            background=\"#fff\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"w-full bg-white p-2\">\r\n        <VaDataTable\r\n          :items=\"items\"\r\n          :columns=\"columns\"\r\n          class=\"text-xs\"\r\n          hoverable\r\n          selected-color=\"#eee\"\r\n          :filter=\"inputSearch\"\r\n          :per-page=\"perPage\"\r\n          :current-page=\"currentPage\"\r\n          :loading=\"isLoading\"\r\n          :no-data-html=\"'...'\"\r\n          @filtered=\"filteredCount = $event.items.length\"\r\n        >\r\n          <template #cell(Acciones)=\"{ row, isExpanded }\">\r\n            <div class=\"flex gap-1\">\r\n              <VaButton\r\n                icon=\"delete\"\r\n                color=\"danger\"\r\n                :disabled=\"row.itemKey.contacts.length\"\r\n                round\r\n                @click=\"needConfirm(row?.rowData)\"\r\n              ></VaButton>\r\n              <VaButton icon=\"edit\" color=\"#158de3\" round @click=\"viewDetail(row?.rowData)\"></VaButton>\r\n              <VaButton\r\n                :icon=\"isExpanded ? 'va-arrow-up' : 'va-arrow-down'\"\r\n                preset=\"primary\"\r\n                @click=\"row.toggleRowDetails()\"\r\n              >\r\n              </VaButton>\r\n            </div>\r\n          </template>\r\n\r\n          <template #expandableRow=\"{ rowData }\">\r\n            <div class=\"flex px-2 py-3 gap-2 bg-blue-50 mx-10 rounded my-2\">\r\n              <div class=\"w-full pl-2\">\r\n                <div class=\"gap-1\">\r\n                  <span class=\"text-base font-medium\">\r\n                    <span class=\"uppercase font-black\">{{ rowData.socialreason }}</span>\r\n                  </span>\r\n                </div>\r\n                <div class=\"w-full columns-6 mt-2 mb-1\">\r\n                  <div v-if=\"rowData.ruc\" class=\"w-full items-center text-xs\">\r\n                    <b>RUC:</b> <br />\r\n                    <span>\r\n                      {{ rowData.ruc }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.phone\" class=\"w-full items-center text-xs\">\r\n                    <b>Teléfono:</b> <br />\r\n                    <span>\r\n                      {{ rowData.phone }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.whatsapp\" class=\"w-full items-center text-xs\">\r\n                    <b>WhatsApp:</b> <br />\r\n                    <span>\r\n                      {{ rowData.whatsapp }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.address\" class=\"w-full items-center text-xs\">\r\n                    <b>Dirección:</b> <br />\r\n                    <span>\r\n                      {{ rowData.address }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"flex flex-col bg-white mt-6 py-2 pb-5 px-4\">\r\n                  <VaTabs v-model=\"rowData.activeTab\">\r\n                    <template #tabs>\r\n                      <VaTab v-for=\"tab in ['Contactos']\" :key=\"tab\">\r\n                        {{ tab }}\r\n                      </VaTab>\r\n                    </template>\r\n                  </VaTabs>\r\n\r\n                  <div v-if=\"rowData.activeTab === 0\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\r\n                    <p v-if=\"!rowData.contacts?.length\" class=\"bg-red-300 font-bold p-2\">\r\n                      La empresa no tiene contactos registrados\r\n                    </p>\r\n\r\n                    <div v-if=\"rowData.contacts?.length\" class=\"va-table-responsive w-full\">\r\n                      <table class=\"va-table w-full\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>Nombres Completos</th>\r\n                            <th>Documento</th>\r\n                            <th>Teléfono</th>\r\n                            <th>Correo</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <tr v-for=\"user in rowData.contacts\" :key=\"user.id\">\r\n                            <td>\r\n                              <span\r\n                                class=\"text-primary font-bold uppercase cursor-pointer hover:underline\"\r\n                                @click=\"\r\n                                  () => {\r\n                                    contactId = user.id\r\n                                    showViewContact = true\r\n                                  }\r\n                                \"\r\n                              >\r\n                                {{ user.fullname }}\r\n                              </span>\r\n                            </td>\r\n                            <td>{{ user.document }}</td>\r\n                            <td>{{ user.cellphone }}</td>\r\n                            <td>{{ user.email }}</td>\r\n                          </tr>\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n\r\n          <template #bodyAppend>\r\n            <tr>\r\n              <td colspan=\"7\">\r\n                <div class=\"flex justify-end mt-4\">\r\n                  <VaPagination\r\n                    v-model=\"currentPage\"\r\n                    size=\"small\"\r\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\r\n                    buttons-preset=\"primary\"\r\n                    active-page-color=\"textPrimary\"\r\n                    :pages=\"pages()\"\r\n                  />\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </template>\r\n        </VaDataTable>\r\n\r\n        <VaAlert v-if=\"false\" class=\"!mt-6 py-1 text-xs\" color=\"info\">\r\n          Cantidad de resultados:\r\n          <VaChip class=\"text-xs font-bold ml-1 px-0\" color=\"#fff\">{{ filteredCount }}</VaChip>\r\n        </VaAlert>\r\n      </div>\r\n    </div>\r\n\r\n    <VaModal v-model=\"showNewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\r\n      <div>\r\n        <NewCompany @close=\"closeNewCompany\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showViewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\r\n      <div>\r\n        <NewCompany :data=\"showViewCompany\" @close=\"closeNewCompany\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showViewContact\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\r\n      <div class=\"mt-4\">\r\n        <EditCustomer\r\n          :id=\"contactId\"\r\n          @close=\"\r\n            () => {\r\n              contactId = null\r\n              showViewContact = false\r\n            }\r\n          \"\r\n        />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n      <p class=\"text-sm\">¿Deseas eliminar esta empresa?</p>\r\n\r\n      <template #footer>\r\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\r\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\r\n      </template>\r\n    </VaModal>\r\n  </div>\r\n</template>\r\n"],"names":["notify","useToast","items","ref","showNewCompany","showViewCompany","showConfirm","contactSelected","contactId","isDeleting","isLoading","showViewContact","filteredCount","perPage","currentPage","inputSearch","t","useI18n","columns","params","onMounted","getCompanies","contacts","getAllCompanies","i","format","viewDetail","data","needConfirm","_a","closeNewCompany","doDelete","deleteCompany","pages","isDownloading","download"],"mappings":"62DAUM,KAAA,CAAE,OAAAA,GAAWC,KAEbC,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAiBD,EAAI,EAAK,EAC1BE,EAAuBF,EAAI,IAAI,EAC/BG,EAAcH,EAAI,EAAK,EACvBI,EAAuBJ,EAAI,IAAI,EAC/BK,EAAiBL,EAAI,IAAI,EACzBM,EAAaN,EAAI,EAAK,EACtBO,EAAYP,EAAI,EAAK,EACrBQ,EAAkBR,EAAI,EAAK,EAC3BS,EAAgBT,EAAI,CAAC,EACrBU,EAAUV,EAAI,EAAE,EAChBW,EAAcX,EAAI,CAAC,EACnBY,EAAcZ,EAAI,EAAE,EACpB,CAAE,EAAAa,GAAMC,KACRC,EAAU,CACd,CAAE,IAAK,KAAM,SAAU,EAAM,EAC7B,CAAE,IAAK,eAAgB,SAAU,EAAM,EACvC,CAAE,IAAK,MAAO,SAAU,EAAM,EAC9B,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,iBAAkB,SAAU,EAAM,EACzC,CAAE,IAAK,WAAY,MAAO,GAAI,SAAU,EAAM,CAAA,EAG1CC,EAAShB,EAAI,CACjB,OAAQ,CAAA,CACT,EAEDiB,GAAU,IAAM,CACdC,EAAaF,EAAO,KAAK,CAAA,CAC1B,EAEK,MAAAE,EAAe,MAAOF,GAAiB,CAC3CT,EAAU,MAAQ,GACZ,MAAAY,EAAgB,MAAMC,GAAgBJ,CAAM,EAClDjB,EAAM,MAAQoB,EAAS,IAAKE,IAAY,CACtC,GAAGA,EACH,eAAgBA,EAAE,aAClB,IAAKA,EAAE,IACP,SAAUA,EAAE,MACZ,SAAUA,EAAE,SACZ,iBAAkBA,EAAE,YAAcC,GAAOD,EAAE,WAAY,qBAAqB,EAC5E,SAAU,GACV,UAAW,CACX,EAAA,EACFd,EAAU,MAAQ,EAAA,EAEdgB,EAAcC,GAAc,CAChCtB,EAAgB,MAAQsB,CAAA,EAEpBC,EAAeD,GAAc,OAC5BA,GAIEE,EAAAF,EAAK,WAAL,MAAAE,EAAe,OAIX7B,EAAA,CACL,QAAS,wDACT,MAAO,QACP,SAAU,GAAA,CACX,GAPWM,EAAA,MAAQ,GAAAqB,GAAA,MAAAA,EAAM,IAC1BpB,EAAgB,MAAQoB,GAAA,YAAAA,EAAM,KALhCrB,EAAY,MAAQ,GACpBC,EAAgB,MAAQ,KAY1B,EAEIuB,EAAkB,IAAM,CAC5B1B,EAAe,MAAQ,GACvBC,EAAgB,MAAQ,GACxBgB,EAAaF,EAAO,KAAK,CAAA,EAErBY,EAAW,SAAY,CAC3BtB,EAAW,MAAQ,GACb,MAAAuB,GAAczB,EAAgB,KAAK,EAClCP,EAAA,CACL,QAAS,kCACT,MAAO,UACP,SAAU,GAAA,CACX,EACD,WAAW,IAAM,CACfS,EAAW,MAAQ,GACnBmB,EAAY,IAAI,EAChBP,EAAaF,EAAO,KAAK,CAAA,CAC1B,CAAA,EAEGc,EAAQ,IACLpB,EAAQ,OAASA,EAAQ,QAAU,EAAI,KAAK,KAAKX,EAAM,MAAM,OAASW,EAAQ,KAAK,EAAIX,EAAM,MAAM,OAgBtGgC,EAAgB/B,EAAI,EAAK,EACzBgC,EAAW,IAAM,CACrBD,EAAc,MAAQ,GACtB,WAAW,IAAM,CACfA,EAAc,MAAQ,IACrB,GAAI,EACP,QAAQ,IAAI,UAAU,CAAA"}