{"version":3,"file":"ListCustomers-2f9cbec2.js","sources":["../../src/pages/customers/pages/ListCustomers.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { onMounted, ref } from 'vue'\r\nimport NewCustomer from './NewCustomer.vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { getAllContacts, deleteContact, archiveContact } from '../../../core/requests/Contacts'\r\nimport { useToast } from 'vuestic-ui'\r\nimport EditCustomer from './EditCustomer.vue'\r\nimport { format } from 'date-fns'\r\nimport NewOportunity from '../../oportunities/pages/NewOportunity.vue'\r\nimport NewCompany from './NewCompany.vue'\r\nimport { HOST } from '../../../core/constants'\r\n\r\nconst { notify } = useToast()\r\n\r\nconst items = ref([])\r\nconst showNewCustomer = ref(false)\r\nconst showNewCompany = ref(false)\r\nconst showViewCustomer = ref(false)\r\nconst showConfirm = ref(false)\r\nconst contactSelected: any = ref(null)\r\nconst isDeleting = ref(false)\r\nconst isLoading = ref(false)\r\nconst showNewOportunity = ref(false)\r\nconst filteredCount = ref(0)\r\nconst perPage = ref(12)\r\nconst currentPage = ref(1)\r\nconst inputSearch = ref('')\r\nconst { t } = useI18n()\r\nconst columns = [\r\n  { key: 'id', sortable: false },\r\n  { key: 'Nombres Completos', sortable: false },\r\n  { key: 'Empresa', sortable: false },\r\n  { key: 'Documento', sortable: false },\r\n  { key: 'Teléfono', sortable: false },\r\n  { key: 'Correo', sortable: false },\r\n  { key: 'Fecha Creación', sortable: false },\r\n  { key: 'Acciones', width: 80, sortable: false },\r\n]\r\n\r\nonMounted(() => {\r\n  getContacts()\r\n})\r\n\r\nconst getContacts = async (params?: any) => {\r\n  isLoading.value = true\r\n  const contacts: any = await getAllContacts(params)\r\n  items.value = contacts.map((i: any) => ({\r\n    ...i,\r\n    'Nombres Completos': i.fullname,\r\n    Empresa: i.company?.ruc,\r\n    Documento: i.document,\r\n    Teléfono: i.cellphone,\r\n    Correo: i.email,\r\n    'Fecha Creación': format(i.created_at, 'dd/MM/yyyy hh:mm aa'),\r\n    Acciones: true,\r\n    activeTab: 0,\r\n  }))\r\n  isLoading.value = false\r\n}\r\nconst viewDetail = (id: any) => {\r\n  showViewCustomer.value = id ? true : false\r\n  contactSelected.value = id\r\n}\r\n// const viewQuotation = (id: any) => {\r\n//   showNewOportunity.value = true\r\n// }\r\nconst needConfirm = (id: any) => {\r\n  showConfirm.value = id ? true : false\r\n  contactSelected.value = id\r\n}\r\nconst onClosed = () => {\r\n  showNewCustomer.value = false\r\n  showViewCustomer.value = false\r\n  getContacts()\r\n}\r\nconst doDelete = async () => {\r\n  isDeleting.value = true\r\n  await deleteContact(contactSelected.value)\r\n  notify({\r\n    message: 'Cliente eliminado correctamente',\r\n    color: 'success',\r\n    duration: 1000,\r\n  })\r\n  setTimeout(() => {\r\n    isDeleting.value = false\r\n    needConfirm(null)\r\n    getContacts()\r\n  })\r\n}\r\n\r\nconst pages = () => {\r\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\r\n}\r\n\r\n// const doFilterByRange = () => {\r\n//   const { start, end } = startDate.value\r\n//   if (start && end) {\r\n//     const fromDate = new Date(start).setHours(24)\r\n//     const toDate = new Date(end).setHours(24)\r\n\r\n//     getContacts({\r\n//       start: new Date(fromDate).getTime(),\r\n//       end: new Date(toDate).getTime(),\r\n//     })\r\n//   }\r\n// }\r\nconst isDownloading = ref(false)\r\nconst download = () => {\r\n  isDownloading.value = true\r\n  setTimeout(() => {\r\n    isDownloading.value = false\r\n  }, 2000)\r\n  console.log('download')\r\n}\r\nconst isProcessing = ref(false)\r\nconst showConfirmArchive = ref(false)\r\nconst needConfirmArchive = (id: any) => {\r\n  showConfirmArchive.value = id ? true : false\r\n  contactSelected.value = id\r\n}\r\nconst doArchive = async () => {\r\n  await archiveContact(contactSelected.value)\r\n  items.value = items.value.filter((f: any) => f.id !== contactSelected.value)\r\n  contactSelected.value = null\r\n  showConfirmArchive.value = false\r\n  notify({\r\n    message: 'Cliente archivado correctamente',\r\n    color: 'success',\r\n    duration: 1000,\r\n  })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"py-4\">\r\n    <div class=\"flex justify-between align-center justify-center\">\r\n      <h1 class=\"h5 m-0\">{{ t('contacts.allContacts') }} ({{ items.length }})</h1>\r\n      <div class=\"flex gap-2\">\r\n        <VaButton\r\n          icon=\"exit_to_app\"\r\n          color=\"info\"\r\n          :loading=\"isDownloading\"\r\n          :href=\"HOST + '/contacts/xls'\"\r\n          @click=\"download\"\r\n        >\r\n          <span class=\"px-1\">Descargar</span>\r\n        </VaButton>\r\n\r\n        <VaButton icon=\"domain_add\" color=\"primary\" @click=\"showNewCompany = true\">\r\n          <span class=\"px-1\">{{ t('contacts.newCompany') }}</span>\r\n        </VaButton>\r\n\r\n        <VaButton icon=\"person_add\" color=\"primary\" @click=\"showNewCustomer = true\">\r\n          <span class=\"px-1\">{{ t('contacts.newContact') }}</span>\r\n        </VaButton>\r\n      </div>\r\n    </div>\r\n    <div class=\"mt-5\">\r\n      <div class=\"columns-5 mb-7\">\r\n        <div>\r\n          <VaInput\r\n            v-model=\"inputSearch\"\r\n            :label=\"t('contacts.search')\"\r\n            placeholder=\"Escribe lo que buscas\"\r\n            class=\"text-xxs\"\r\n            clearable\r\n            background=\"#fff\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      <div class=\"w-full bg-white p-2\">\r\n        <VaDataTable\r\n          :items=\"items\"\r\n          :columns=\"columns\"\r\n          class=\"text-xs\"\r\n          hoverable\r\n          selected-color=\"#eee\"\r\n          :filter=\"inputSearch\"\r\n          :per-page=\"perPage\"\r\n          :current-page=\"currentPage\"\r\n          :loading=\"isLoading\"\r\n          :no-data-html=\"'...'\"\r\n          @filtered=\"filteredCount = $event.items.length\"\r\n        >\r\n          <template #cell(Acciones)=\"{ row, isExpanded }\">\r\n            <div class=\"flex gap-1\">\r\n              <VaButton icon=\"archive\" color=\"gray\" round @click=\"needConfirmArchive(row?.rowData?.id)\"></VaButton>\r\n              <!-- <VaButton icon=\"note_add\" color=\"#a650de\" round @click=\"viewQuotation(row?.rowData?.id)\"></VaButton> -->\r\n              <VaButton icon=\"edit\" color=\"#158de3\" round @click=\"viewDetail(row?.rowData?.id)\"></VaButton>\r\n              <VaButton\r\n                :icon=\"isExpanded ? 'va-arrow-up' : 'va-arrow-down'\"\r\n                preset=\"primary\"\r\n                @click=\"row.toggleRowDetails()\"\r\n              >\r\n              </VaButton>\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(Empresa)=\"{ row }\">\r\n            <span class=\"font-bold text-primary\">{{ row.rowData?.company?.ruc }}</span>\r\n          </template>\r\n\r\n          <template #bodyAppend>\r\n            <tr>\r\n              <td colspan=\"8\">\r\n                <div class=\"flex justify-end mt-4\">\r\n                  <VaPagination\r\n                    v-model=\"currentPage\"\r\n                    size=\"small\"\r\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\r\n                    buttons-preset=\"primary\"\r\n                    active-page-color=\"textPrimary\"\r\n                    :pages=\"pages()\"\r\n                  />\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </template>\r\n\r\n          <template #expandableRow=\"{ rowData }\">\r\n            <div class=\"flex px-2 py-3 gap-2 bg-blue-50 mx-10 rounded my-2\">\r\n              <div class=\"w-full pl-2\">\r\n                <div class=\"gap-1\">\r\n                  <span class=\"text-base font-medium\">\r\n                    <span class=\"uppercase font-black\">{{ rowData['Nombres Completos'] }}</span>\r\n                  </span>\r\n                </div>\r\n                <div class=\"w-full columns-6 mt-2 mb-1\">\r\n                  <div v-if=\"rowData.Documento\" class=\"w-full items-center text-xs\">\r\n                    <b>DNI:</b> <br />\r\n                    <span>\r\n                      {{ rowData.Documento }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.ruc\" class=\"w-full items-center text-xs\">\r\n                    <b>RUC:</b> <br />\r\n                    <span>\r\n                      {{ rowData.ruc }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.cellphone\" class=\"w-full items-center text-xs\">\r\n                    <b>Teléfono:</b> <br />\r\n                    <span>\r\n                      {{ rowData.cellphone }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.whatsapp\" class=\"w-full items-center text-xs\">\r\n                    <b>WhatsApp:</b> <br />\r\n                    <span>\r\n                      {{ rowData.whatsapp }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                  <div v-if=\"rowData.email\" class=\"w-full items-center text-xs\">\r\n                    <b>Correo Electrónico:</b> <br />\r\n                    <span>\r\n                      {{ rowData.email }}\r\n                      <VaIcon size=\"10px\" class=\"cursor-pointer\" name=\"content_copy\" />\r\n                    </span>\r\n                  </div>\r\n                </div>\r\n\r\n                <div class=\"flex flex-col bg-white mt-6 py-2 pb-5 px-4\">\r\n                  <VaTabs v-model=\"rowData.activeTab\">\r\n                    <template #tabs>\r\n                      <VaTab v-for=\"tab in ['Empresa']\" :key=\"tab\">\r\n                        {{ tab }}\r\n                      </VaTab>\r\n                    </template>\r\n                  </VaTabs>\r\n\r\n                  <div v-if=\"rowData.activeTab === 1\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\r\n                    <p v-if=\"!rowData.quotations?.length\" class=\"bg-red-300 font-bold p-2 -mb-1\">\r\n                      El cliente no tiene cotizaciones\r\n                    </p>\r\n\r\n                    <div v-if=\"rowData.quotations?.length\" class=\"va-table-responsive w-full\">\r\n                      <table class=\"va-table w-full\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>n° Cotización</th>\r\n                            <th>Comercial</th>\r\n                            <th>Servicios</th>\r\n                            <th>Vehiculos</th>\r\n                            <th>Fecha Creación</th>\r\n                            <th>Estado</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <tr v-for=\"user in rowData.quotations\" :key=\"user.id\">\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                          </tr>\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div v-if=\"rowData.activeTab === 2\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\r\n                    <p class=\"bg-red-300 font-bold p-2\">El cliente no tiene ordenes de trabajo</p>\r\n\r\n                    <div class=\"va-table-responsive w-full\">\r\n                      <table class=\"va-table w-full\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>n° Orden</th>\r\n                            <th>Responsable</th>\r\n                            <th>Servicios</th>\r\n                            <th>Vehiculos</th>\r\n                            <th>Fecha Inicio</th>\r\n                            <th>Fecha Fin</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <!-- <tr v-for=\"user in []\" :key=\"user.id\">\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                            <td>{{ user.fullName }}</td>\r\n                          </tr> -->\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div v-if=\"rowData.activeTab === 0\" class=\"bg-gray-100 p-3 rounded mt-4 pb-5\">\r\n                    <p v-if=\"!rowData.company\" class=\"bg-red-300 font-bold p-2 -mb-1\">\r\n                      El cliente no está asociado a empresa\r\n                    </p>\r\n\r\n                    <div v-if=\"rowData.company\" class=\"va-table-responsive w-full\">\r\n                      <table class=\"va-table w-full\">\r\n                        <thead>\r\n                          <tr>\r\n                            <th>Razón Social</th>\r\n                            <th>RUC</th>\r\n                            <th>Teléfono</th>\r\n                            <th>WhatsApp</th>\r\n                            <th>Fecha Creación</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          <tr>\r\n                            <td>{{ rowData.company?.socialreason }}</td>\r\n                            <td>{{ rowData.company?.ruc }}</td>\r\n                            <td>{{ rowData.company?.phone }}</td>\r\n                            <td>{{ rowData.company?.whatsapp }}</td>\r\n                            <td>{{ rowData.company?.created_at }}</td>\r\n                          </tr>\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </template>\r\n        </VaDataTable>\r\n\r\n        <VaAlert v-if=\"false\" class=\"!mt-6 py-1 text-xs\" color=\"info\">\r\n          Cantidad de resultados:\r\n          <VaChip class=\"text-xs font-bold ml-1 px-0\" color=\"#fff\">{{ filteredCount }}</VaChip>\r\n        </VaAlert>\r\n      </div>\r\n    </div>\r\n\r\n    <VaModal v-model=\"showNewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\r\n      <div>\r\n        <NewCompany @close=\"showNewCompany = false\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showNewCustomer\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\r\n      <div class=\"mt-4\">\r\n        <NewCustomer @close=\"onClosed\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showConfirmArchive\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n      <p class=\"text-sm\">¿Deseas archivar este cliente?</p>\r\n\r\n      <template #footer>\r\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirmArchive(null)\"> Cancelar</VaButton>\r\n        <VaButton size=\"small\" :loading=\"isProcessing\" @click=\"doArchive\"> Continuar</VaButton>\r\n      </template>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showViewCustomer\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\r\n      <div class=\"mt-4\">\r\n        <EditCustomer :id=\"contactSelected\" @close=\"onClosed\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showNewOportunity\" hide-default-actions size=\"medium\" close-button blur no-dismiss>\r\n      <div class=\"mt-4\">\r\n        <NewOportunity />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n      <p class=\"text-sm\">¿Deseas eliminar este cliente?</p>\r\n\r\n      <template #footer>\r\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\r\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\r\n      </template>\r\n    </VaModal>\r\n  </div>\r\n</template>\r\n"],"names":["notify","useToast","items","ref","showNewCustomer","showNewCompany","showViewCustomer","showConfirm","contactSelected","isDeleting","isLoading","showNewOportunity","filteredCount","perPage","currentPage","inputSearch","t","useI18n","columns","onMounted","getContacts","params","contacts","getAllContacts","i","_a","format","viewDetail","id","needConfirm","onClosed","doDelete","deleteContact","pages","isDownloading","download","isProcessing","showConfirmArchive","needConfirmArchive","doArchive","archiveContact","f"],"mappings":"6xGAYM,KAAA,CAAE,OAAAA,GAAWC,KAEbC,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAkBD,EAAI,EAAK,EAC3BE,EAAiBF,EAAI,EAAK,EAC1BG,EAAmBH,EAAI,EAAK,EAC5BI,EAAcJ,EAAI,EAAK,EACvBK,EAAuBL,EAAI,IAAI,EAC/BM,EAAaN,EAAI,EAAK,EACtBO,EAAYP,EAAI,EAAK,EACrBQ,EAAoBR,EAAI,EAAK,EAC7BS,EAAgBT,EAAI,CAAC,EACrBU,EAAUV,EAAI,EAAE,EAChBW,EAAcX,EAAI,CAAC,EACnBY,EAAcZ,EAAI,EAAE,EACpB,CAAE,EAAAa,GAAMC,KACRC,EAAU,CACd,CAAE,IAAK,KAAM,SAAU,EAAM,EAC7B,CAAE,IAAK,oBAAqB,SAAU,EAAM,EAC5C,CAAE,IAAK,UAAW,SAAU,EAAM,EAClC,CAAE,IAAK,YAAa,SAAU,EAAM,EACpC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,SAAU,SAAU,EAAM,EACjC,CAAE,IAAK,iBAAkB,SAAU,EAAM,EACzC,CAAE,IAAK,WAAY,MAAO,GAAI,SAAU,EAAM,CAAA,EAGhDC,GAAU,IAAM,CACFC,GAAA,CACb,EAEK,MAAAA,EAAc,MAAOC,GAAiB,CAC1CX,EAAU,MAAQ,GACZ,MAAAY,EAAgB,MAAMC,GAAeF,CAAM,EACjDnB,EAAM,MAAQoB,EAAS,IAAKE,GAAY,OAAA,OACtC,GAAGA,EACH,oBAAqBA,EAAE,SACvB,SAASC,EAAAD,EAAE,UAAF,YAAAC,EAAW,IACpB,UAAWD,EAAE,SACb,SAAUA,EAAE,UACZ,OAAQA,EAAE,MACV,iBAAkBE,GAAOF,EAAE,WAAY,qBAAqB,EAC5D,SAAU,GACV,UAAW,CACX,EAAA,EACFd,EAAU,MAAQ,EAAA,EAEdiB,EAAcC,GAAY,CACbtB,EAAA,MAAQ,EAAAsB,EACzBpB,EAAgB,MAAQoB,CAAA,EAKpBC,EAAeD,GAAY,CACnBrB,EAAA,MAAQ,EAAAqB,EACpBpB,EAAgB,MAAQoB,CAAA,EAEpBE,EAAW,IAAM,CACrB1B,EAAgB,MAAQ,GACxBE,EAAiB,MAAQ,GACbc,GAAA,EAERW,EAAW,SAAY,CAC3BtB,EAAW,MAAQ,GACb,MAAAuB,GAAcxB,EAAgB,KAAK,EAClCR,EAAA,CACL,QAAS,kCACT,MAAO,UACP,SAAU,GAAA,CACX,EACD,WAAW,IAAM,CACfS,EAAW,MAAQ,GACnBoB,EAAY,IAAI,EACJT,GAAA,CACb,CAAA,EAGGa,EAAQ,IACLpB,EAAQ,OAASA,EAAQ,QAAU,EAAI,KAAK,KAAKX,EAAM,MAAM,OAASW,EAAQ,KAAK,EAAIX,EAAM,MAAM,OAetGgC,EAAgB/B,EAAI,EAAK,EACzBgC,EAAW,IAAM,CACrBD,EAAc,MAAQ,GACtB,WAAW,IAAM,CACfA,EAAc,MAAQ,IACrB,GAAI,EACP,QAAQ,IAAI,UAAU,CAAA,EAElBE,GAAejC,EAAI,EAAK,EACxBkC,EAAqBlC,EAAI,EAAK,EAC9BmC,EAAsBV,GAAY,CACnBS,EAAA,MAAQ,EAAAT,EAC3BpB,EAAgB,MAAQoB,CAAA,EAEpBW,GAAY,SAAY,CACtB,MAAAC,GAAehC,EAAgB,KAAK,EACpCN,EAAA,MAAQA,EAAM,MAAM,OAAQuC,GAAWA,EAAE,KAAOjC,EAAgB,KAAK,EAC3EA,EAAgB,MAAQ,KACxB6B,EAAmB,MAAQ,GACpBrC,EAAA,CACL,QAAS,kCACT,MAAO,UACP,SAAU,GAAA,CACX,CAAA"}