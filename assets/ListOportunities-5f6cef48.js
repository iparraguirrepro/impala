import{d as fe,K as ve,q as n,I as q,v as _e,L as ge,r,o as m,c as y,a as t,t as p,b as o,w as l,u as c,J as ye,H as J,f as v,g as Q,x as F,F as G,k as W,_ as be}from"./index-eb5b4f51.js";import{a as X}from"./NewOportunity-b9003bc7.js";import{a as he,u as xe,g as Ve,d as Ce}from"./oportunities-store-e0c593ed.js";import{n as ke}from"./Orders-2187cd97.js";import{u as we}from"./orders-store-c769c10e.js";import{f as I}from"./format-8e15a9c0.js";import"./EditCustomer-95fd219c.js";import"./utils-17deefef.js";import"./helpers-a12fb3e4.js";import"./Services-781d534c.js";import"./Vehicles-f3e604e9.js";import"./InputAddress-c9acd681.js";import"./lodash-14e13292.js";const De={class:"py-4"},ze={class:"flex flex-wrap sm:flex-nowrap justify-between align-center justify-center"},Oe={class:"h5 m-0"},Se={class:"flex gap-2"},Ke=t("span",{class:"px-1"},"Descargar",-1),Te=t("span",{class:"px-1"},"Nueva cotización",-1),Be={class:"columns-1 sm:columns-5 mb-7 mt-5"},Me={class:"relative"},Ue={class:"flex columns-1 mt-5"},Pe={class:"w-full bg-white p-2"},Ae={class:"flex gap-1"},Le={class:"break-words text-balance"},$e={class:"flex flex-col gap-1",style:{"--va-badge-text-wrapper-border-radius":"50%"}},Ne={class:"mx-10 my-2 px-2 py-3 gap-2 bg-blue-50"},Fe={class:"columns-4 w-full mb-4 bg-white p-2"},Ie=t("p",{class:"font-bold"},"Cotización creada:",-1),je=t("p",{class:"font-bold"},"Última Actualización:",-1),Ee={class:"bg-white p-2"},Re={class:"columns-4 w-full mb-2"},He={class:"w-full"},qe=t("p",{class:"font-bold"},"Cotizado por:",-1),Je={class:"capitalize"},Qe={class:"w-full"},Ge=t("p",{class:"font-bold"},"Dirigido a:",-1),We={colspan:"9"},Xe={class:"flex justify-end mt-4"},Ye=t("p",{class:"text-sm"},"¿Deseas eliminar esta cotización?",-1),Ze=t("p",{class:"text-sm"},"¿Deseas cambiar el estado de esta cotización?",-1),et={key:0,class:"text-sm"},tt={key:1,class:"text-sm"},at={class:"list-decimal px-4 text-sm mt-3"},st={class:"font-bold"},ot={class:"mt-4"},lt={class:"mt-4"},nt=fe({__name:"ListOportunities",setup(it){const{notify:V}=he(),Y=ve(),_=n([]),Z=[{key:"id",sortable:!1},{key:"Descripción",sortable:!1},{key:"Cliente",sortable:!1},{key:"Servicios",sortable:!1},{key:"Total",sortable:!1},{key:"Comercial",sortable:!1},{key:"Creación",sortable:!1},{key:"Estado",sortable:!1},{key:"actions",width:80}],C=we(),{viewOrders:T,orders:B}=q(C),b=xe(),{statusOptions:j}=q(b),g=n(null),M=n(null),k=n(null),U=n(!1),w=n(!1),ee=n(!1),f=n(!1),E=n(0),P=n(""),A=n({start:null,end:null}),te=n(0),D=n(15),L=n(1),ae=()=>(console.log(_.value.length),D.value&&D.value!==0?Math.ceil(_.value.length/D.value):_.value.length),se=async()=>{await Ce(g.value),g.value=null,V({message:"Cotización eliminada correctamente",color:"success",duration:1e3}),z()},z=async i=>{f.value=!0;const a=await Ve(i);await b.getQuotationStates(),_.value=a.map(s=>{var O;const u={state:{...s}.status};return{data:{...s,...u},createdAt:I(new Date(s.created_at),"dd/MM/yyyy hh:mm"),Creación:I(new Date(s.created_at),"dd/MM/yy hh:mm"),updatedAt:I(new Date(s.updated_at),"dd/MM/yyyy hh:mm"),id:"00"+s.id,Cliente:s.customer.company?s.customer.socialreason:""+s.customer.fullname,Servicios:s.services.map(h=>{var S,K;return{label:(S=h.service.detail)==null?void 0:S.service,value:(K=h.service.detail)==null?void 0:K.id}}),Total:"S/ "+s.total,Descripción:s.title,Comercial:(O=s.owner)==null?void 0:O.name,Acciones:!0}}),f.value=!1},oe=i=>{k.value=i,U.value=!0},R=()=>{z(),U.value=!1,w.value=!1},le=async i=>{b.setActiveOportunity(i),b.viewConfirm()},ne=()=>{M.value=null},ie=()=>{};_e(()=>{ge(()=>b.vailable,()=>{console.log("updated")}),z()});const de=async i=>{f.value=!0;const a=await ke({id:i}),s=a.news,u=a.exists;u.length>0?(V({message:"La cotización tiene ordenes existentes",color:"info",duration:2500}),C.showOrders(u),f.value=!1):s.length>1?(V({message:"Proceso realizado correctamente",color:"success",duration:2500}),C.showOrders(s),f.value=!1):(V({message:"Se ha creado la orden #000"+s[0]+"-24",color:"success",duration:2500}),f.value=!1,Y.push("/orders/view/"+s[0]))},re=()=>{const{start:i,end:a}=A.value;if(i&&a){const s=new Date(i).setHours(0),u=new Date(a).setHours(24);z({start:new Date(s).getTime(),end:new Date(u).getTime()})}},$=n(!1),ce=()=>{$.value=!0,setTimeout(()=>{$.value=!1},2e3),console.log("download")},N=n(null),ue=i=>{N.value=i,setTimeout(()=>{N.value=null},2500)};return(i,a)=>{const s=r("VaButton"),u=r("VaInput"),O=r("VaDateInput"),h=r("VaSelect"),S=r("VaChip"),K=r("VaBadge"),me=r("VaPagination"),pe=r("VaDataTable"),x=r("VaModal");return m(),y("div",De,[t("div",ze,[t("h1",Oe,"Cotizaciones ("+p(_.value.length)+")",1),t("div",Se,[o(s,{icon:"exit_to_app",color:"info",loading:$.value,href:c(J)+"/oportunities/xls",onClick:ce},{default:l(()=>[Ke]),_:1},8,["loading","href"]),o(s,{icon:"add",color:"primary",onClick:a[0]||(a[0]=e=>w.value=!0)},{default:l(()=>[Te]),_:1})])]),t("div",Be,[t("div",null,[o(u,{modelValue:P.value,"onUpdate:modelValue":a[1]||(a[1]=e=>P.value=e),label:"Buscar en resultados",placeholder:"Escribe lo que buscas",clearable:"",background:"#fff"},null,8,["modelValue"])]),t("div",null,[o(O,{modelValue:A.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>A.value=e),re],label:"Filtrar por fecha",placeholder:"Ingresa una fecha",mode:"range",background:"#fff"},null,8,["modelValue"])]),t("div",Me,[o(h,{options:c(j),"value-by":"id","text-by":"label",background:"#fff",placeholder:"---",label:"Filtrar por estado",class:"text-xs",style:{"--va-input--border-color":"transparent",width:"120px"}},null,8,["options"]),o(s,{class:"absolute bottom-0.5 mx-4 text-xs",color:"#158de3"},{default:l(()=>[v("Buscar")]),_:1})])]),t("div",Ue,[t("div",Pe,[o(pe,{items:_.value,columns:Z,class:"text-xs",filter:P.value,"per-page":D.value,"current-page":L.value,loading:f.value,"no-data-html":"...",onFiltered:a[4]||(a[4]=e=>te.value=e.items.length)},{"cell(actions)":l(({row:e})=>[t("div",Ae,[o(s,{icon:"delete",color:"danger",disabled:e.itemKey.data.status===4,round:"",onClick:d=>g.value=e.itemKey.data.id},null,8,["disabled","onClick"]),o(s,{icon:"download",color:"#158de3",round:"",loading:e.itemKey.data.id==N.value,href:c(J)+"/oportunities/pdf/"+e.itemKey.data.id,onClick:d=>ue(e.itemKey.data.id)},null,8,["loading","href","onClick"]),o(s,{icon:"visibility",color:"#6c48d9",round:"",onClick:d=>oe(e.itemKey.data)},null,8,["onClick"]),e.itemKey.data.status===4?(m(),Q(s,{key:0,icon:"library_add",color:"success",round:"",onClick:d=>de(e.itemKey.data.id)},null,8,["onClick"])):F("",!0)])]),"cell(Descripción)":l(({...e})=>[t("p",Le,p(e==null?void 0:e.source),1)]),"cell(Estado)":l(({row:e})=>[o(h,{modelValue:e.itemKey.data.status,"onUpdate:modelValue":[d=>e.itemKey.data.status=d,d=>le(e.itemKey.data)],background:e.itemKey.data.status===4?"#c3ffcb":e.itemKey.data.status===5?"#ffa1a1":"#d5e3ff",readonly:e.itemKey.data.status===4,options:c(j),"value-by":"id","text-by":"label",placeholder:"---",loading:E.value===e.itemKey.data.id,class:"text-xs",style:{"--va-input--border-color":"transparent",width:"120px"}},null,8,["modelValue","onUpdate:modelValue","background","readonly","options","loading"])]),"cell(Servicios)":l(({...e})=>[t("div",$e,[(m(!0),y(G,null,W(e==null?void 0:e.source,d=>(m(),Q(K,{key:d,overlap:""},{default:l(()=>[o(S,{size:"small",color:"#d5e3ff",class:"text-xxs font-bold px-1",style:{"--va-chip-sm-height":"1.25rem"}},{default:l(()=>[v(p(d.label),1)]),_:2},1024)]),_:2},1024))),128))])]),expandableRow:l(({rowData:e})=>{var d,H;return[t("div",Ne,[t("div",Fe,[t("div",null,[Ie,t("span",null,p(e.createdAt),1)]),t("div",null,[je,t("span",null,p(e.updatedAt),1)])]),t("div",Ee,[t("div",Re,[t("div",He,[qe,t("span",Je,p((H=(d=e.data)==null?void 0:d.owner)==null?void 0:H.name),1)]),t("div",Qe,[Ge,t("span",null,p(e.Cliente),1)])])])])]}),bodyAppend:l(()=>[t("tr",null,[t("td",We,[t("div",Xe,[o(me,{modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e),size:"small",class:"text-xs mb-3 justify-center sm:justify-start","buttons-preset":"primary","active-page-color":"textPrimary",pages:ae()},null,8,["modelValue","pages"])])])])]),_:1},8,["items","filter","per-page","current-page","loading","no-data-html"])])]),o(x,{modelValue:g.value,"onUpdate:modelValue":a[6]||(a[6]=e=>g.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:l(()=>[o(s,{size:"small",preset:"secondary",class:"mr-1",onClick:a[5]||(a[5]=e=>g.value=null)},{default:l(()=>[v(" Cancelar")]),_:1}),o(s,{size:"small",loading:ee.value,onClick:se},{default:l(()=>[v(" Continuar")]),_:1},8,["loading"])]),default:l(()=>[Ye]),_:1},8,["modelValue"]),o(x,{modelValue:M.value,"onUpdate:modelValue":a[8]||(a[8]=e=>M.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:l(()=>[o(s,{size:"small",preset:"secondary",class:"mr-1",onClick:a[7]||(a[7]=e=>ne())},{default:l(()=>[v(" Cancelar")]),_:1}),o(s,{size:"small",loading:E.value,onClick:ie},{default:l(()=>[v(" Continuar")]),_:1},8,["loading"])]),default:l(()=>[Ze]),_:1},8,["modelValue"]),o(x,{modelValue:c(T),"onUpdate:modelValue":a[10]||(a[10]=e=>ye(T)?T.value=e:null),size:"280px","hide-default-actions":"","close-button":""},{default:l(()=>[c(B).length>1?(m(),y("p",et,"Ordenes registradas:")):F("",!0),c(B).length==1?(m(),y("p",tt,"Orden registrada:")):F("",!0),t("ul",at,[(m(!0),y(G,null,W(c(B),e=>(m(),y("li",{key:e,class:"mb-2"},[t("span",st,"000"+p(e)+"-24",1),o(s,{size:"small",preset:"primary",to:"/orders/view/"+e,class:"ml-1",style:{"text-transform":"capitalize",top:"-2px"},onClick:a[9]||(a[9]=d=>c(C).hideOrders())},{default:l(()=>[v(" Ver Orden ")]),_:2},1032,["to"])]))),128))])]),_:1},8,["modelValue"]),o(x,{modelValue:w.value,"onUpdate:modelValue":a[11]||(a[11]=e=>w.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":""},{default:l(()=>[t("div",ot,[o(X,{onClose:R})])]),_:1},8,["modelValue"]),o(x,{modelValue:k.value,"onUpdate:modelValue":a[12]||(a[12]=e=>k.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":""},{default:l(()=>[t("div",lt,[o(X,{data:k.value,detail:U.value,onClose:R},null,8,["data","detail"])])]),_:1},8,["modelValue"])])}}}),xt=be(nt,[["__file","C:/Users/ID-04/Documents/Main/vuestic-impala/src/pages/oportunities/pages/ListOportunities.vue"]]);export{xt as default};
//# sourceMappingURL=ListOportunities-5f6cef48.js.map
