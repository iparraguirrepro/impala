import{u as fe,_ as H}from"./NewOportunity.vue_vue_type_style_index_0_lang-ad31f3f4.js";import{a as ve,u as _e,g as ge,d as ye}from"./oportunities-store-b5a756f8.js";import{n as he}from"./Orders-dd267587.js";import{d as be,B as Ve,r as n,y as q,o as xe,C as Ce,b as c,c as r,e as g,h as t,t as m,f as l,w as o,k as p,z as ke,H as Q,m as G,i as L,F as J,l as W,g as y}from"./index-b6bf2d81.js";import{f as j}from"./format-8e15a9c0.js";import"./NewCustomer.vue_vue_type_style_index_0_lang-f5a586ba.js";import"./NewCompany.vue_vue_type_style_index_0_lang-a531dfe8.js";import"./utils-17deefef.js";import"./helpers-a12fb3e4.js";import"./Services-a3d54d81.js";import"./EditCustomer.vue_vue_type_style_index_0_lang-3e16454e.js";import"./InputAddress.vue_vue_type_style_index_0_lang-80a80d86.js";import"./lodash-473566f6.js";const we={class:"py-4"},ze={class:"flex justify-between align-center justify-center"},De={class:"h5 m-0"},Oe={class:"flex gap-2"},Se=t("span",{class:"px-1"},"Descargar",-1),Ke=t("span",{class:"px-1"},"Nueva cotización",-1),Te={class:"columns-5 mb-7 mt-5"},Be={class:"flex columns-1 mt-5"},Me={class:"w-full bg-white p-2"},Pe={class:"flex gap-1"},Ue={class:"break-words text-balance"},$e={class:"flex flex-col gap-1",style:{"--va-badge-text-wrapper-border-radius":"50%"}},Ae={class:"mx-10 my-2 px-2 py-3 gap-2 bg-blue-50"},Ne={class:"columns-4 w-full mb-4 bg-white p-2"},Fe=t("p",{class:"font-bold"},"Cotización creada:",-1),Le=t("p",{class:"font-bold"},"Última Actualización:",-1),je={class:"bg-white p-2"},Ee={class:"columns-4 w-full mb-2"},Ie={class:"w-full"},Re=t("p",{class:"font-bold"},"Cotizado por:",-1),He={class:"capitalize"},qe={class:"w-full"},Qe=t("p",{class:"font-bold"},"Dirigido a:",-1),Ge={colspan:"9"},Je={class:"flex justify-end mt-4"},We=t("p",{class:"text-sm"},"¿Deseas eliminar esta cotización?",-1),Xe=t("p",{class:"text-sm"},"¿Deseas cambiar el estado de esta cotización?",-1),Ye={key:0,class:"text-sm"},Ze={key:1,class:"text-sm"},et={class:"list-decimal px-4 text-sm mt-3"},tt={class:"font-bold"},at={class:"mt-4"},st={class:"mt-4"},yt=be({__name:"ListOportunities",setup(lt){const{notify:V}=ve(),X=Ve(),v=n([]),Y=[{key:"id",sortable:!1},{key:"Descripción",sortable:!1},{key:"Cliente",sortable:!1},{key:"Servicios",sortable:!1},{key:"Total",sortable:!1},{key:"Comercial",sortable:!1},{key:"Creación",sortable:!1},{key:"Estado",sortable:!1},{key:"actions",width:80}],x=fe(),{viewOrders:T,orders:B}=q(x),h=_e(),{statusOptions:Z}=q(h),_=n(null),M=n(null),C=n(null),P=n(!1),k=n(!1),ee=n(!1),f=n(!1),E=n(0),U=n(""),$=n({start:null,end:null}),te=n(0),w=n(15),A=n(1),ae=()=>(console.log(v.value.length),w.value&&w.value!==0?Math.ceil(v.value.length/w.value):v.value.length),se=async()=>{await ye(_.value),_.value=null,V({message:"Cotización eliminada correctamente",color:"success",duration:1e3}),z()},z=async i=>{f.value=!0;const a=await ge(i);await h.getQuotationStates(),v.value=a.map(s=>{var D;const u={state:{...s}.status};return{data:{...s,...u},createdAt:j(new Date(s.created_at),"dd/MM/yyyy hh:mm"),Creación:j(new Date(s.created_at),"dd/MM/yy hh:mm"),updatedAt:j(new Date(s.updated_at),"dd/MM/yyyy hh:mm"),id:"00"+s.id,Cliente:s.customer.company?s.customer.socialreason:""+s.customer.fullname,Servicios:s.services.map(O=>{var S,K;return{label:(S=O.service.detail)==null?void 0:S.service,value:(K=O.service.detail)==null?void 0:K.id}}),Total:"S/ "+s.total,Descripción:s.title,Comercial:(D=s.owner)==null?void 0:D.name,Acciones:!0}}),f.value=!1},le=i=>{C.value=i,P.value=!0},I=()=>{z(),P.value=!1,k.value=!1},oe=async i=>{h.setActiveOportunity(i),h.viewConfirm()},ne=()=>{M.value=null},ie=()=>{};xe(()=>{Ce(()=>h.vailable,()=>{console.log("updated")}),z()});const de=async i=>{f.value=!0;const a=await he({id:i}),s=a.news,u=a.exists;u.length>0?(V({message:"La cotización tiene ordenes existentes",color:"info",duration:2500}),x.showOrders(u),f.value=!1):s.length>1?(V({message:"Proceso realizado correctamente",color:"success",duration:2500}),x.showOrders(s),f.value=!1):(V({message:"Se ha creado la orden #000"+s[0]+"-24",color:"success",duration:2500}),f.value=!1,X.push("/orders/view/"+s[0]))},ce=()=>{const{start:i,end:a}=$.value;if(i&&a){const s=new Date(i).setHours(0),u=new Date(a).setHours(24);z({start:new Date(s).getTime(),end:new Date(u).getTime()})}},N=n(!1),ue=()=>{N.value=!0,setTimeout(()=>{N.value=!1},2e3),console.log("download")},F=n(null),re=i=>{F.value=i,setTimeout(()=>{F.value=null},2500)};return(i,a)=>{const s=c("VaButton"),u=c("VaInput"),D=c("VaDateInput"),O=c("VaSelect"),S=c("VaChip"),K=c("VaBadge"),me=c("VaPagination"),pe=c("VaDataTable"),b=c("VaModal");return r(),g("div",we,[t("div",ze,[t("h1",De,"Cotizaciones ("+m(v.value.length)+")",1),t("div",Oe,[l(s,{icon:"exit_to_app",color:"info",loading:N.value,href:p(Q)+"/oportunities/xls",onClick:ue},{default:o(()=>[Se]),_:1},8,["loading","href"]),l(s,{icon:"add",color:"primary",onClick:a[0]||(a[0]=e=>k.value=!0)},{default:o(()=>[Ke]),_:1})])]),t("div",Te,[t("div",null,[l(u,{modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value=e),label:"Buscar en resultados",placeholder:"Escribe lo que buscas",clearable:"",background:"#fff"},null,8,["modelValue"])]),t("div",null,[l(D,{modelValue:$.value,"onUpdate:modelValue":[a[2]||(a[2]=e=>$.value=e),ce],label:"Filtrar por fecha",placeholder:"Ingresa una fecha",mode:"range",background:"#fff"},null,8,["modelValue"])])]),t("div",Be,[t("div",Me,[l(pe,{items:v.value,columns:Y,class:"text-xs",filter:U.value,"per-page":w.value,"current-page":A.value,loading:f.value,"no-data-html":"...",onFiltered:a[4]||(a[4]=e=>te.value=e.items.length)},{"cell(actions)":o(({row:e})=>[t("div",Pe,[l(s,{icon:"delete",color:"danger",disabled:e.itemKey.data.status===4,round:"",onClick:d=>_.value=e.itemKey.data.id},null,8,["disabled","onClick"]),l(s,{icon:"download",color:"#158de3",round:"",loading:e.itemKey.data.id==F.value,href:p(Q)+"/oportunities/pdf/"+e.itemKey.data.id,onClick:d=>re(e.itemKey.data.id)},null,8,["loading","href","onClick"]),l(s,{icon:"visibility",color:"#6c48d9",round:"",onClick:d=>le(e.itemKey.data)},null,8,["onClick"]),e.itemKey.data.status===4?(r(),G(s,{key:0,icon:"library_add",color:"success",round:"",onClick:d=>de(e.itemKey.data.id)},null,8,["onClick"])):L("",!0)])]),"cell(Descripción)":o(({...e})=>[t("p",Ue,m(e==null?void 0:e.source),1)]),"cell(Estado)":o(({row:e})=>[l(O,{modelValue:e.itemKey.data.status,"onUpdate:modelValue":[d=>e.itemKey.data.status=d,d=>oe(e.itemKey.data)],background:e.itemKey.data.status===4?"#c3ffcb":e.itemKey.data.status===5?"#ffa1a1":"#d5e3ff",readonly:e.itemKey.data.status===4,options:p(Z),"value-by":"id","text-by":"label",placeholder:"---",loading:E.value===e.itemKey.data.id,class:"text-xs",style:{"--va-input--border-color":"transparent",width:"120px"}},null,8,["modelValue","onUpdate:modelValue","background","readonly","options","loading"])]),"cell(Servicios)":o(({...e})=>[t("div",$e,[(r(!0),g(J,null,W(e==null?void 0:e.source,d=>(r(),G(K,{key:d,overlap:""},{default:o(()=>[l(S,{size:"small",color:"#d5e3ff",class:"text-xxs font-bold px-1",style:{"--va-chip-sm-height":"1.25rem"}},{default:o(()=>[y(m(d.label),1)]),_:2},1024)]),_:2},1024))),128))])]),expandableRow:o(({rowData:e})=>{var d,R;return[t("div",Ae,[t("div",Ne,[t("div",null,[Fe,t("span",null,m(e.createdAt),1)]),t("div",null,[Le,t("span",null,m(e.updatedAt),1)])]),t("div",je,[t("div",Ee,[t("div",Ie,[Re,t("span",He,m((R=(d=e.data)==null?void 0:d.owner)==null?void 0:R.name),1)]),t("div",qe,[Qe,t("span",null,m(e.Cliente),1)])])])])]}),bodyAppend:o(()=>[t("tr",null,[t("td",Ge,[t("div",Je,[l(me,{modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=e=>A.value=e),size:"small",class:"text-xs mb-3 justify-center sm:justify-start","buttons-preset":"primary","active-page-color":"textPrimary",pages:ae()},null,8,["modelValue","pages"])])])])]),_:1},8,["items","filter","per-page","current-page","loading","no-data-html"])])]),l(b,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=e=>_.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:o(()=>[l(s,{size:"small",preset:"secondary",class:"mr-1",onClick:a[5]||(a[5]=e=>_.value=null)},{default:o(()=>[y(" Cancelar")]),_:1}),l(s,{size:"small",loading:ee.value,onClick:se},{default:o(()=>[y(" Continuar")]),_:1},8,["loading"])]),default:o(()=>[We]),_:1},8,["modelValue"]),l(b,{modelValue:M.value,"onUpdate:modelValue":a[8]||(a[8]=e=>M.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:o(()=>[l(s,{size:"small",preset:"secondary",class:"mr-1",onClick:a[7]||(a[7]=e=>ne())},{default:o(()=>[y(" Cancelar")]),_:1}),l(s,{size:"small",loading:E.value,onClick:ie},{default:o(()=>[y(" Continuar")]),_:1},8,["loading"])]),default:o(()=>[Xe]),_:1},8,["modelValue"]),l(b,{modelValue:p(T),"onUpdate:modelValue":a[10]||(a[10]=e=>ke(T)?T.value=e:null),size:"280px","hide-default-actions":"","close-button":""},{default:o(()=>[p(B).length>1?(r(),g("p",Ye,"Ordenes registradas:")):L("",!0),p(B).length==1?(r(),g("p",Ze,"Orden registrada:")):L("",!0),t("ul",et,[(r(!0),g(J,null,W(p(B),e=>(r(),g("li",{key:e,class:"mb-2"},[t("span",tt,"000"+m(e)+"-24",1),l(s,{size:"small",preset:"primary",to:"/orders/view/"+e,class:"ml-1",style:{"text-transform":"capitalize",top:"-2px"},onClick:a[9]||(a[9]=d=>p(x).hideOrders())},{default:o(()=>[y(" Ver Orden ")]),_:2},1032,["to"])]))),128))])]),_:1},8,["modelValue"]),l(b,{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=e=>k.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":""},{default:o(()=>[t("div",at,[l(H,{onClose:I})])]),_:1},8,["modelValue"]),l(b,{modelValue:C.value,"onUpdate:modelValue":a[12]||(a[12]=e=>C.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":""},{default:o(()=>[t("div",st,[l(H,{data:C.value,detail:P.value,onClose:I},null,8,["data","detail"])])]),_:1},8,["modelValue"])])}}});export{yt as default};
//# sourceMappingURL=ListOportunities-83ba73fe.js.map
