import{a as R}from"./NewOportunity.vue_vue_type_style_index_0_lang-16b66f00.js";import{a as pe,u as fe,g as ve,d as _e}from"./oportunities-store-a81e42d5.js";import{n as ge}from"./Orders-2876c941.js";import{d as ye,J as he,p as n,G as H,s as be,K as xe,r as c,o as m,c as g,a as t,t as r,b as o,w as l,u as f,I as Ce,H as q,g as G,v as F,F as J,j as Q,f as y}from"./index-4f9ea22f.js";import{u as Ve}from"./orders-store-6c035b54.js";import{f as L}from"./format-8e15a9c0.js";import"./EditCustomer.vue_vue_type_style_index_0_lang-35bbd804.js";import"./utils-17deefef.js";import"./helpers-a12fb3e4.js";import"./Services-f7e56ebf.js";import"./Vehicles-3e565873.js";import"./InputAddress.vue_vue_type_style_index_0_lang-db453c13.js";import"./lodash-04ea7520.js";const we={class:"py-4"},ke={class:"flex justify-between align-center justify-center"},ze={class:"h5 m-0"},De={class:"flex gap-2"},Se=t("span",{class:"px-1"},"Descargar",-1),Oe=t("span",{class:"px-1"},"Nueva cotización",-1),Te={class:"columns-5 mb-7 mt-5"},Ke={class:"flex columns-1 mt-5"},Be={class:"w-full bg-white p-2"},Me={class:"flex gap-1"},Pe={class:"break-words text-balance"},$e={class:"bg-gray-100 text-gray-800 text-xxs font-bold me-2 px-2 py-0.5 rounded dark:bg-gray-200 dark:text-gray-800"},Ae={class:"flex flex-col gap-1",style:{"--va-badge-text-wrapper-border-radius":"50%"}},Ie={class:"mx-10 my-2 px-2 py-3 gap-2 bg-blue-50"},Ue={class:"columns-4 w-full mb-4 bg-white p-2"},Ne=t("p",{class:"font-bold"},"Cotización creada:",-1),je=t("p",{class:"font-bold"},"Última Actualización:",-1),Fe={class:"bg-white p-2"},Le={class:"columns-4 w-full mb-2"},Ee={class:"w-full"},Re=t("p",{class:"font-bold"},"Cotizado por:",-1),He={class:"capitalize"},qe={class:"w-full"},Ge=t("p",{class:"font-bold"},"Dirigido a:",-1),Je={colspan:"10"},Qe={class:"flex justify-end mt-4"},We=t("p",{class:"text-sm"},"¿Deseas eliminar esta cotización?",-1),Xe=t("p",{class:"text-sm"},"¿Deseas cambiar el estado de esta cotización?",-1),Ye={key:0,class:"text-sm"},Ze={key:1,class:"text-sm"},et={class:"list-decimal px-4 text-sm mt-3"},tt={class:"font-bold"},st={class:"mt-4"},at={class:"mt-4"},yt=ye({__name:"ListOportunities",setup(ot){const{notify:x}=pe(),W=he(),v=n([]),X=[{key:"ID",sortable:!1},{key:"Serie",sortable:!1},{key:"Cliente",sortable:!1},{key:"Servicios",sortable:!1},{key:"Total",sortable:!1},{key:"Comercial",sortable:!1},{key:"Creación",sortable:!1},{key:"Estado",sortable:!1},{key:"actions",width:80}],C=Ve(),{viewOrders:K,orders:B}=H(C),M=fe(),{statusOptions:Y}=H(M),_=n(null),P=n(null),h=n(null),$=n(!1),V=n(!1),Z=n(!1),p=n(!1),ee=n(0),A=n(""),I=n({start:null,end:null}),te=n(0),w=n(15),U=n(1),se=()=>(console.log(v.value.length),w.value&&w.value!==0?Math.ceil(v.value.length/w.value):v.value.length),ae=async()=>{await _e(_.value),_.value=null,x({message:"Cotización eliminada correctamente",color:"success",duration:1e3}),k()},k=async i=>{p.value=!0;const s=await ve(i);await M.getQuotationStates(),v.value=s.map(a=>{var D;const u={state:{...a}.status};return{data:{...a,...u},Serie:a.serie?"00"+a.serie:"-",createdAt:L(new Date(a.created_at),"dd/MM/yyyy hh:mm"),Creación:L(new Date(a.created_at),"dd/MM/yy hh:mm"),updatedAt:L(new Date(a.updated_at),"dd/MM/yyyy hh:mm"),ID:a.id,Cliente:a.customer.company?a.customer.socialreason:""+a.customer.fullname,Servicios:a.services.map(S=>{var O,T;return{label:(O=S.service.detail)==null?void 0:O.service,value:(T=S.service.detail)==null?void 0:T.id}}),Total:"S/ "+a.total,Comercial:(D=a.owner)==null?void 0:D.name,Acciones:!0}}),p.value=!1},oe=i=>{h.value=i,console.log(i),$.value=!1},z=()=>{k(),$.value=!1,h.value=null,V.value=!1},le=()=>{P.value=null},ne=()=>{};be(()=>{xe(()=>M.vailable,()=>{console.log("updated")}),k()});const ie=async i=>{p.value=!0;const s=await ge({id:i}),a=s.news,u=s.exists;u.length>0?(x({message:"La cotización tiene ordenes existentes",color:"info",duration:2500}),C.showOrders(u),p.value=!1):a.length>1?(x({message:"Proceso realizado correctamente",color:"success",duration:2500}),C.showOrders(a),p.value=!1):(x({message:"Se ha creado la orden #000"+a[0]+"-24",color:"success",duration:2500}),p.value=!1,W.push("/orders/view/"+a[0]))},de=()=>{const{start:i,end:s}=I.value;if(i&&s){const a=new Date(i).setHours(0),u=new Date(s).setHours(24);k({start:new Date(a).getTime(),end:new Date(u).getTime()})}},N=n(!1),re=()=>{N.value=!0,setTimeout(()=>{N.value=!1},2e3),console.log("download")},j=n(null),ue=i=>{j.value=i,setTimeout(()=>{j.value=null},2500)},ce=i=>Y.value.find(s=>s.id===i);return(i,s)=>{const a=c("VaButton"),u=c("VaInput"),D=c("VaDateInput"),S=c("VaChip"),O=c("VaBadge"),T=c("VaPagination"),me=c("VaDataTable"),b=c("VaModal");return m(),g("div",we,[t("div",ke,[t("h1",ze,"Cotizaciones ("+r(v.value.length)+")",1),t("div",De,[o(a,{icon:"exit_to_app",color:"info",loading:N.value,href:f(q)+"/oportunities/xls",onClick:re},{default:l(()=>[Se]),_:1},8,["loading","href"]),o(a,{icon:"add",color:"primary",onClick:s[0]||(s[0]=e=>V.value=!0)},{default:l(()=>[Oe]),_:1})])]),t("div",Te,[t("div",null,[o(u,{modelValue:A.value,"onUpdate:modelValue":s[1]||(s[1]=e=>A.value=e),label:"Buscar en resultados",placeholder:"Escribe lo que buscas",clearable:"",background:"#fff"},null,8,["modelValue"])]),t("div",null,[o(D,{modelValue:I.value,"onUpdate:modelValue":[s[2]||(s[2]=e=>I.value=e),de],label:"Filtrar por fecha",placeholder:"Ingresa una fecha",mode:"range",background:"#fff"},null,8,["modelValue"])])]),t("div",Ke,[t("div",Be,[o(me,{items:v.value,columns:X,class:"text-xs",filter:A.value,"per-page":w.value,"current-page":U.value,loading:p.value,"no-data-html":"...",onFiltered:s[4]||(s[4]=e=>te.value=e.items.length)},{"cell(actions)":l(({row:e})=>[t("div",Me,[o(a,{icon:"delete",color:"danger",disabled:e.itemKey.data.status===4,round:"",onClick:d=>_.value=e.itemKey.data.id},null,8,["disabled","onClick"]),o(a,{icon:"download",color:"#158de3",round:"",disabled:!e.itemKey.data.serie,loading:e.itemKey.data.id==j.value,href:f(q)+"/oportunities/pdf/"+e.itemKey.data.id,onClick:d=>ue(e.itemKey.data.id)},null,8,["disabled","loading","href","onClick"]),o(a,{icon:"edit",color:"#6c48d9",round:"",onClick:d=>oe(e.itemKey.data)},null,8,["onClick"]),e.itemKey.data.status===4?(m(),G(a,{key:0,icon:"library_add",color:"success",round:"",onClick:d=>ie(e.itemKey.data.id)},null,8,["onClick"])):F("",!0)])]),"cell(Descripción)":l(({...e})=>[t("p",Pe,r(e==null?void 0:e.source),1)]),"cell(Estado)":l(({row:e})=>{var d;return[t("span",$e,r((d=ce(e.itemKey.data.status))==null?void 0:d.label),1)]}),"cell(Servicios)":l(({...e})=>[t("div",Ae,[(m(!0),g(J,null,Q(e==null?void 0:e.source,d=>(m(),G(O,{key:d,overlap:""},{default:l(()=>[o(S,{size:"small",color:"#d5e3ff",class:"text-xxs font-bold px-1",style:{"--va-chip-sm-height":"1.25rem"}},{default:l(()=>[y(r(d.label),1)]),_:2},1024)]),_:2},1024))),128))])]),expandableRow:l(({rowData:e})=>{var d,E;return[t("div",Ie,[t("div",Ue,[t("div",null,[Ne,t("span",null,r(e.createdAt),1)]),t("div",null,[je,t("span",null,r(e.updatedAt),1)])]),t("div",Fe,[t("div",Le,[t("div",Ee,[Re,t("span",He,r((E=(d=e.data)==null?void 0:d.owner)==null?void 0:E.name),1)]),t("div",qe,[Ge,t("span",null,r(e.Cliente),1)])])])])]}),bodyAppend:l(()=>[t("tr",null,[t("td",Je,[t("div",Qe,[o(T,{modelValue:U.value,"onUpdate:modelValue":s[3]||(s[3]=e=>U.value=e),size:"small",class:"text-xs mb-3 justify-center sm:justify-start","buttons-preset":"primary","active-page-color":"textPrimary",pages:se()},null,8,["modelValue","pages"])])])])]),_:1},8,["items","filter","per-page","current-page","loading","no-data-html"])])]),o(b,{modelValue:_.value,"onUpdate:modelValue":s[6]||(s[6]=e=>_.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:l(()=>[o(a,{size:"small",preset:"secondary",class:"mr-1",onClick:s[5]||(s[5]=e=>_.value=null)},{default:l(()=>[y(" Cancelar")]),_:1}),o(a,{size:"small",loading:Z.value,onClick:ae},{default:l(()=>[y(" Continuar")]),_:1},8,["loading"])]),default:l(()=>[We]),_:1},8,["modelValue"]),o(b,{modelValue:P.value,"onUpdate:modelValue":s[8]||(s[8]=e=>P.value=e),size:"250px","hide-default-actions":"","no-dismiss":""},{footer:l(()=>[o(a,{size:"small",preset:"secondary",class:"mr-1",onClick:s[7]||(s[7]=e=>le())},{default:l(()=>[y(" Cancelar")]),_:1}),o(a,{size:"small",loading:ee.value,onClick:ne},{default:l(()=>[y(" Continuar")]),_:1},8,["loading"])]),default:l(()=>[Xe]),_:1},8,["modelValue"]),o(b,{modelValue:f(K),"onUpdate:modelValue":s[10]||(s[10]=e=>Ce(K)?K.value=e:null),size:"280px","hide-default-actions":"","close-button":""},{default:l(()=>[f(B).length>1?(m(),g("p",Ye,"Ordenes registradas:")):F("",!0),f(B).length==1?(m(),g("p",Ze,"Orden registrada:")):F("",!0),t("ul",et,[(m(!0),g(J,null,Q(f(B),e=>(m(),g("li",{key:e,class:"mb-2"},[t("span",tt,"000"+r(e)+"-24",1),o(a,{size:"small",preset:"primary",to:"/orders/view/"+e,class:"ml-1",style:{"text-transform":"capitalize",top:"-2px"},onClick:s[9]||(s[9]=d=>f(C).hideOrders())},{default:l(()=>[y(" Ver Orden ")]),_:2},1032,["to"])]))),128))])]),_:1},8,["modelValue"]),o(b,{modelValue:V.value,"onUpdate:modelValue":s[11]||(s[11]=e=>V.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":"",onClose:z},{default:l(()=>[t("div",st,[o(R,{onClose:z})])]),_:1},8,["modelValue"]),o(b,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=e=>h.value=e),"hide-default-actions":"",size:"medium","close-button":"",blur:"","no-dismiss":"",onClose:z},{default:l(()=>[t("div",at,[o(R,{data:h.value,detail:$.value,onClose:z},null,8,["data","detail"])])]),_:1},8,["modelValue"])])}}});export{yt as default};
//# sourceMappingURL=ListOportunities-e25a46a2.js.map
