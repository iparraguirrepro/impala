{"version":3,"file":"ListOrders-3c2ab301.js","sources":["../../src/pages/orders/pages/ListOrders.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\nimport { useToast } from 'vuestic-ui'\nimport { format } from 'date-fns'\nimport { getAllOrders, deleteOrder } from '../../../core/requests/Orders'\nimport { useOrdersStore } from '../../../stores/orders-store'\nimport { storeToRefs } from 'pinia'\n\nconst { notify } = useToast()\n\nconst orderStore = useOrdersStore()\nconst { statusOptions } = storeToRefs(orderStore)\n\nconst items = ref([])\nconst showViewCustomer = ref(false)\nconst showConfirm = ref(null)\nconst contactSelected = ref(null)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst { t } = useI18n()\nconst columns = [\n  { key: 'Nro Orden', sortable: false },\n  { key: 'Cotización', sortable: false },\n  { key: 'Cliente', sortable: false },\n  { key: 'Contacto', sortable: false },\n  { key: 'Servicio', sortable: false },\n  { key: 'Creación', sortable: false },\n  { key: 'Estado', width: '80' },\n  { key: 'actions', width: 80 },\n]\n\n//\nconst inputSearch = ref('')\nconst startDate = ref({\n  start: null,\n  end: null,\n})\nconst filteredCount = ref(0)\nconst perPage = ref(15)\nconst currentPage = ref(1)\nconst pages = () => {\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\n}\n//\n\nconst doFilterByRange = () => {\n  const { start, end } = startDate.value\n  if (start && end) {\n    const fromDate = new Date(start).setHours(0)\n    const toDate = new Date(end).setHours(24)\n    getOrders({\n      start: new Date(fromDate).getTime(),\n      end: new Date(toDate).getTime(),\n    })\n  }\n}\n\nonMounted(() => {\n  getOrders()\n})\n\nconst getOrders = async (params?: any) => {\n  isLoading.value = true\n  const data: any = await getAllOrders(params)\n  items.value = data.map((order: any) => {\n    console.log(order)\n    return {\n      ...order,\n      'Nro Orden': `000${order.id}-24`,\n      Cotización: `00${order.service.quotation}`,\n      Contacto: order.customer.cellphone,\n      Cliente: order.company ? order.company.socialreason : order.customer.fullname,\n      Servicio: [\n        {\n          label: order.service.services.service,\n        },\n      ],\n      Creación: format(new Date(order.created_at), 'dd/MM/yyyy hh:mm'),\n      Estado: order.status === 1 ? 'En Progreso' : 'Finalizado',\n      actions: null,\n    }\n  })\n  isLoading.value = false\n}\nconst viewDetail = (id: any) => {\n  showViewCustomer.value = id ? true : false\n  contactSelected.value = id\n}\nconst needConfirm = (id: any) => {\n  showConfirm.value = id\n  contactSelected.value = id\n}\nconst doDelete = async () => {\n  isDeleting.value = true\n  notify({\n    message: 'Orden eliminada correctamente',\n    color: 'success',\n    duration: 1000,\n  })\n\n  await deleteOrder(showConfirm.value)\n\n  isDeleting.value = false\n  needConfirm(null)\n\n  getOrders()\n}\n</script>\n\n<template>\n  <div class=\"py-4\">\n    <div class=\"flex justify-between align-center justify-center\">\n      <h1 class=\"h5 m-0\">{{ t('orders.allOrders') }} ({{ items.length }})</h1>\n\n      <!-- <div>\n        <VaButton\n          icon=\"exit_to_app\"\n          color=\"info\"\n          :loading=\"isDownloading\"\n          :href=\"HOST + '/orders/xls'\"\n          @click=\"download\"\n        >\n          <span class=\"px-1\">Descargar</span>\n        </VaButton>\n      </div> -->\n    </div>\n\n    <div class=\"columns-5 mb-7 mt-5\">\n      <div>\n        <VaInput\n          v-model=\"inputSearch\"\n          label=\"Buscar en resultados\"\n          placeholder=\"Escribe lo que buscas\"\n          clearable\n          background=\"#fff\"\n        />\n      </div>\n      <div>\n        <VaDateInput\n          v-model=\"startDate\"\n          label=\"Filtrar por fecha\"\n          placeholder=\"Ingresa una fecha\"\n          mode=\"range\"\n          background=\"#fff\"\n          @update:modelValue=\"doFilterByRange\"\n        />\n      </div>\n\n      <div class=\"relative\">\n        <VaSelect\n          :options=\"statusOptions\"\n          value-by=\"id\"\n          text-by=\"label\"\n          background=\"#fff\"\n          placeholder=\"---\"\n          label=\"Filtrar por estado\"\n          class=\"text-xs\"\n          style=\"--va-input--border-color: transparent; width: 120px\"\n        />\n\n        <VaButton class=\"absolute bottom-0.5 mx-4 text-xs\" color=\"#158de3\">Buscar</VaButton>\n      </div>\n    </div>\n\n    <div class=\"mt-5\">\n      <div class=\"w-full bg-white p-2\">\n        <VaDataTable\n          hoverable\n          :items=\"items\"\n          :columns=\"columns\"\n          class=\"text-xs\"\n          selected-color=\"#eee\"\n          :filter=\"inputSearch\"\n          :per-page=\"perPage\"\n          :current-page=\"currentPage\"\n          :loading=\"isLoading\"\n          :no-data-html=\"'...'\"\n          @filtered=\"filteredCount = $event.items.length\"\n        >\n          <template #cell(Vehiculos)=\"{ ...value }\">\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\n              <VaBadge v-for=\"i in value?.source\" :key=\"i\" overlap color=\"primary\" :text=\"i.value\" placement=\"top-end\">\n                <VaChip\n                  size=\"small\"\n                  color=\"#eff6ff\"\n                  class=\"text-xxs font-bold px-1\"\n                  style=\"--va-chip-sm-height: 1.25rem\"\n                >\n                  {{ i.label }}\n                </VaChip>\n              </VaBadge>\n            </div>\n          </template>\n\n          <template #cell(Servicio)=\"{ ...value }\">\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\n              <VaBadge v-for=\"i in value?.source\" :key=\"i\" overlap color=\"primary\">\n                <VaChip\n                  size=\"small\"\n                  color=\"#eff6ff\"\n                  class=\"text-xxs font-bold px-1\"\n                  style=\"--va-chip-sm-height: 1.25rem\"\n                >\n                  {{ i.label }}\n                </VaChip>\n              </VaBadge>\n            </div>\n          </template>\n\n          <template #cell(Id)=\"{ value }\">\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\n              <span class=\"text-primary font-bold hover:underline cursor-pointer\">{{ value }}</span>\n            </div>\n          </template>\n\n          <template #cell(Cotizacion)=\"{ value }\">\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\n              <span class=\"text-primary font-bold hover:underline cursor-pointer\">{{ value }}</span>\n            </div>\n          </template>\n\n          <template #cell(Estado)=\"{ value }\">\n            <div>\n              <VaSelect\n                class=\"text-xs\"\n                :class=\"\n                  value === 'Cancelado'\n                    ? 'bg-red-100'\n                    : value === 'Finalizado'\n                      ? 'bg-green-100'\n                      : value === 'En Progreso'\n                        ? 'bg-blue-100'\n                        : ''\n                \"\n                style=\"width: 120px; --va-input-wrapper-border-color: transparent\"\n                readonly\n                :model-value=\"value\"\n              />\n            </div>\n          </template>\n\n          <template #cell(actions)=\"{ row }\">\n            <div class=\"flex gap-1\">\n              <VaButton\n                icon=\"description\"\n                :to=\"'/orders/view/' + row?.rowData?.id\"\n                color=\"#158de3\"\n                round\n                @click=\"viewDetail(row?.rowData?.id)\"\n              ></VaButton>\n              <VaButton icon=\"delete\" color=\"danger\" round @click=\"needConfirm(row?.rowData?.id)\"></VaButton>\n            </div>\n          </template>\n\n          <template #bodyAppend>\n            <tr>\n              <td colspan=\"8\">\n                <div class=\"flex justify-end mt-4\">\n                  <VaPagination\n                    v-model=\"currentPage\"\n                    size=\"small\"\n                    buttons-preset=\"primary\"\n                    active-page-color=\"textPrimary\"\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\n                    :pages=\"pages()\"\n                  />\n                </div>\n              </td>\n            </tr>\n          </template>\n        </VaDataTable>\n      </div>\n    </div>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas eliminar esta orden?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["notify","useToast","orderStore","useOrdersStore","statusOptions","storeToRefs","items","ref","showViewCustomer","showConfirm","contactSelected","isDeleting","isLoading","t","useI18n","columns","inputSearch","startDate","filteredCount","perPage","currentPage","pages","doFilterByRange","start","end","fromDate","toDate","getOrders","onMounted","params","data","getAllOrders","order","format","viewDetail","id","needConfirm","doDelete","deleteOrder"],"mappings":"2pCASM,KAAA,CAAE,OAAAA,GAAWC,IAEbC,EAAaC,KACb,CAAE,cAAAC,CAAA,EAAkBC,EAAYH,CAAU,EAE1CI,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAmBD,EAAI,EAAK,EAC5BE,EAAcF,EAAI,IAAI,EACtBG,EAAkBH,EAAI,IAAI,EAC1BI,EAAaJ,EAAI,EAAK,EACtBK,EAAYL,EAAI,EAAK,EACrB,CAAE,EAAAM,GAAMC,IACRC,EAAU,CACd,CAAE,IAAK,YAAa,SAAU,EAAM,EACpC,CAAE,IAAK,aAAc,SAAU,EAAM,EACrC,CAAE,IAAK,UAAW,SAAU,EAAM,EAClC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,SAAU,MAAO,IAAK,EAC7B,CAAE,IAAK,UAAW,MAAO,EAAG,CAAA,EAIxBC,EAAcT,EAAI,EAAE,EACpBU,EAAYV,EAAI,CACpB,MAAO,KACP,IAAK,IAAA,CACN,EACKW,EAAgBX,EAAI,CAAC,EACrBY,EAAUZ,EAAI,EAAE,EAChBa,EAAcb,EAAI,CAAC,EACnBc,EAAQ,IACLF,EAAQ,OAASA,EAAQ,QAAU,EAAI,KAAK,KAAKb,EAAM,MAAM,OAASa,EAAQ,KAAK,EAAIb,EAAM,MAAM,OAItGgB,EAAkB,IAAM,CAC5B,KAAM,CAAE,MAAAC,EAAO,IAAAC,GAAQP,EAAU,MACjC,GAAIM,GAASC,EAAK,CAChB,MAAMC,EAAW,IAAI,KAAKF,CAAK,EAAE,SAAS,CAAC,EACrCG,EAAS,IAAI,KAAKF,CAAG,EAAE,SAAS,EAAE,EAC9BG,EAAA,CACR,MAAO,IAAI,KAAKF,CAAQ,EAAE,QAAQ,EAClC,IAAK,IAAI,KAAKC,CAAM,EAAE,QAAQ,CAAA,CAC/B,CACH,CAAA,EAGFE,GAAU,IAAM,CACJD,GAAA,CACX,EAEK,MAAAA,EAAY,MAAOE,GAAiB,CACxCjB,EAAU,MAAQ,GACZ,MAAAkB,EAAY,MAAMC,GAAaF,CAAM,EAC3CvB,EAAM,MAAQwB,EAAK,IAAKE,IACtB,QAAQ,IAAIA,CAAK,EACV,CACL,GAAGA,EACH,YAAa,MAAMA,EAAM,EAAE,MAC3B,WAAY,KAAKA,EAAM,QAAQ,SAAS,GACxC,SAAUA,EAAM,SAAS,UACzB,QAASA,EAAM,QAAUA,EAAM,QAAQ,aAAeA,EAAM,SAAS,SACrE,SAAU,CACR,CACE,MAAOA,EAAM,QAAQ,SAAS,OAChC,CACF,EACA,SAAUC,GAAO,IAAI,KAAKD,EAAM,UAAU,EAAG,kBAAkB,EAC/D,OAAQA,EAAM,SAAW,EAAI,cAAgB,aAC7C,QAAS,IAAA,EAEZ,EACDpB,EAAU,MAAQ,EAAA,EAEdsB,EAAcC,GAAY,CACb3B,EAAA,MAAQ,EAAA2B,EACzBzB,EAAgB,MAAQyB,CAAA,EAEpBC,EAAeD,GAAY,CAC/B1B,EAAY,MAAQ0B,EACpBzB,EAAgB,MAAQyB,CAAA,EAEpBE,EAAW,SAAY,CAC3B1B,EAAW,MAAQ,GACZX,EAAA,CACL,QAAS,gCACT,MAAO,UACP,SAAU,GAAA,CACX,EAEK,MAAAsC,GAAY7B,EAAY,KAAK,EAEnCE,EAAW,MAAQ,GACnByB,EAAY,IAAI,EAENT,GAAA"}