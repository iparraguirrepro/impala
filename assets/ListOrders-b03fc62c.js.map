{"version":3,"file":"ListOrders-b03fc62c.js","sources":["../../src/pages/orders/pages/ListOrders.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { onMounted, ref } from 'vue'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { useToast } from 'vuestic-ui'\r\nimport { format } from 'date-fns'\r\nimport { getAllOrders, deleteOrder } from '../../../core/requests/Orders'\r\nimport { useOrdersStore } from '../../../stores/orders-store'\r\nimport { storeToRefs } from 'pinia'\r\n\r\nconst { notify } = useToast()\r\n\r\nconst orderStore = useOrdersStore()\r\nconst { statusOptions } = storeToRefs(orderStore)\r\n\r\nconst items = ref([])\r\nconst showViewCustomer = ref(false)\r\nconst showConfirm = ref(null)\r\nconst contactSelected = ref(null)\r\nconst isDeleting = ref(false)\r\nconst isLoading = ref(false)\r\nconst { t } = useI18n()\r\nconst columns = [\r\n  { key: 'Nro Orden', sortable: false },\r\n  { key: 'Cotización', sortable: false },\r\n  { key: 'Cliente', sortable: false },\r\n  { key: 'Contacto', sortable: false },\r\n  { key: 'Servicio', sortable: false },\r\n  { key: 'Creación', sortable: false },\r\n  { key: 'Estado', width: '80' },\r\n  { key: 'actions', width: 80 },\r\n]\r\n\r\n//\r\nconst inputSearch = ref('')\r\nconst startDate = ref({\r\n  start: null,\r\n  end: null,\r\n})\r\nconst filteredCount = ref(0)\r\nconst perPage = ref(15)\r\nconst currentPage = ref(1)\r\nconst pages = () => {\r\n  return perPage.value && perPage.value !== 0 ? Math.ceil(items.value.length / perPage.value) : items.value.length\r\n}\r\n//\r\n\r\nconst doFilterByRange = () => {\r\n  const { start, end } = startDate.value\r\n  if (start && end) {\r\n    const fromDate = new Date(start).setHours(0)\r\n    const toDate = new Date(end).setHours(24)\r\n    getOrders({\r\n      start: new Date(fromDate).getTime(),\r\n      end: new Date(toDate).getTime(),\r\n    })\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  getOrders()\r\n})\r\n\r\nconst getOrders = async (params?: any) => {\r\n  isLoading.value = true\r\n  const data: any = await getAllOrders(params)\r\n  items.value = data.map((order: any) => {\r\n    console.log(order)\r\n    return {\r\n      ...order,\r\n      'Nro Orden': `000${order.id}-24`,\r\n      Cotización: `00${order.service.quotation}`,\r\n      Contacto: order.customer.cellphone,\r\n      Cliente: order.company ? order.company.socialreason : order.customer.fullname,\r\n      Servicio: [\r\n        {\r\n          label: order.service.services.service,\r\n        },\r\n      ],\r\n      Creación: format(new Date(order.created_at), 'dd/MM/yyyy hh:mm'),\r\n      Estado: order.status === 1 ? 'En Progreso' : 'Finalizado',\r\n      actions: null,\r\n    }\r\n  })\r\n  isLoading.value = false\r\n}\r\nconst viewDetail = (id: any) => {\r\n  showViewCustomer.value = id ? true : false\r\n  contactSelected.value = id\r\n}\r\nconst needConfirm = (id: any) => {\r\n  showConfirm.value = id\r\n  contactSelected.value = id\r\n}\r\nconst doDelete = async () => {\r\n  isDeleting.value = true\r\n  notify({\r\n    message: 'Orden eliminada correctamente',\r\n    color: 'success',\r\n    duration: 1000,\r\n  })\r\n\r\n  await deleteOrder(showConfirm.value)\r\n\r\n  isDeleting.value = false\r\n  needConfirm(null)\r\n\r\n  getOrders()\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"py-4\">\r\n    <div class=\"flex justify-between align-center justify-center\">\r\n      <h1 class=\"h5 m-0\">{{ t('orders.allOrders') }} ({{ items.length }})</h1>\r\n\r\n      <!-- <div>\r\n        <VaButton\r\n          icon=\"exit_to_app\"\r\n          color=\"info\"\r\n          :loading=\"isDownloading\"\r\n          :href=\"HOST + '/orders/xls'\"\r\n          @click=\"download\"\r\n        >\r\n          <span class=\"px-1\">Descargar</span>\r\n        </VaButton>\r\n      </div> -->\r\n    </div>\r\n\r\n    <div class=\"columns-5 mb-7 mt-5\">\r\n      <div>\r\n        <VaInput\r\n          v-model=\"inputSearch\"\r\n          label=\"Buscar en resultados\"\r\n          placeholder=\"Escribe lo que buscas\"\r\n          clearable\r\n          background=\"#fff\"\r\n        />\r\n      </div>\r\n      <div>\r\n        <VaDateInput\r\n          v-model=\"startDate\"\r\n          label=\"Filtrar por fecha\"\r\n          placeholder=\"Ingresa una fecha\"\r\n          mode=\"range\"\r\n          background=\"#fff\"\r\n          @update:modelValue=\"doFilterByRange\"\r\n        />\r\n      </div>\r\n\r\n      <div class=\"relative\">\r\n        <VaSelect\r\n          :options=\"statusOptions\"\r\n          value-by=\"id\"\r\n          text-by=\"label\"\r\n          background=\"#fff\"\r\n          placeholder=\"---\"\r\n          label=\"Filtrar por estado\"\r\n          class=\"text-xs\"\r\n          style=\"--va-input--border-color: transparent; width: 120px\"\r\n        />\r\n\r\n        <VaButton class=\"absolute bottom-0.5 mx-4 text-xs\" color=\"#158de3\">Buscar</VaButton>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"mt-5\">\r\n      <div class=\"w-full bg-white p-2\">\r\n        <VaDataTable\r\n          hoverable\r\n          :items=\"items\"\r\n          :columns=\"columns\"\r\n          class=\"text-xs\"\r\n          selected-color=\"#eee\"\r\n          :filter=\"inputSearch\"\r\n          :per-page=\"perPage\"\r\n          :current-page=\"currentPage\"\r\n          :loading=\"isLoading\"\r\n          :no-data-html=\"'...'\"\r\n          @filtered=\"filteredCount = $event.items.length\"\r\n        >\r\n          <template #cell(Vehiculos)=\"{ ...value }\">\r\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\r\n              <VaBadge v-for=\"i in value?.source\" :key=\"i\" overlap color=\"primary\" :text=\"i.value\" placement=\"top-end\">\r\n                <VaChip\r\n                  size=\"small\"\r\n                  color=\"#eff6ff\"\r\n                  class=\"text-xxs font-bold px-1\"\r\n                  style=\"--va-chip-sm-height: 1.25rem\"\r\n                >\r\n                  {{ i.label }}\r\n                </VaChip>\r\n              </VaBadge>\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(Servicio)=\"{ ...value }\">\r\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\r\n              <VaBadge v-for=\"i in value?.source\" :key=\"i\" overlap color=\"primary\">\r\n                <VaChip\r\n                  size=\"small\"\r\n                  color=\"#eff6ff\"\r\n                  class=\"text-xxs font-bold px-1\"\r\n                  style=\"--va-chip-sm-height: 1.25rem\"\r\n                >\r\n                  {{ i.label }}\r\n                </VaChip>\r\n              </VaBadge>\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(Id)=\"{ value }\">\r\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\r\n              <span class=\"text-primary font-bold hover:underline cursor-pointer\">{{ value }}</span>\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(Cotizacion)=\"{ value }\">\r\n            <div class=\"flex flex-col gap-1\" style=\"--va-badge-text-wrapper-border-radius: 50%\">\r\n              <span class=\"text-primary font-bold hover:underline cursor-pointer\">{{ value }}</span>\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(Estado)=\"{ value }\">\r\n            <div>\r\n              <VaSelect\r\n                class=\"text-xs\"\r\n                :class=\"\r\n                  value === 'Cancelado'\r\n                    ? 'bg-red-100'\r\n                    : value === 'Finalizado'\r\n                      ? 'bg-green-100'\r\n                      : value === 'En Progreso'\r\n                        ? 'bg-blue-100'\r\n                        : ''\r\n                \"\r\n                style=\"width: 120px; --va-input-wrapper-border-color: transparent\"\r\n                readonly\r\n                :model-value=\"value\"\r\n              />\r\n            </div>\r\n          </template>\r\n\r\n          <template #cell(actions)=\"{ row }\">\r\n            <div class=\"flex gap-1\">\r\n              <VaButton\r\n                icon=\"description\"\r\n                :to=\"'/orders/view/' + row?.rowData?.id\"\r\n                color=\"#158de3\"\r\n                round\r\n                @click=\"viewDetail(row?.rowData?.id)\"\r\n              ></VaButton>\r\n              <VaButton icon=\"delete\" color=\"danger\" round @click=\"needConfirm(row?.rowData?.id)\"></VaButton>\r\n            </div>\r\n          </template>\r\n\r\n          <template #bodyAppend>\r\n            <tr>\r\n              <td colspan=\"8\">\r\n                <div class=\"flex justify-end mt-4\">\r\n                  <VaPagination\r\n                    v-model=\"currentPage\"\r\n                    size=\"small\"\r\n                    buttons-preset=\"primary\"\r\n                    active-page-color=\"textPrimary\"\r\n                    class=\"text-xs mb-3 justify-center sm:justify-start\"\r\n                    :pages=\"pages()\"\r\n                  />\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </template>\r\n        </VaDataTable>\r\n      </div>\r\n    </div>\r\n\r\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n      <p class=\"text-sm\">¿Deseas eliminar esta orden?</p>\r\n\r\n      <template #footer>\r\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null)\"> Cancelar</VaButton>\r\n        <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\r\n      </template>\r\n    </VaModal>\r\n  </div>\r\n</template>\r\n"],"names":["notify","useToast","orderStore","useOrdersStore","statusOptions","storeToRefs","items","ref","showViewCustomer","showConfirm","contactSelected","isDeleting","isLoading","t","useI18n","columns","inputSearch","startDate","filteredCount","perPage","currentPage","pages","doFilterByRange","start","end","fromDate","toDate","getOrders","onMounted","params","data","getAllOrders","order","format","viewDetail","id","needConfirm","doDelete","deleteOrder"],"mappings":"mpCASM,KAAA,CAAE,OAAAA,GAAWC,IAEbC,EAAaC,KACb,CAAE,cAAAC,CAAA,EAAkBC,EAAYH,CAAU,EAE1CI,EAAQC,EAAI,CAAA,CAAE,EACdC,EAAmBD,EAAI,EAAK,EAC5BE,EAAcF,EAAI,IAAI,EACtBG,EAAkBH,EAAI,IAAI,EAC1BI,EAAaJ,EAAI,EAAK,EACtBK,EAAYL,EAAI,EAAK,EACrB,CAAE,EAAAM,GAAMC,IACRC,EAAU,CACd,CAAE,IAAK,YAAa,SAAU,EAAM,EACpC,CAAE,IAAK,aAAc,SAAU,EAAM,EACrC,CAAE,IAAK,UAAW,SAAU,EAAM,EAClC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,WAAY,SAAU,EAAM,EACnC,CAAE,IAAK,SAAU,MAAO,IAAK,EAC7B,CAAE,IAAK,UAAW,MAAO,EAAG,CAAA,EAIxBC,EAAcT,EAAI,EAAE,EACpBU,EAAYV,EAAI,CACpB,MAAO,KACP,IAAK,IAAA,CACN,EACKW,EAAgBX,EAAI,CAAC,EACrBY,EAAUZ,EAAI,EAAE,EAChBa,EAAcb,EAAI,CAAC,EACnBc,EAAQ,IACLF,EAAQ,OAASA,EAAQ,QAAU,EAAI,KAAK,KAAKb,EAAM,MAAM,OAASa,EAAQ,KAAK,EAAIb,EAAM,MAAM,OAItGgB,EAAkB,IAAM,CAC5B,KAAM,CAAE,MAAAC,EAAO,IAAAC,GAAQP,EAAU,MACjC,GAAIM,GAASC,EAAK,CAChB,MAAMC,EAAW,IAAI,KAAKF,CAAK,EAAE,SAAS,CAAC,EACrCG,EAAS,IAAI,KAAKF,CAAG,EAAE,SAAS,EAAE,EAC9BG,EAAA,CACR,MAAO,IAAI,KAAKF,CAAQ,EAAE,QAAQ,EAClC,IAAK,IAAI,KAAKC,CAAM,EAAE,QAAQ,CAAA,CAC/B,CACH,CAAA,EAGFE,GAAU,IAAM,CACJD,GAAA,CACX,EAEK,MAAAA,EAAY,MAAOE,GAAiB,CACxCjB,EAAU,MAAQ,GACZ,MAAAkB,EAAY,MAAMC,GAAaF,CAAM,EAC3CvB,EAAM,MAAQwB,EAAK,IAAKE,IACtB,QAAQ,IAAIA,CAAK,EACV,CACL,GAAGA,EACH,YAAa,MAAMA,EAAM,EAAE,MAC3B,WAAY,KAAKA,EAAM,QAAQ,SAAS,GACxC,SAAUA,EAAM,SAAS,UACzB,QAASA,EAAM,QAAUA,EAAM,QAAQ,aAAeA,EAAM,SAAS,SACrE,SAAU,CACR,CACE,MAAOA,EAAM,QAAQ,SAAS,OAChC,CACF,EACA,SAAUC,GAAO,IAAI,KAAKD,EAAM,UAAU,EAAG,kBAAkB,EAC/D,OAAQA,EAAM,SAAW,EAAI,cAAgB,aAC7C,QAAS,IAAA,EAEZ,EACDpB,EAAU,MAAQ,EAAA,EAEdsB,EAAcC,GAAY,CACb3B,EAAA,MAAQ,EAAA2B,EACzBzB,EAAgB,MAAQyB,CAAA,EAEpBC,EAAeD,GAAY,CAC/B1B,EAAY,MAAQ0B,EACpBzB,EAAgB,MAAQyB,CAAA,EAEpBE,EAAW,SAAY,CAC3B1B,EAAW,MAAQ,GACZX,EAAA,CACL,QAAS,gCACT,MAAO,UACP,SAAU,GAAA,CACX,EAEK,MAAAsC,GAAY7B,EAAY,KAAK,EAEnCE,EAAW,MAAQ,GACnByB,EAAY,IAAI,EAENT,GAAA"}