{"version":3,"file":"NewCustomer.vue_vue_type_style_index_0_lang-3514b682.js","sources":["../../src/pages/customers/pages/NewCustomer.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { computed, onMounted, reactive, ref, watch } from 'vue'\r\nimport { useForm } from 'vuestic-ui'\r\nimport { useI18n } from 'vue-i18n'\r\nimport { newContact } from '../../../core/requests/Contacts'\r\nimport { useToast } from 'vuestic-ui'\r\nimport NewCompany from './NewCompany.vue'\r\nimport { getAllCompanies } from '../../../core/requests/Company'\r\nimport { validators } from '../../../services/utils'\r\nimport { onlyNumbersNoDigits } from '../../../core/helpers'\r\n\r\nconst emit = defineEmits(['close'])\r\nconst vOnlyNumbers = onlyNumbersNoDigits\r\n\r\nconst showNewCompany = ref(false)\r\nconst { t } = useI18n()\r\nconst isLoading = ref(false)\r\nconst companies: any = ref([])\r\nconst { isValid, validate, reset } = useForm('formRef')\r\nconst form: any = reactive({})\r\n\r\nonMounted(() => {\r\n  watch(\r\n    () => form.havecompany,\r\n    async (val) => {\r\n      if (val) await getCompanies()\r\n    },\r\n  )\r\n})\r\nconst selectedCompany = computed(() => companies.value.find((f: any) => f.id === form.company))\r\n\r\nconst { notify } = useToast()\r\nconst doProcess = async () => {\r\n  if (validate()) {\r\n    isLoading.value = true\r\n    try {\r\n      const documentType = form?.document_type?.code\r\n      await newContact({\r\n        ...form,\r\n        document_type: documentType,\r\n      })\r\n\r\n      notify({\r\n        message: 'Cliente registrado correctamente',\r\n        color: 'success',\r\n      })\r\n\r\n      reset()\r\n\r\n      emit('close')\r\n    } catch (e: any) {\r\n      console.log(e)\r\n    }\r\n\r\n    isLoading.value = false\r\n  }\r\n}\r\n\r\nconst documentTypes = [\r\n  { code: 1, text: 'DNI' },\r\n  { code: 2, text: 'C.E' },\r\n  { code: 3, text: 'PASAPORTE' },\r\n]\r\n\r\nconst openSunatRuc = () => {\r\n  window.open(\r\n    'https://e-consultaruc.sunat.gob.pe/cl-ti-itmrconsruc/FrameCriterioBusquedaWeb.jsp',\r\n    '_blank',\r\n    'menubar=1,resizable=0,width=600,height=500',\r\n  )\r\n}\r\nconst onClosed = () => {\r\n  showNewCompany.value = false\r\n  getCompanies()\r\n}\r\nconst getCompanies = async () => {\r\n  const cData = await getAllCompanies()\r\n  companies.value = cData\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"bg-blue-50\">\r\n    <div>\r\n      <div class=\"flex justify-between align-center justify-center\">\r\n        <h1 class=\"h5 font-bold m-0\">{{ t('contacts.newContact') }}</h1>\r\n        <div class=\"flex gap-2\">\r\n          <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\r\n            <span class=\"text-xs px-1\">{{ t('contacts.createContact') }}</span>\r\n          </VaButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"py-4 new-customer gap-8\">\r\n      <VaForm ref=\"formRef\" immediate class=\"gap-2\">\r\n        <div class=\"w-full bg-white p-2\">\r\n          <p class=\"text-sm font-medium mb-3\">Datos personales</p>\r\n          <div class=\"gap-2\">\r\n            <div class=\"columns-4 gap-4\">\r\n              <div>\r\n                <VaInput\r\n                  v-model=\"form.fullname\"\r\n                  stateful\r\n                  name=\"fullname\"\r\n                  clearable\r\n                  maxlength=\"50\"\r\n                  label=\"Nombres completos\"\r\n                  :rules=\"[validators.required]\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <VaSelect\r\n                  v-model=\"form.document_type\"\r\n                  name=\"document_type\"\r\n                  class=\"text-xs\"\r\n                  :options=\"documentTypes\"\r\n                  label=\"Tipo de documento\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <VaInput\r\n                  v-model=\"form.document\"\r\n                  v-only-numbers\r\n                  name=\"document\"\r\n                  stateful\r\n                  clearable\r\n                  maxlength=\"22\"\r\n                  label=\"N° Documento\"\r\n                />\r\n              </div>\r\n              <div>\r\n                <VaInput v-model=\"form.ruc\" v-only-numbers maxlength=\"22\" name=\"ruc\" stateful clearable label=\"RUC\">\r\n                  <template #appendInner>\r\n                    <VaIcon name=\"open_in_new\" class=\"cursor-pointer\" @click=\"openSunatRuc()\" />\r\n                  </template>\r\n                </VaInput>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"w-full mt-3\">\r\n              <div class=\"w-full\">\r\n                <VaInput v-model=\"form.address\" name=\"address\" stateful clearable label=\"Dirección de contacto\" />\r\n              </div>\r\n            </div>\r\n            <div class=\"w-full columns-4 gap-4 mt-3 pb-2\">\r\n              <div class=\"\">\r\n                <VaInput v-model=\"form.email\" name=\"email\" stateful clearable label=\"Correo electrónico\" maxlength=\"25\">\r\n                  <template #prependInner>\r\n                    <VaIcon name=\"alternate_email\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                  </template>\r\n                </VaInput>\r\n              </div>\r\n              <div class=\"\">\r\n                <VaInput\r\n                  v-model=\"form.email_corporative\"\r\n                  name=\"email_corporative\"\r\n                  stateful\r\n                  clearable\r\n                  maxlength=\"25\"\r\n                  label=\"Correo corporativo\"\r\n                >\r\n                  <template #prependInner>\r\n                    <VaIcon name=\"alternate_email\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                  </template>\r\n                </VaInput>\r\n              </div>\r\n              <div class=\"\">\r\n                <VaInput\r\n                  v-model=\"form.cellphone\"\r\n                  v-only-numbers\r\n                  name=\"cellphone\"\r\n                  stateful\r\n                  clearable\r\n                  label=\"Teléfono\"\r\n                  maxlength=\"12\"\r\n                  :rules=\"[validators.required]\"\r\n                >\r\n                  <template #prependInner>\r\n                    <VaIcon name=\"call\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                  </template>\r\n                </VaInput>\r\n              </div>\r\n              <div class=\"\">\r\n                <VaInput\r\n                  v-model=\"form.whatsapp\"\r\n                  v-only-numbers\r\n                  name=\"whatsapp\"\r\n                  maxlength=\"12\"\r\n                  stateful\r\n                  clearable\r\n                  label=\"WhatsApp\"\r\n                >\r\n                  <template #prependInner>\r\n                    <VaIcon name=\"call\" class=\"material-symbols-outlined -mx-1.5\" color=\"secondary\" />\r\n                  </template>\r\n                </VaInput>\r\n              </div>\r\n            </div>\r\n\r\n            <div class=\"w-full mt-5\">\r\n              <VaSwitch\r\n                v-model=\"form.havecompany\"\r\n                class=\"text-xs\"\r\n                name=\"havecompany\"\r\n                label=\"Representa una empresa\"\r\n                size=\"small\"\r\n              />\r\n            </div>\r\n\r\n            <div v-if=\"form.havecompany\" class=\"columns-3 mt-5\">\r\n              <div>\r\n                <VaSelect\r\n                  v-model=\"form.company\"\r\n                  name=\"company_id\"\r\n                  class=\"text-xs\"\r\n                  :options=\"companies\"\r\n                  track-by=\"id\"\r\n                  value-by=\"id\"\r\n                  text-by=\"socialreason\"\r\n                  searchable\r\n                  clearable\r\n                  search-placeholder-text=\"Escribe el RUC\"\r\n                  :rules=\"[validators.required]\"\r\n                  label=\"Selecciona la empresa\"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"pt-5\">\r\n                <VaButton icon=\"add\" color=\"primary\" :loading=\"isLoading\" @click=\"showNewCompany = true\">\r\n                  <span class=\"text-xs px-1\">{{ t('contacts.createCompany') }}</span>\r\n                </VaButton>\r\n              </div>\r\n            </div>\r\n\r\n            <div v-if=\"selectedCompany\" class=\"bg-blue-50 px-3 py-2 mt-5\">\r\n              <p class=\"font-bold text-sm mb-3\">{{ selectedCompany.socialreason }}</p>\r\n              <div class=\"columns-4\">\r\n                <div>\r\n                  <VaInput\r\n                    :model-value=\"selectedCompany.ruc\"\r\n                    background=\"#eee\"\r\n                    :placeholder=\"'Sin información'\"\r\n                    name=\"whatsapp\"\r\n                    readonly\r\n                    class=\"opacity-85 cursor-not-allowed\"\r\n                    label=\"RUC\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    :model-value=\"selectedCompany.phone\"\r\n                    background=\"#eee\"\r\n                    :placeholder=\"'Sin información'\"\r\n                    name=\"whatsapp\"\r\n                    readonly\r\n                    class=\"opacity-85 cursor-not-allowed\"\r\n                    label=\"Teléfono\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <VaInput\r\n                    :model-value=\"selectedCompany.whatsapp\"\r\n                    :placeholder=\"'Sin información'\"\r\n                    background=\"#eee\"\r\n                    name=\"whatsapp\"\r\n                    readonly\r\n                    class=\"opacity-85 cursor-not-allowed\"\r\n                    label=\"WhatsApp\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </VaForm>\r\n    </div>\r\n\r\n    <div class=\"pb-3\">\r\n      <div class=\"flex justify-end\">\r\n        <div class=\"flex gap-2\">\r\n          <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\r\n            <span class=\"text-xs px-1\">{{ t('contacts.createContact') }}</span>\r\n          </VaButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n\r\n  <VaModal v-model=\"showNewCompany\" hide-default-actions size=\"340px\" close-button blur no-dismiss>\r\n    <div>\r\n      <NewCompany @close=\"onClosed\" />\r\n    </div>\r\n  </VaModal>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.new-customer {\r\n  &-tabs {\r\n    .va-tabs__content {\r\n      width: 100%;\r\n    }\r\n  }\r\n\r\n  .float-profile {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n  }\r\n}\r\n</style>\r\n"],"names":["emit","__emit","vOnlyNumbers","onlyNumbersNoDigits","showNewCompany","ref","t","useI18n","isLoading","companies","isValid","validate","reset","useForm","form","reactive","onMounted","watch","val","getCompanies","selectedCompany","computed","f","notify","useToast","doProcess","documentType","_a","newContact","e","documentTypes","openSunatRuc","onClosed","cData","getAllCompanies"],"mappings":"wsCAWA,MAAMA,EAAOC,EACPC,EAAeC,EAEfC,EAAiBC,EAAI,EAAK,EAC1B,CAAE,EAAAC,GAAMC,IACRC,EAAYH,EAAI,EAAK,EACrBI,EAAiBJ,EAAI,CAAA,CAAE,EACvB,CAAE,QAAAK,EAAS,SAAAC,EAAU,MAAAC,CAAM,EAAIC,EAAQ,SAAS,EAChDC,EAAYC,EAAS,CAAA,CAAE,EAE7BC,EAAU,IAAM,CACdC,EACE,IAAMH,EAAK,YACX,MAAOI,GAAQ,CACTA,GAAK,MAAMC,EAAa,CAC9B,CAAA,CACF,CACD,EACD,MAAMC,EAAkBC,EAAS,IAAMZ,EAAU,MAAM,KAAMa,GAAWA,EAAE,KAAOR,EAAK,OAAO,CAAC,EAExF,CAAE,OAAAS,GAAWC,IACbC,EAAY,SAAY,OAC5B,GAAId,IAAY,CACdH,EAAU,MAAQ,GACd,GAAA,CACI,MAAAkB,GAAeC,EAAAb,GAAA,YAAAA,EAAM,gBAAN,YAAAa,EAAqB,KAC1C,MAAMC,EAAW,CACf,GAAGd,EACH,cAAeY,CAAA,CAChB,EAEMH,EAAA,CACL,QAAS,mCACT,MAAO,SAAA,CACR,EAEKX,IAENZ,EAAK,OAAO,QACL6B,EAAQ,CACf,QAAQ,IAAIA,CAAC,CACf,CAEArB,EAAU,MAAQ,EACpB,CAAA,EAGIsB,EAAgB,CACpB,CAAE,KAAM,EAAG,KAAM,KAAM,EACvB,CAAE,KAAM,EAAG,KAAM,KAAM,EACvB,CAAE,KAAM,EAAG,KAAM,WAAY,CAAA,EAGzBC,EAAe,IAAM,CAClB,OAAA,KACL,oFACA,SACA,4CAAA,CACF,EAEIC,EAAW,IAAM,CACrB5B,EAAe,MAAQ,GACVe,GAAA,EAETA,EAAe,SAAY,CACzB,MAAAc,EAAQ,MAAMC,IACpBzB,EAAU,MAAQwB,CAAA"}