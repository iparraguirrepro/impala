{"version":3,"file":"Users-17f27922.js","sources":["../../src/pages/settings/NewUser.vue","../../src/pages/settings/Users.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { onMounted, reactive, ref } from 'vue'\nimport { useForm } from 'vuestic-ui'\nimport { useToast } from 'vuestic-ui'\nimport { apiUserRegister } from '../../core/requests/Auth'\nimport { updateUser } from '../../core/requests/Users'\nimport { validators } from '../../services/utils'\n\nconst emit = defineEmits(['close'])\n\nconst props = defineProps({\n  data: {\n    default: null,\n    type: Object,\n  },\n})\n\nconst isLoading = ref(false)\nconst { isValid, validate } = useForm('formRef')\nconst basic = ref([])\nconst form: any = reactive({\n  ...(props.data && {\n    names: props.data?.name,\n    username: props.data?.username,\n    signature: props.data?.signature,\n    can_edit: props.data?.can_edit ? true : false,\n    can_quotate: props.data?.can_quotate,\n    can_order: props.data?.can_order,\n  }),\n})\nconst { notify } = useToast()\n\nonMounted(() => {\n  console.log(props.data)\n})\n\nconst toBase64 = async (file: any) => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader()\n    reader.readAsDataURL(file)\n    reader.onload = () => resolve(reader.result)\n    reader.onerror = reject\n  })\n}\n\nconst doProcess = async () => {\n  if (validate()) {\n    isLoading.value = true\n\n    try {\n      const body: any = {\n        name: form.names,\n        username: form.username,\n        ...(basic.value.length === 0 && { signature: form.signature }),\n        password: form.password,\n        can_edit: form.can_edit ? 1 : 0,\n        can_quotate: form.can_quotate ? 1 : 0,\n        can_order: form.can_order ? 1 : 0,\n      }\n\n      if (basic.value.length) {\n        const signFile = await toBase64(basic.value[0])\n        body.sign = signFile\n      }\n      //\n\n      const response: any = props.data ? await updateUser(props.data.id, body) : await apiUserRegister(body)\n\n      if (response.status == true) {\n        notify({ message: 'Usuario grabado correctamente', color: 'primary' })\n        emit('close')\n      } else {\n        notify({ message: 'Error al grabar usuario', color: 'danger' })\n      }\n    } catch (e: any) {\n      console.log(e)\n    }\n\n    isLoading.value = false\n  }\n}\n</script>\n\n<template>\n  <div class=\"bg-blue-50\">\n    <div class=\"mb-4\">\n      <div class=\"flex justify-between align-center justify-center\">\n        <h1 class=\"h5 font-bold m-0\">{{ $props.data?.username ? 'Editar' : 'Nuevo' }} Usuario</h1>\n      </div>\n    </div>\n\n    <div class=\"new-customer gap-8\">\n      <VaForm ref=\"formRef\" immediate class=\"gap-2\">\n        <div class=\"w-full bg-white p-2 pb-5 mb-4\">\n          <div class=\"gap-2\">\n            <div class=\"columns-1 mt-1\">\n              <div class=\"w-full\">\n                <VaInput\n                  v-model=\"form.names\"\n                  stateful\n                  clearable\n                  label=\"Nombres Completos\"\n                  :rules=\"[validators.required]\"\n                />\n              </div>\n              <div class=\"w-full my-3\">\n                <VaInput\n                  v-model=\"form.username\"\n                  stateful\n                  clearable\n                  label=\"Usuario\"\n                  type=\"email\"\n                  auto-complete=\"none\"\n                  :rules=\"[validators.email, validators.required]\"\n                />\n              </div>\n              <div v-if=\"!$props.data\" class=\"w-full\">\n                <VaInput\n                  v-model=\"form.password\"\n                  stateful\n                  clearable\n                  type=\"password\"\n                  label=\"Contraseña\"\n                  autocomplete=\"off\"\n                  :rules=\"[validators.required]\"\n                />\n              </div>\n              <div class=\"mb-4 mt-4\">\n                <div v-if=\"$props.data?.signature\" class=\"my-2 mb-4\">\n                  <p class=\"mb-2\" style=\"font-size: 11px; font-weight: 600; color: var(--va-primary)\">Firma:</p>\n                  <img :src=\"'http://impala.test' + $props.data?.signature\" style=\"width: 120px\" alt=\"\" />\n                </div>\n                <VaFileUpload\n                  v-model=\"basic\"\n                  dropzone\n                  drop-zone-text=\"Arrastra o selecciona tu firma\"\n                  upload-button-text=\"Buscar\"\n                  file-types=\"jpg,jpeg,png\"\n                />\n                <p v-if=\"basic?.length > 1\" class=\"text-xxs bg-red-100 px-2\">Solo se admite un archivo.</p>\n              </div>\n              <hr class=\"mt-4\" />\n              <p class=\"text-xxs uppercase font-bold bg-primary text-white px-2\">Permisos de usuario</p>\n              <div class=\"w-full flex flex-col gap-3 bg-blue-50 py-3 px-2\">\n                <VaCheckbox v-model=\"form.can_edit\" label=\"Puede editar configuración\" />\n                <!-- <VaCheckbox v-model=\"form.can_quotate\" label=\"Puede crear cotizaciones\" /> -->\n                <!-- <VaCheckbox v-model=\"form.can_order\" label=\"Puede crear Ordenes\" /> -->\n              </div>\n            </div>\n          </div>\n        </div>\n      </VaForm>\n    </div>\n\n    <div class=\"pb-3\">\n      <div class=\"flex justify-end\">\n        <div class=\"flex gap-2\">\n          <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\n            <span class=\"text-xs px-1\">Grabar Usuario</span>\n          </VaButton>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"scss\">\n.new-customer {\n  &-tabs {\n    .va-tabs__content {\n      width: 100%;\n    }\n  }\n\n  .float-profile {\n    position: absolute;\n    top: 0;\n    right: 0;\n  }\n}\n</style>\n","<script lang=\"ts\" setup>\nimport { onMounted, ref } from 'vue'\nimport { deleteUser, disableUser, getAllUsers } from '../../core/requests/Users'\nimport NewUser from './NewUser.vue'\nimport { format } from 'date-fns'\n\nconst users: any = ref([])\nconst showConfirm: any = ref(null)\nconst isDeleting = ref(false)\nconst isLoading = ref(false)\nconst showNewUser = ref(false)\nconst selectedUser: any = ref(null)\n\nonMounted(() => {\n  getData()\n})\n\nconst getData = async () => {\n  isLoading.value = true\n  showNewUser.value = false\n  const data: any = await getAllUsers()\n  users.value = data.map((e: any) => ({\n    ...e,\n    active: e.status === 1,\n    loading: false,\n    created_at: format(new Date(e.created_at), 'dd/MM/yyyy'),\n  }))\n  isLoading.value = false\n}\nconst doDelete = async () => {\n  isDeleting.value = true\n  await deleteUser(showConfirm.value?.id)\n  showConfirm.value = null\n  getData()\n  isDeleting.value = false\n}\nconst doDisable = async (e: any) => {\n  e.loading = true\n  await disableUser(e?.id)\n  getData()\n  e.loading = false\n}\nconst select4Edit = (data: any) => {\n  selectedUser.value = data\n  showNewUser.value = true\n}\nconst openNewUser = () => {\n  showNewUser.value = true\n  selectedUser.value = null\n}\n</script>\n\n<template>\n  <div class=\"flex flex-col space-y-6 md:space-y-4\">\n    <VaInnerLoading :loading=\"isLoading\">\n      <VaCard>\n        <VaCardTitle class=\"d-flex justify-between\">\n          Administración de usuarios\n          <VaButton icon=\"add\" color=\"primary\" @click=\"openNewUser\">\n            <span class=\"px-1\">Nuevo Usuario</span>\n          </VaButton>\n        </VaCardTitle>\n        <VaCardContent>\n          <div class=\"flex flex-col p-4 bg-backgroundSecondary rounded-lg\">\n            <div class=\"va-table-responsive\">\n              <table class=\"va-table w-full text-xs\">\n                <thead>\n                  <tr>\n                    <th>#</th>\n                    <th>Nombres</th>\n                    <th>Usuario</th>\n                    <th>Permisos</th>\n                    <th>Fecha Creación</th>\n                    <th>Activo</th>\n                    <th></th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr v-for=\"t in users\" :key=\"t.id\">\n                    <td>00{{ t.id }}</td>\n                    <td>{{ t.name }}</td>\n                    <td>{{ t.username }}</td>\n                    <td>\n                      <div class=\"flex flex-wrap gap-1\">\n                        <span\n                          v-if=\"t.can_edit\"\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\n                        >\n                          Puede Editar\n                        </span>\n\n                        <span\n                          v-if=\"t.can_quotate\"\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\n                        >\n                          Puede Cotizar\n                        </span>\n\n                        <span\n                          v-if=\"t.can_order\"\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\n                        >\n                          Puede crear Ordenes\n                        </span>\n                      </div>\n                    </td>\n                    <td>{{ t.created_at }}</td>\n                    <td>\n                      <VaSwitch\n                        v-model=\"t.active\"\n                        :loading=\"t.loading\"\n                        size=\"small\"\n                        @update:modelValue=\"doDisable(t)\"\n                      />\n                    </td>\n                    <td>\n                      <div class=\"flex gap-1\">\n                        <VaButton icon=\"edit\" color=\"primary\" round @click=\"select4Edit(t)\"></VaButton>\n                        <VaButton icon=\"delete\" color=\"danger\" round @click=\"showConfirm = t\"></VaButton>\n                      </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          </div>\n        </VaCardContent>\n      </VaCard>\n    </VaInnerLoading>\n\n    <VaModal v-model=\"showNewUser\" size=\"360px\" close-button hide-default-actions blur no-dismiss>\n      <div>\n        <NewUser :data=\"selectedUser\" @close=\"getData\" />\n      </div>\n    </VaModal>\n\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\n      <p class=\"text-sm\">¿Deseas eliminar este usuario?</p>\n\n      <template #footer>\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"showConfirm = null\"> Cancelar</VaButton>\n        <VaButton :loading=\"isDeleting\" size=\"small\" @click=\"doDelete\"> Continuar</VaButton>\n      </template>\n    </VaModal>\n  </div>\n</template>\n"],"names":["emit","__emit","props","__props","isLoading","ref","isValid","validate","useForm","basic","form","reactive","_a","_b","_c","_d","_e","_f","notify","useToast","onMounted","toBase64","file","resolve","reject","reader","doProcess","body","signFile","updateUser","apiUserRegister","e","users","showConfirm","isDeleting","showNewUser","selectedUser","getData","data","getAllUsers","format","doDelete","deleteUser","doDisable","disableUser","select4Edit","openNewUser"],"mappings":"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"}