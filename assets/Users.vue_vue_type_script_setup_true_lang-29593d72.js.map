{"version":3,"file":"Users.vue_vue_type_script_setup_true_lang-29593d72.js","sources":["../../src/pages/settings/NewUser.vue","../../src/pages/settings/Users.vue"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { onMounted, reactive, ref } from 'vue'\r\nimport { useForm } from 'vuestic-ui'\r\nimport { useToast } from 'vuestic-ui'\r\nimport { apiUserRegister } from '../../core/requests/Auth'\r\nimport { updateUser } from '../../core/requests/Users'\r\nimport { validators } from '../../services/utils'\r\n\r\nconst emit = defineEmits(['close'])\r\n\r\nconst props = defineProps({\r\n  data: {\r\n    default: null,\r\n    type: Object,\r\n  },\r\n})\r\n\r\nconst isLoading = ref(false)\r\nconst { isValid, validate } = useForm('formRef')\r\nconst basic = ref([])\r\nconst form: any = reactive({\r\n  ...(props.data && {\r\n    names: props.data?.name,\r\n    username: props.data?.username,\r\n    signature: props.data?.signature,\r\n    can_edit: props.data?.can_edit ? true : false,\r\n    can_quotate: props.data?.can_quotate,\r\n    can_order: props.data?.can_order,\r\n  }),\r\n})\r\nconst { notify } = useToast()\r\n\r\nonMounted(() => {\r\n  console.log(props.data)\r\n})\r\n\r\nconst toBase64 = async (file: any) => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader()\r\n    reader.readAsDataURL(file)\r\n    reader.onload = () => resolve(reader.result)\r\n    reader.onerror = reject\r\n  })\r\n}\r\n\r\nconst doProcess = async () => {\r\n  if (validate()) {\r\n    isLoading.value = true\r\n\r\n    try {\r\n      const body: any = {\r\n        name: form.names,\r\n        username: form.username,\r\n        ...(basic.value.length === 0 && { signature: form.signature }),\r\n        password: form.password,\r\n        can_edit: form.can_edit ? 1 : 0,\r\n        can_quotate: form.can_quotate ? 1 : 0,\r\n        can_order: form.can_order ? 1 : 0,\r\n      }\r\n\r\n      if (basic.value.length) {\r\n        const signFile = await toBase64(basic.value[0])\r\n        body.sign = signFile\r\n      }\r\n      //\r\n\r\n      const response: any = props.data ? await updateUser(props.data.id, body) : await apiUserRegister(body)\r\n\r\n      if (response.status == true) {\r\n        notify({ message: 'Usuario grabado correctamente', color: 'primary' })\r\n        emit('close')\r\n      } else {\r\n        notify({ message: 'Error al grabar usuario', color: 'danger' })\r\n      }\r\n    } catch (e: any) {\r\n      console.log(e)\r\n    }\r\n\r\n    isLoading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"bg-blue-50\">\r\n    <div class=\"mb-4\">\r\n      <div class=\"flex justify-between align-center justify-center\">\r\n        <h1 class=\"h5 font-bold m-0\">{{ $props.data?.username ? 'Editar' : 'Nuevo' }} Usuario</h1>\r\n      </div>\r\n    </div>\r\n\r\n    <div class=\"new-customer gap-8\">\r\n      <VaForm ref=\"formRef\" immediate class=\"gap-2\">\r\n        <div class=\"w-full bg-white p-2 pb-5 mb-4\">\r\n          <div class=\"gap-2\">\r\n            <div class=\"columns-1 mt-1\">\r\n              <div class=\"w-full\">\r\n                <VaInput\r\n                  v-model=\"form.names\"\r\n                  stateful\r\n                  clearable\r\n                  label=\"Nombres Completos\"\r\n                  :rules=\"[validators.required]\"\r\n                />\r\n              </div>\r\n              <div class=\"w-full my-3\">\r\n                <VaInput\r\n                  v-model=\"form.username\"\r\n                  stateful\r\n                  clearable\r\n                  label=\"Usuario\"\r\n                  type=\"email\"\r\n                  auto-complete=\"none\"\r\n                  :rules=\"[validators.email, validators.required]\"\r\n                />\r\n              </div>\r\n              <div v-if=\"!$props.data\" class=\"w-full\">\r\n                <VaInput\r\n                  v-model=\"form.password\"\r\n                  stateful\r\n                  clearable\r\n                  type=\"password\"\r\n                  label=\"Contraseña\"\r\n                  autocomplete=\"off\"\r\n                  :rules=\"[validators.required]\"\r\n                />\r\n              </div>\r\n              <div class=\"mb-4 mt-4\">\r\n                <div v-if=\"$props.data?.signature\" class=\"my-2 mb-4\">\r\n                  <p class=\"mb-2\" style=\"font-size: 11px; font-weight: 600; color: var(--va-primary)\">Firma:</p>\r\n                  <img :src=\"'http://impala.test' + $props.data?.signature\" style=\"width: 120px\" alt=\"\" />\r\n                </div>\r\n                <VaFileUpload\r\n                  v-model=\"basic\"\r\n                  dropzone\r\n                  drop-zone-text=\"Arrastra o selecciona tu firma\"\r\n                  upload-button-text=\"Buscar\"\r\n                  file-types=\"jpg,jpeg,png\"\r\n                />\r\n                <p v-if=\"basic?.length > 1\" class=\"text-xxs bg-red-100 px-2\">Solo se admite un archivo.</p>\r\n              </div>\r\n              <hr class=\"mt-4\" />\r\n              <p class=\"text-xxs uppercase font-bold bg-primary text-white px-2\">Permisos de usuario</p>\r\n              <div class=\"w-full flex flex-col gap-3 bg-blue-50 py-3 px-2\">\r\n                <VaCheckbox v-model=\"form.can_edit\" label=\"Puede editar configuración\" />\r\n                <!-- <VaCheckbox v-model=\"form.can_quotate\" label=\"Puede crear cotizaciones\" /> -->\r\n                <!-- <VaCheckbox v-model=\"form.can_order\" label=\"Puede crear Ordenes\" /> -->\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </VaForm>\r\n    </div>\r\n\r\n    <div class=\"pb-3\">\r\n      <div class=\"flex justify-end\">\r\n        <div class=\"flex gap-2\">\r\n          <VaButton icon=\"save\" color=\"primary\" :disabled=\"!isValid\" :loading=\"isLoading\" @click=\"doProcess\">\r\n            <span class=\"text-xs px-1\">Grabar Usuario</span>\r\n          </VaButton>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\n.new-customer {\r\n  &-tabs {\r\n    .va-tabs__content {\r\n      width: 100%;\r\n    }\r\n  }\r\n\r\n  .float-profile {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 0;\r\n  }\r\n}\r\n</style>\r\n","<script lang=\"ts\" setup>\r\nimport { onMounted, ref } from 'vue'\r\nimport { deleteUser, disableUser, getAllUsers } from '../../core/requests/Users'\r\nimport NewUser from './NewUser.vue'\r\nimport { format } from 'date-fns'\r\n\r\nconst users: any = ref([])\r\nconst showConfirm: any = ref(null)\r\nconst isDeleting = ref(false)\r\nconst isLoading = ref(false)\r\nconst showNewUser = ref(false)\r\nconst selectedUser: any = ref(null)\r\n\r\nonMounted(() => {\r\n  getData()\r\n})\r\n\r\nconst getData = async () => {\r\n  isLoading.value = true\r\n  showNewUser.value = false\r\n  const data: any = await getAllUsers()\r\n  users.value = data.map((e: any) => ({\r\n    ...e,\r\n    active: e.status === 1,\r\n    loading: false,\r\n    created_at: format(new Date(e.created_at), 'dd/MM/yyyy'),\r\n  }))\r\n  isLoading.value = false\r\n}\r\nconst doDelete = async () => {\r\n  isDeleting.value = true\r\n  await deleteUser(showConfirm.value?.id)\r\n  showConfirm.value = null\r\n  getData()\r\n  isDeleting.value = false\r\n}\r\nconst doDisable = async (e: any) => {\r\n  e.loading = true\r\n  await disableUser(e?.id)\r\n  getData()\r\n  e.loading = false\r\n}\r\nconst select4Edit = (data: any) => {\r\n  selectedUser.value = data\r\n  showNewUser.value = true\r\n}\r\nconst openNewUser = () => {\r\n  showNewUser.value = true\r\n  selectedUser.value = null\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col space-y-6 md:space-y-4\">\r\n    <VaInnerLoading :loading=\"isLoading\">\r\n      <VaCard>\r\n        <VaCardTitle class=\"d-flex justify-between\">\r\n          Administración de usuarios\r\n          <VaButton icon=\"add\" color=\"primary\" @click=\"openNewUser\">\r\n            <span class=\"px-1\">Nuevo Usuario</span>\r\n          </VaButton>\r\n        </VaCardTitle>\r\n        <VaCardContent>\r\n          <div class=\"flex flex-col p-4 bg-backgroundSecondary rounded-lg\">\r\n            <div class=\"va-table-responsive\">\r\n              <table class=\"va-table w-full text-xs\">\r\n                <thead>\r\n                  <tr>\r\n                    <th>#</th>\r\n                    <th>Nombres</th>\r\n                    <th>Usuario</th>\r\n                    <th>Permisos</th>\r\n                    <th>Fecha Creación</th>\r\n                    <th>Activo</th>\r\n                    <th></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  <tr v-for=\"t in users\" :key=\"t.id\">\r\n                    <td>00{{ t.id }}</td>\r\n                    <td>{{ t.name }}</td>\r\n                    <td>{{ t.username }}</td>\r\n                    <td>\r\n                      <div class=\"flex flex-wrap gap-1\">\r\n                        <span\r\n                          v-if=\"t.can_edit\"\r\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\r\n                        >\r\n                          Puede Editar\r\n                        </span>\r\n\r\n                        <span\r\n                          v-if=\"t.can_quotate\"\r\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\r\n                        >\r\n                          Puede Cotizar\r\n                        </span>\r\n\r\n                        <span\r\n                          v-if=\"t.can_order\"\r\n                          class=\"inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-bold text-gray-600 ring-1 ring-inset ring-gray-500/10\"\r\n                        >\r\n                          Puede crear Ordenes\r\n                        </span>\r\n                      </div>\r\n                    </td>\r\n                    <td>{{ t.created_at }}</td>\r\n                    <td>\r\n                      <VaSwitch\r\n                        v-model=\"t.active\"\r\n                        :loading=\"t.loading\"\r\n                        size=\"small\"\r\n                        @update:modelValue=\"doDisable(t)\"\r\n                      />\r\n                    </td>\r\n                    <td>\r\n                      <div class=\"flex gap-1\">\r\n                        <VaButton icon=\"edit\" color=\"primary\" round @click=\"select4Edit(t)\"></VaButton>\r\n                        <VaButton icon=\"delete\" color=\"danger\" round @click=\"showConfirm = t\"></VaButton>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          </div>\r\n        </VaCardContent>\r\n      </VaCard>\r\n    </VaInnerLoading>\r\n\r\n    <VaModal v-model=\"showNewUser\" size=\"360px\" close-button hide-default-actions blur no-dismiss>\r\n      <div>\r\n        <NewUser :data=\"selectedUser\" @close=\"getData\" />\r\n      </div>\r\n    </VaModal>\r\n\r\n    <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n      <p class=\"text-sm\">¿Deseas eliminar este usuario?</p>\r\n\r\n      <template #footer>\r\n        <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"showConfirm = null\"> Cancelar</VaButton>\r\n        <VaButton :loading=\"isDeleting\" size=\"small\" @click=\"doDelete\"> Continuar</VaButton>\r\n      </template>\r\n    </VaModal>\r\n  </div>\r\n</template>\r\n"],"names":["emit","__emit","props","__props","isLoading","ref","isValid","validate","useForm","basic","form","reactive","_a","_b","_c","_d","_e","_f","notify","useToast","onMounted","toBase64","file","resolve","reject","reader","doProcess","body","signFile","updateUser","apiUserRegister","e","users","showConfirm","isDeleting","showNewUser","selectedUser","getData","data","getAllUsers","format","doDelete","deleteUser","doDisable","disableUser","select4Edit","openNewUser"],"mappings":"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"}