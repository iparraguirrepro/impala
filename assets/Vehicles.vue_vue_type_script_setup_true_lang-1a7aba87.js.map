{"version":3,"file":"Vehicles.vue_vue_type_script_setup_true_lang-1a7aba87.js","sources":["../../src/pages/settings/Vehicles.vue"],"sourcesContent":["<script lang=\"ts\" setup>\r\nimport { onMounted, ref } from 'vue'\r\nimport { useForm, useToast } from 'vuestic-ui'\r\nimport { deleteVehicle, getAllVehicles, newVehicle } from '../../core/requests/Vehicles'\r\nimport { validators } from '../../services/utils'\r\nimport { onlyNumbers, onlyNumbersNoDigits } from '../../core/helpers'\r\nimport { ceil } from 'lodash'\r\n\r\nconst vOnlyDigits = onlyNumbers\r\nconst vOnlyNumbers = onlyNumbersNoDigits\r\n\r\nconst { notify } = useToast()\r\nconst vehiclesColumns = [\r\n  { key: 'Vehiculo', sortable: true },\r\n  { key: 'Fabricación', sortable: true },\r\n  { key: 'Capacidad', sortable: true },\r\n  { key: 'Gal/Hr', sortable: true },\r\n  { key: 'Maquina Seca', sortable: true },\r\n  { key: 'Acciones', width: 80 },\r\n]\r\nconst vehicles = ref([])\r\nconst itemSelected = ref(null)\r\nconst showNewVehicle = ref(false)\r\nconst loadingNewVehicle = ref(false)\r\nconst showConfirm = ref(false)\r\nconst isDeleting = ref(false)\r\nconst selectedType: any = ref(null)\r\nconst formVehicle: any = ref({})\r\nconst { validate, reset: vehicleReset } = useForm('fgVehicle')\r\n\r\nonMounted(() => {\r\n  getVehicles()\r\n})\r\n\r\nconst loadingVehicles = ref(false)\r\nasync function getVehicles() {\r\n  loadingVehicles.value = true\r\n  const vehiclesData: any = await getAllVehicles()\r\n  vehicles.value = vehiclesData.map((i: any) => ({\r\n    ...i,\r\n    Vehiculo: i.name,\r\n    Fabricación: i.year,\r\n    Capacidad: i.capacity,\r\n    'Gal/Hr': `${i.cost || 0}`,\r\n    'Maquina Seca': i.fee ? `S/ ${i.fee || '0.00'}` : '-',\r\n  }))\r\n  loadingVehicles.value = false\r\n}\r\n\r\nconst doDelete = async () => {\r\n  if (selectedType.value === 'vehicles') {\r\n    await deleteVehicle(itemSelected.value)\r\n    await getVehicles()\r\n  }\r\n\r\n  selectedType.value = null\r\n  showConfirm.value = false\r\n}\r\nconst doNewVehicle = async () => {\r\n  loadingNewVehicle.value = true\r\n  try {\r\n    validate()\r\n    await newVehicle({\r\n      ...formVehicle.value,\r\n    })\r\n\r\n    await getVehicles()\r\n\r\n    notify({\r\n      message: 'Vehiculo registrado correctamente',\r\n      color: 'success',\r\n    })\r\n\r\n    loadingNewVehicle.value = false\r\n    vehicleReset()\r\n    showNewVehicle.value = false\r\n  } catch (e: any) {\r\n    console.log(e)\r\n  }\r\n}\r\nconst needConfirm = (id: any, type: string) => {\r\n  showConfirm.value = id ? true : false\r\n  itemSelected.value = id\r\n  selectedType.value = type\r\n}\r\n</script>\r\n\r\n<template>\r\n  <div class=\"flex flex-col space-y-6 md:space-y-4\">\r\n    <VaCard>\r\n      <VaCardTitle class=\"flex justify-between\">\r\n        Vehiculos\r\n        <VaButton class=\"ml-3 pr-2 pl-1\" icon=\"add\" color=\"primary\" @click=\"showNewVehicle = true\">Agregar</VaButton>\r\n      </VaCardTitle>\r\n      <VaCardContent>\r\n        <div class=\"flex flex-col p-4 bg-backgroundSecondary rounded-lg\">\r\n          <VaDataTable :items=\"vehicles\" :columns=\"vehiclesColumns\" class=\"text-xs\" :loading=\"loadingVehicles\">\r\n            <template #cell(Acciones)=\"{ row }\">\r\n              <div class=\"flex gap-1\">\r\n                <VaButton\r\n                  icon=\"delete\"\r\n                  color=\"danger\"\r\n                  round\r\n                  @click=\"needConfirm(row?.rowData?.id, 'vehicles')\"\r\n                ></VaButton>\r\n              </div>\r\n            </template>\r\n          </VaDataTable>\r\n        </div>\r\n      </VaCardContent>\r\n    </VaCard>\r\n\r\n    <VaModal v-model=\"showNewVehicle\" hide-default-actions size=\"300px\" close-button blur no-dismiss @ok=\"doNewVehicle\">\r\n      <div>\r\n        <h4 class=\"text-base mb-4\">Nuevo vehiculo</h4>\r\n        <div class=\"flex flex-col\">\r\n          <VaForm ref=\"fgVehicle\" immediate class=\"gap-2\">\r\n            <VaInput\r\n              v-model=\"formVehicle.name\"\r\n              stateful\r\n              name=\"name\"\r\n              clearable\r\n              label=\"Nombre de Vehiculo\"\r\n              class=\"mb-3\"\r\n              :rules=\"[validators.required]\"\r\n            />\r\n\r\n            <VaInput\r\n              v-model=\"formVehicle.capacity\"\r\n              v-only-digits\r\n              stateful\r\n              name=\"capacity\"\r\n              type=\"number\"\r\n              clearable\r\n              label=\"Capacidad\"\r\n              class=\"mb-3\"\r\n              :rules=\"[validators.required]\"\r\n            />\r\n\r\n            <VaInput\r\n              v-model=\"formVehicle.year\"\r\n              v-only-numbers\r\n              stateful\r\n              name=\"year\"\r\n              type=\"text\"\r\n              clearable\r\n              label=\"Año\"\r\n              class=\"mb-3\"\r\n              :rules=\"[validators.required]\"\r\n            />\r\n\r\n            <VaInput\r\n              v-model=\"formVehicle.fee\"\r\n              v-only-digits\r\n              stateful\r\n              name=\"fee\"\r\n              clearable\r\n              label=\"Maquina Seca\"\r\n              class=\"mb-3\"\r\n              :rules=\"[validators.required]\"\r\n              @change=\"\r\n                () => {\r\n                  formVehicle.fee = ceil(formVehicle.fee, 2)\r\n                }\r\n              \"\r\n            >\r\n              <template #prependInner>\r\n                <span class=\"font-bold text-sm\">S/</span>\r\n              </template>\r\n            </VaInput>\r\n\r\n            <VaInput\r\n              v-model=\"formVehicle.cost\"\r\n              v-only-digits\r\n              stateful\r\n              type=\"number\"\r\n              name=\"cost\"\r\n              clearable\r\n              label=\"Consumo por kilometro (gal/hr)\"\r\n              class=\"mb-5\"\r\n            />\r\n          </VaForm>\r\n        </div>\r\n        <div class=\"flex\">\r\n          <VaButton class=\"pr-2 pl-1\" icon=\"save\" color=\"primary\" :loading=\"loadingNewVehicle\" @click=\"doNewVehicle\">\r\n            <span class=\"ml-2\">Registrar</span>\r\n          </VaButton>\r\n        </div>\r\n      </div>\r\n    </VaModal>\r\n  </div>\r\n\r\n  <VaModal v-model=\"showConfirm\" size=\"250px\" hide-default-actions no-dismiss blur>\r\n    <p class=\"text-sm\">¿Deseas continuar?</p>\r\n\r\n    <template #footer>\r\n      <VaButton size=\"small\" preset=\"secondary\" class=\"mr-1\" @click=\"needConfirm(null, '')\"> Cancelar</VaButton>\r\n      <VaButton size=\"small\" :loading=\"isDeleting\" @click=\"doDelete\"> Continuar</VaButton>\r\n    </template>\r\n  </VaModal>\r\n</template>\r\n"],"names":["vOnlyDigits","onlyNumbers","vOnlyNumbers","onlyNumbersNoDigits","notify","useToast","vehiclesColumns","vehicles","ref","itemSelected","showNewVehicle","loadingNewVehicle","showConfirm","isDeleting","selectedType","formVehicle","validate","vehicleReset","useForm","onMounted","getVehicles","loadingVehicles","vehiclesData","getAllVehicles","i","doDelete","deleteVehicle","doNewVehicle","newVehicle","e","needConfirm","id","type"],"mappings":"+uBAQA,MAAMA,EAAcC,EACdC,EAAeC,EAEf,CAAE,OAAAC,GAAWC,IACbC,EAAkB,CACtB,CAAE,IAAK,WAAY,SAAU,EAAK,EAClC,CAAE,IAAK,cAAe,SAAU,EAAK,EACrC,CAAE,IAAK,YAAa,SAAU,EAAK,EACnC,CAAE,IAAK,SAAU,SAAU,EAAK,EAChC,CAAE,IAAK,eAAgB,SAAU,EAAK,EACtC,CAAE,IAAK,WAAY,MAAO,EAAG,CAAA,EAEzBC,EAAWC,EAAI,CAAA,CAAE,EACjBC,EAAeD,EAAI,IAAI,EACvBE,EAAiBF,EAAI,EAAK,EAC1BG,EAAoBH,EAAI,EAAK,EAC7BI,EAAcJ,EAAI,EAAK,EACvBK,EAAaL,EAAI,EAAK,EACtBM,EAAoBN,EAAI,IAAI,EAC5BO,EAAmBP,EAAI,CAAA,CAAE,EACzB,CAAE,SAAAQ,EAAU,MAAOC,CAAa,EAAIC,EAAQ,WAAW,EAE7DC,EAAU,IAAM,CACFC,GAAA,CACb,EAEK,MAAAC,EAAkBb,EAAI,EAAK,EACjC,eAAeY,GAAc,CAC3BC,EAAgB,MAAQ,GAClB,MAAAC,EAAoB,MAAMC,IAChChB,EAAS,MAAQe,EAAa,IAAKE,IAAY,CAC7C,GAAGA,EACH,SAAUA,EAAE,KACZ,YAAaA,EAAE,KACf,UAAWA,EAAE,SACb,SAAU,GAAGA,EAAE,MAAQ,CAAC,GACxB,eAAgBA,EAAE,IAAM,MAAMA,EAAE,KAAO,MAAM,GAAK,GAClD,EAAA,EACFH,EAAgB,MAAQ,EAC1B,CAEA,MAAMI,EAAW,SAAY,CACvBX,EAAa,QAAU,aACnB,MAAAY,EAAcjB,EAAa,KAAK,EACtC,MAAMW,EAAY,GAGpBN,EAAa,MAAQ,KACrBF,EAAY,MAAQ,EAAA,EAEhBe,EAAe,SAAY,CAC/BhB,EAAkB,MAAQ,GACtB,GAAA,CACOK,IACT,MAAMY,EAAW,CACf,GAAGb,EAAY,KAAA,CAChB,EAED,MAAMK,EAAY,EAEXhB,EAAA,CACL,QAAS,oCACT,MAAO,SAAA,CACR,EAEDO,EAAkB,MAAQ,GACbM,IACbP,EAAe,MAAQ,SAChBmB,EAAQ,CACf,QAAQ,IAAIA,CAAC,CACf,CAAA,EAEIC,EAAc,CAACC,EAASC,IAAiB,CACjCpB,EAAA,MAAQ,EAAAmB,EACpBtB,EAAa,MAAQsB,EACrBjB,EAAa,MAAQkB,CAAA"}